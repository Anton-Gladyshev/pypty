
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      
      <link rel="icon" href="assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>PyPty (python + ptychography) - PyPty (python + ptychography)</title>
      
    
    
      <link rel="stylesheet" href="assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="css/print-site.css">
    
      <link rel="stylesheet" href="css/print-site-material.css">
    
    <script>__md_scope=new URL("/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#index" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="index.html" title="PyPty (python + ptychography)" class="md-header__button md-logo" aria-label="PyPty (python + ptychography)" data-md-component="logo">
      
  <img src="logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyPty (python + ptychography)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PyPty (python + ptychography)
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Anton-Gladyshev/pypty" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="index.html" title="PyPty (python + ptychography)" class="md-nav__button md-logo" aria-label="PyPty (python + ptychography)" data-md-component="logo">
      
  <img src="logo.png" alt="logo">

    </a>
    PyPty (python + ptychography)
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Anton-Gladyshev/pypty" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.7.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="index.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="experiment.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Description of the experiment
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="example_breakdown.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples for iterative ptychography
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="examples_direct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Examples for direct methods
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="custom_presets.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide for creating custom presets
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="incoherent.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Incoherent scattering
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="compressed.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Compressed data
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--section md-nav__item--nested">
      
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/initialize.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.initialize
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/dpc.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.dpc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/se.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.se
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/tcbf.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.tcbf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/direct.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.direct
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/iterative.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.iterative
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/objective.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.objective
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/multislice_core.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.multislice_core
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/fft.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.fft
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/utils.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/se.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.se
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="reference/vaa.html" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    pypty.vaa
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      1 Home
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#experiment" class="md-nav__link">
    <span class="md-ellipsis">
      2 Description of the experiment
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#example_breakdown" class="md-nav__link">
    <span class="md-ellipsis">
      3 Examples for iterative ptychography
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#examples_direct" class="md-nav__link">
    <span class="md-ellipsis">
      4 Examples for direct methods
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom_presets" class="md-nav__link">
    <span class="md-ellipsis">
      5 Guide for creating custom presets
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#incoherent" class="md-nav__link">
    <span class="md-ellipsis">
      6 Incoherent scattering
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#compressed" class="md-nav__link">
    <span class="md-ellipsis">
      7 Compressed data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-8" class="md-nav__link">
    <span class="md-ellipsis">
      8 API Reference
    </span>
  </a>
  
    <nav class="md-nav" aria-label="8 API Reference">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#reference-initialize" class="md-nav__link">
    <span class="md-ellipsis">
      8.1 pypty.initialize
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-dpc" class="md-nav__link">
    <span class="md-ellipsis">
      8.2 pypty.dpc
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-se" class="md-nav__link">
    <span class="md-ellipsis">
      8.3 pypty.se
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-tcbf" class="md-nav__link">
    <span class="md-ellipsis">
      8.4 pypty.tcbf
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-direct" class="md-nav__link">
    <span class="md-ellipsis">
      8.5 pypty.direct
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-iterative" class="md-nav__link">
    <span class="md-ellipsis">
      8.6 pypty.iterative
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-objective" class="md-nav__link">
    <span class="md-ellipsis">
      8.7 pypty.objective
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-multislice_core" class="md-nav__link">
    <span class="md-ellipsis">
      8.8 pypty.multislice_core
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-fft" class="md-nav__link">
    <span class="md-ellipsis">
      8.9 pypty.fft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-utils" class="md-nav__link">
    <span class="md-ellipsis">
      8.10 pypty.utils
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-se" class="md-nav__link">
    <span class="md-ellipsis">
      8.11 pypty.se
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#reference-vaa" class="md-nav__link">
    <span class="md-ellipsis">
      8.12 pypty.vaa
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="index" heading-number="1"><h1 id="index-overview"><strong><em>Overview</em></strong><a class="headerlink" href="#index-overview" title="Permanent link">&para;</a></h1>
<p><strong>PyPty</strong> is a <strong>phase retrieval</strong> library for <strong>near-field</strong> and <strong>far-field imaging</strong> in <strong>TEM/STEM</strong>. It supports:</p>
<ul>
<li><strong>Iterative ptychography</strong></li>
<li><strong>Direct ptychography</strong> (Wigner Distribution Deconvolution)</li>
<li><strong>Differential phase contrast (DPC)</strong></li>
<li><strong>Tilt-corrected bright field (tcBF)</strong></li>
<li><strong>Focal series reconstructions</strong></li>
<li><strong>LARBED reconstructions</strong></li>
</ul>
<p>Developed by Anton Gladyshev (AG SEM, Physics Department, Humboldt-Universität zu Berlin).</p>
<hr />
<h2 id="index-installation"><strong><em>Installation</em></strong><a class="headerlink" href="#index-installation" title="Permanent link">&para;</a></h2>
<p>To create a suitable Python environment for PyPty, you can use <strong>conda</strong>, <strong>mamba</strong>, or <strong>micromamba</strong>. Below are installation instructions using <code>conda</code>.</p>
<h3 id="index-gpu-installation">GPU Installation<a class="headerlink" href="#index-gpu-installation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#index-__codelineno-0-1"></a>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:Anton-Gladyshev/pypty.git
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#index-__codelineno-0-2"></a><span class="nb">cd</span><span class="w"> </span>pypty
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#index-__codelineno-0-3"></a>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>pypty_gpu.yml
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#index-__codelineno-0-4"></a>conda<span class="w"> </span>activate<span class="w"> </span>pypty
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#index-__codelineno-0-5"></a>pip<span class="w"> </span>install<span class="w"> </span>.<span class="o">[</span>gpu<span class="o">]</span>
</code></pre></div>
<h3 id="index-cpu-installation">CPU Installation<a class="headerlink" href="#index-cpu-installation" title="Permanent link">&para;</a></h3>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#index-__codelineno-1-1"></a>git<span class="w"> </span>clone<span class="w"> </span>git@github.com:Anton-Gladyshev/pypty.git
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#index-__codelineno-1-2"></a><span class="nb">cd</span><span class="w"> </span>pypty
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#index-__codelineno-1-3"></a>conda<span class="w"> </span>env<span class="w"> </span>create<span class="w"> </span>-f<span class="w"> </span>pypty_cpu.yml
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#index-__codelineno-1-4"></a>conda<span class="w"> </span>activate<span class="w"> </span>pypty
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#index-__codelineno-1-5"></a>pip<span class="w"> </span>install<span class="w"> </span>.
</code></pre></div>
<h2 id="index-about-this-code">About this Code<a class="headerlink" href="#index-about-this-code" title="Permanent link">&para;</a></h2>
<h3 id="index-main-purpose">Main Purpose<a class="headerlink" href="#index-main-purpose" title="Permanent link">&para;</a></h3>
<p>The primary function of PyPty is <strong>gradient-based phase reconstruction</strong> from far-field intensities. This is handled via <a href="#reference-iterative"><code>pypty.iterative.run()</code></a>. Most other functions are designed to simplify usage of this core function.</p>
<p>A complete list of required arguments for <code>pypty.iterative.run()</code> is available in the <a href="#custom_presets">custom presets guide</a>.</p>
<h3 id="index-logic">Logic<a class="headerlink" href="#index-logic" title="Permanent link">&para;</a></h3>
<p>PyPty is written in "functional programming" style, but most PyPty functions accept a single input dictionary called <code>pypty_params</code>, which typically includes both experimental and reconstruction settings. These experimental parameters are often defined separately in a dictionary called <code>experimental_params</code> (see <a href="#experiment">experiment description</a>).</p>
<p>Once you’ve created a valid <code>pypty_params</code> for one experiment, you can reuse it for others by simply <a href="#example_breakdown">"attaching"</a> new experimental parameters.</p>
<p>PyPty also supports various <a href="#examples_direct">direct reconstruction methods</a> and tools for <a href="#reference-initialize">initialization</a>.</p>
<h3 id="index-scaling-within-one-and-multiple-gpu-s">Scaling within one and multiple GPU(-s)<a class="headerlink" href="#index-scaling-within-one-and-multiple-gpu-s" title="Permanent link">&para;</a></h3>
<p>PyPty supports various degrees of parallelization. I would like to highlight that most of operations in phase retrival are trivially parallelizable. Typically one deals with multiple measurements, outcomes of which do not depend on each other. Further, if a measurement can not be described as a perfectly coherent one, one has to repeat multiple similar operations to build a trace of an operator. These two facts are heavily exploited to accelerate the computation in PyPty. Incoherency-parallelization is done automatically. The multiple measurements can be proccessed simultaneously in two different ways. If more than one CUDA device is detected, PyPty will automatically split the dataset in even parts and execute computations concurrently on multiple GPUs. Moreover, one can process measurements in a vectorized fashion on one device. This requieres finding balance between memory usage and computation speed. Please see parameter <code>compute_batch</code> in section <a href="#custom_presets">custom presets guide</a> for more detailed information.</p>
<hr />
<h2 id="index-input-format">Input Format<a class="headerlink" href="#index-input-format" title="Permanent link">&para;</a></h2>
<p>PyPty primarily operates on <code>.h5</code> files and provides tools to convert from NumPy. The <code>.h5</code> file should contain a dataset named <code>"data"</code> with a 3D array: one scan axis and two detector axes.</p>
<p>PyPty also accepts 4D Nion-style NumPy arrays (with accompanying JSON metadata).</p>
<hr />
<h2 id="index-output-format">Output Format<a class="headerlink" href="#index-output-format" title="Permanent link">&para;</a></h2>
<p>By default, PyPty saves all output as <code>.npy</code> files inside an <code>output_folder</code>. The folder structure may look like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#index-__codelineno-2-1"></a>output_folder
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#index-__codelineno-2-2"></a>├── cg.npy                              **overwritable checkpoint for scan grid**
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#index-__codelineno-2-3"></a>├── cp.npy                              **overwritable checkpoint for probe**
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#index-__codelineno-2-4"></a>├── co.npy                              **overwritable checkpoint for object**
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#index-__codelineno-2-5"></a>├── checkpoint_obj_epoch_N.npy          **checkpoint for object at epoch N**
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#index-__codelineno-2-6"></a>├── checkpoint_probe_epoch_N.npy        **checkpoint for probe at epoch N**
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#index-__codelineno-2-7"></a>├── checkpoint_positions_epoch_N.npy    **checkpoint for scan grid at epoch N**
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#index-__codelineno-2-8"></a>├── params.pkl                          **parameter file of your reconstruction**
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#index-__codelineno-2-9"></a>├── loss.csv                            **.csv log-file**
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#index-__codelineno-2-10"></a>├── tcbf                                **folder  with tcBF results**
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#index-__codelineno-2-11"></a>│   ├── tcbf_image_upsampling_5.npy     **upsampled tcBF image_**
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#index-__codelineno-2-12"></a>│   ├── tcbf_image_N.png                **intermediate tcBF image at iteration N in .png format**
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#index-__codelineno-2-13"></a>│   ├── estimated_shifts_N.npy          **Fitted shifts at iteration N in .npy format**
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#index-__codelineno-2-14"></a>│   ├── aberrations_N.npy               **Fitted aberrations (in Angstrom) at iteration N in .npy format**
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#index-__codelineno-2-15"></a>│   ├── PL_angle_deg.npy                **array constaining fitted rotation angles at all iterations in .npy format**
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#index-__codelineno-2-16"></a>│   ├── aberrations_A.npy               **2d array constaining fitted aberrations at all iterations in .npy format**
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#index-__codelineno-2-17"></a>└── dpc                                 **folder  with DPC results**
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#index-__codelineno-2-18"></a>│   ├── idpc.npy                        **fft-based dpc phase**
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#index-__codelineno-2-19"></a>│   ├── iterative_dpc.npy               **DPC phase (iterative reconstruction)**
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#index-__codelineno-2-20"></a>└── wdd                                 **folder  with WDD results**
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#index-__codelineno-2-21"></a>    ├── object.npy                      **complex object (WDD ptychography)**
</code></pre></div>
<p>You can also convert an output folder into single Nexus <code>.nxs</code> file via <a href="#reference-utils">pypty.utils.convert_to_nxs()</a> function.</p>
<h2 id="index-examples">Examples<a class="headerlink" href="#index-examples" title="Permanent link">&para;</a></h2>
<p>Example workflows are available in the <code>examples</code> folder on GitHub.</p>
<p>For a quick start, check out the following:</p>
<ul>
<li><a href="#example_breakdown">Step-by-Step Breakdown</a> — Explains key functions and logic</li>
<li><a href="#custom_presets">Custom Presets Guide</a> — For advanced setups</li>
<li><a href="#examples_direct">Direct Methods</a> — For Wigner distribution and other direct approaches</li>
<li><a href="#incoherent">Incohrent Ptychography</a> - Reconsturcitons with incoherent scattering  </li>
<li><a href="#compressed">Compressed Ptychography</a> - Reconsturcitons from compressed data</li>
</ul>
<h2 id="index-relevant-literature"><strong><em>Relevant Literature</em></strong><a class="headerlink" href="#index-relevant-literature" title="Permanent link">&para;</a></h2>
<p>If you have any questions after reading this guide, the following papers, books and links might explain the working principle of the code:</p>
<h3 id="index-multi-slice-formalism-and-the-nn-style-approach">Multi-slice formalism and the NN-style approach<a class="headerlink" href="#index-multi-slice-formalism-and-the-nn-style-approach" title="Permanent link">&para;</a></h3>
<p>1) Earl J. Kirkland. Advanced Computing  in Electron Microscopy </p>
<p>2) W. Van den Broek and C. Koch. General framework for quantitative three-dimensional reconstruction from arbitrary detection geometries in TEM </p>
<p>3) W. Van den Broek and C. Koch. Method for Retrieval of the Three-Dimensional Object Potential by Inversion of Dynamical Electron Scattering </p>
<h3 id="index-error-metrics">Error metrics:<a class="headerlink" href="#index-error-metrics" title="Permanent link">&para;</a></h3>
<h4 id="index-lsq">LSQ:<a class="headerlink" href="#index-lsq" title="Permanent link">&para;</a></h4>
<p>4) M. Schloz et al. Overcoming information reduced data and experimentally uncertain parameters in ptychography with regularized optimization </p>
<p>5) M. Du et al. Adorym: a multi-platform generic X-ray image reconstruction framework based on automatic differentiation </p>
<h4 id="index-maximum-likelihood-ml">Maximum Likelihood (ML):<a class="headerlink" href="#index-maximum-likelihood-ml" title="Permanent link">&para;</a></h4>
<p>6) P. Thibault and M. Guizar-Sicairos. Maximum-likelihood refinement for coherent diffractive imaging </p>
<h4 id="index-compressed-lsq">Compressed LSQ:<a class="headerlink" href="#index-compressed-lsq" title="Permanent link">&para;</a></h4>
<p>7) A. Gladyshev et al. Lossy Compression of Electron Diffraction Patterns for Ptychography via Change of Basis</p>
<h4 id="index-lsq_sqrt-and-lsq_sqrt2">lsq_sqrt and lsq_sqrt2:<a class="headerlink" href="#index-lsq_sqrt-and-lsq_sqrt2" title="Permanent link">&para;</a></h4>
<p>8) P. Godard et al. (2012). Noise models for low counting rate coherent diffraction imaging</p>
<h3 id="index-mixed-state-formalism">Mixed state formalism:<a class="headerlink" href="#index-mixed-state-formalism" title="Permanent link">&para;</a></h3>
<p>9) P Thibault &amp; A.Menzel Reconstructing state mixtures from diffraction measurements— Flux-preserving formalism (for near-field imaging)</p>
<h3 id="index-near-field-imaging">Near-field imaging<a class="headerlink" href="#index-near-field-imaging" title="Permanent link">&para;</a></h3>
<p>10) C. Koch A flux-preserving non-linear inline holography reconstruction algorithm for partially coherent electrons</p>
<h3 id="index-tilted-propagator">Tilted propagator:<a class="headerlink" href="#index-tilted-propagator" title="Permanent link">&para;</a></h3>
<p>11) Earl J. Kirkland. Advanced Computing  in Electron Microscopy </p>
<p>12) H. She, J. Cui and R. Yu. Deep sub-angstrom resolution imaging by electron ptychography with misorientation correction</p>
<h3 id="index-regularization-constaints">Regularization constaints:<a class="headerlink" href="#index-regularization-constaints" title="Permanent link">&para;</a></h3>
<p>13) M. Schloz et al. Overcoming information reduced data and experimentally uncertain parameters in ptychography with regularized optimization </p>
<p>14) A. Gladyshev et al. Lossy Compression of Electron Diffraction Patterns for Ptychography via Change of Basis</p>
<h3 id="index-linesearch">Linesearch<a class="headerlink" href="#index-linesearch" title="Permanent link">&para;</a></h3>
<p>15) L. Armijo (1966). Minimization of functions having Lipschitz continuous first partial derivatives
16) P. Wolfe (1969). Convergence Conditions for Ascent Methods</p>
<h3 id="index-bfgs-algotithm">BFGS algotithm<a class="headerlink" href="#index-bfgs-algotithm" title="Permanent link">&para;</a></h3>
<p>17) C. G. Broyden (1970). The convergence of a class of double-rank minimization algorithms</p>
<p>18) R. Fletcher   (1970). A New Approach to Variable Metric Algorithms</p>
<p>19) D. Goldfarb (1970). A Family of Variable Metric Updates Derived by Variational Means</p>
<p>20) D. F. Shanno (1970). Conditioning of quasi-Newton methods for function minimization</p>
<h3 id="index-complex-derivatives">Complex derivatives<a class="headerlink" href="#index-complex-derivatives" title="Permanent link">&para;</a></h3>
<p>21) W. Wirtinger (1927). Zur formalen theorie der funktionen von mehr komplexen veränderlichen. </p></section><section class="print-page" id="experiment" heading-number="2"><h1 id="experiment-getting-started-with-the-initialize-module"><strong><em>Getting started with the <code>initialize</code> Module</em></strong><a class="headerlink" href="#experiment-getting-started-with-the-initialize-module" title="Permanent link">&para;</a></h1>
<p>PyPty comes with an <code>initialize</code> module (see the <a href="#reference-initialize">API Reference</a>), which is designed specifically for <strong>far-field ptychography</strong>.</p>
<p>This module makes it easy to:</p>
<ul>
<li>Create a <strong>calibrated dataset</strong></li>
<li>Generate a <strong>PyPty preset</strong> from scratch</li>
</ul>
<p>If your experimental setup involves additional complexity or non-standard conditions, please refer to the <a href="#custom_presets">Custom Preset Guide</a> for more flexible configuration.</p>
<p>However, if your setup fits the typical <strong>far-field ptychography</strong> case, you can summarize all key experimental parameters in a single Python dictionary. For clarity, we usually refer to this as <code>experimental_params</code>.</p>
<p>The dictionary should contain the following keys:</p>
<h2 id="experiment-essential-data-paths"><strong>Essential Data Paths</strong><a class="headerlink" href="#experiment-essential-data-paths" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_path</code></td>
<td><code>str</code></td>
<td>Path to a <strong>3D PyPty <code>.h5</code> dataset</strong> (<code>[N_measurements, ky, kx]</code>) or a <strong>4D-STEM <code>.npy</code> dataset</strong>.</td>
</tr>
<tr>
<td><code>masks</code></td>
<td><code>ndarray</code> or <code>None</code></td>
<td>If the data is compressed, provide the virtual detectors (<code>[N_masks, ky, kx]</code>).</td>
</tr>
<tr>
<td><code>output_folder</code></td>
<td><code>str</code></td>
<td>Directory where results will be stored.</td>
</tr>
<tr>
<td><code>path_json</code></td>
<td><code>str</code></td>
<td>Path to a Nion-style <code>.json</code> file with metadata (optional).</td>
</tr>
</tbody>
</table>
<h2 id="experiment-electron-beam-properties"><strong>Electron Beam Properties</strong><a class="headerlink" href="#experiment-electron-beam-properties" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>acc_voltage</code></td>
<td><code>float</code></td>
<td>Accelerating voltage (in <strong>kV</strong>).</td>
</tr>
<tr>
<td><code>rez_pixel_size_A</code></td>
<td><code>float</code></td>
<td>Reciprocal pixel size (in <strong>Å⁻¹</strong>).</td>
</tr>
<tr>
<td><code>rez_pixel_size_mrad</code></td>
<td><code>float</code></td>
<td>Reciprocal pixel size (in <strong>mrad</strong>).</td>
</tr>
<tr>
<td><code>conv_semiangle_mrad</code></td>
<td><code>float</code></td>
<td>Beam convergence semi-angle (in <strong>mrad</strong>).</td>
</tr>
<tr>
<td><code>aperture</code></td>
<td><code>ndarray</code> (optional)</td>
<td>Binary <strong>2D mask</strong> representing the aperture.</td>
</tr>
<tr>
<td><code>bright_threshold</code></td>
<td><code>float</code></td>
<td>Threshold for estimating an aperture. Everything above <code>threshold * max(PACBED)</code> is considered bright field.</td>
</tr>
<tr>
<td><code>defocus</code></td>
<td><code>float</code></td>
<td>Extra probe defocus (besides aberrations).</td>
</tr>
<tr>
<td><code>aberrations</code></td>
<td><code>list</code> or <code>ndarray</code></td>
<td>Beam aberrations (stored in Krivanek notation).</td>
</tr>
</tbody>
</table>
<h2 id="experiment-scan-and-positioning"><strong>Scan and Positioning</strong><a class="headerlink" href="#experiment-scan-and-positioning" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>scan_size</code></td>
<td><code>tuple(int, int)</code></td>
<td>Number of scan points along <strong>slow (y)</strong> and <strong>fast (x)</strong> axes.</td>
</tr>
<tr>
<td><code>scan_step_A</code></td>
<td><code>float</code></td>
<td>Scan step (STEM pixel size) in <strong>Å</strong>.</td>
</tr>
<tr>
<td><code>fov_nm</code></td>
<td><code>float</code></td>
<td>Field of view (<strong>FOV</strong>) along the <strong>fast axis</strong> in <strong>nm</strong>.</td>
</tr>
<tr>
<td><code>special_positions_A</code></td>
<td><code>ndarray</code> (optional)</td>
<td>If data was acquired on a non-rectangular grid, specify positions as <code>[y_0, x_0], ..., [y_n, x_n]</code> (in <strong>Å</strong>).</td>
</tr>
<tr>
<td><code>transform_axis_matrix</code></td>
<td><code>ndarray (2×2)</code></td>
<td>Transformation matrix for position correction.</td>
</tr>
<tr>
<td><code>PLRotation_deg</code></td>
<td><code>float</code> or <code>"auto"</code></td>
<td>Rotation angle between scan and detector axes. If <code>"auto"</code>, an iDPC measurement estimates this angle.</td>
</tr>
</tbody>
</table>
<h2 id="experiment-basic-reconstruction-settings"><strong>Basic Reconstruction Settings</strong><a class="headerlink" href="#experiment-basic-reconstruction-settings" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_pad</code></td>
<td><code>int</code> or <code>None</code></td>
<td>Reciprocal space padding. Default: <code>1/4</code> of pattern width.</td>
</tr>
<tr>
<td><code>upsample_pattern</code></td>
<td><code>int</code></td>
<td>Upsampling factor for diffraction patterns.</td>
</tr>
<tr>
<td><code>flip_ky</code></td>
<td><code>bool</code></td>
<td>Flip the y-axis of diffraction patterns.</td>
</tr>
</tbody>
</table>
<h2 id="experiment-object-to-be-reconstructed"><strong>Object to be Reconstructed</strong><a class="headerlink" href="#experiment-object-to-be-reconstructed" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>num_slices</code></td>
<td><code>int</code></td>
<td>Number of slices used for multislice propagation (default: <code>1</code>).</td>
</tr>
<tr>
<td><code>total_thickness</code></td>
<td><code>float</code></td>
<td>Total thickness of the sample (in <strong>Å</strong>).</td>
</tr>
<tr>
<td><code>num_obj_modes</code></td>
<td><code>int</code></td>
<td>Number of object modes. Default is <code>1</code>. Use it to initialize incoherent object modes</td>
</tr>
<tr>
<td><code>obj_phase_sigma</code></td>
<td><code>float</code></td>
<td>Default is <code>1</code>. Standard deviation of Gaussian noise for initialization of incoherent object modes.</td>
</tr>
</tbody>
</table>
<h2 id="experiment-output-debugging"><strong>Output &amp; Debugging</strong><a class="headerlink" href="#experiment-output-debugging" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>plot</code></td>
<td><code>bool</code></td>
<td>If <code>True</code>, generates plots of key experimental parameters.</td>
</tr>
<tr>
<td><code>print_flag</code></td>
<td><code>int</code></td>
<td>Controls verbosity (<code>0</code> = silent, <code>1</code> = summary, <code>2+</code> = detailed logs).</td>
</tr>
<tr>
<td><code>save_preprocessing_files</code></td>
<td><code>bool</code></td>
<td>If <code>True</code>, saves intermediate preprocessing files.</td>
</tr>
</tbody>
</table>
<h2 id="experiment-nexus-tags"><strong>Nexus Tags</strong><a class="headerlink" href="#experiment-nexus-tags" title="Permanent link">&para;</a></h2>
<table>
<thead>
<tr>
<th>Key</th>
<th>Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>chemical_fomula</code></td>
<td><code>string</code></td>
<td>You can optionally provide a formula for your sample. PyPty will store this information.</td>
</tr>
<tr>
<td><code>sample_name</code></td>
<td><code>string</code></td>
<td>You can optionally provide a name of your sample. PyPty will store this information.</td>
</tr>
</tbody>
</table>
<hr /></section><section class="print-page" id="example_breakdown" heading-number="3"><h1 id="example_breakdown-breakdown-of-examples-for-iterative-ptychography"><strong><em>Breakdown of Examples for Iterative Ptychography</em></strong><a class="headerlink" href="#example_breakdown-breakdown-of-examples-for-iterative-ptychography" title="Permanent link">&para;</a></h1>
<p>This section provides a detailed breakdown of an iterative ptychography reconstruction using PyPty. To get started, create a Python script and import the necessary libraries:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#example_breakdown-__codelineno-0-1"></a><span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#example_breakdown-__codelineno-0-2"></a><span class="kn">import</span><span class="w"> </span><span class="nn">pypty</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#example_breakdown-__codelineno-0-3"></a><span class="c1"># NumPy is used for minor preprocessing, while all major operations are handled by PyPty.</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#example_breakdown-__codelineno-0-4"></a><span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PyPty version: &quot;</span><span class="p">,</span> <span class="n">pypty</span><span class="o">.</span><span class="n">_version_</span><span class="p">)</span>
</code></pre></div>
<p>We will need numpy to do some small preprocessing outside of pypty, but the major steps will be done with pypty functions.</p>
<p>Below I will go through the steps required to do a ptychographic reconstruction from normal 4D-STEM data (far-field).</p>
<h2 id="example_breakdown-creation-of-calibrated-data"><strong><em>Creation of Calibrated Data</em></strong><a class="headerlink" href="#example_breakdown-creation-of-calibrated-data" title="Permanent link">&para;</a></h2>
<p>In a first step we want to create and center a 4D-STEM dataset (in h5 format). PyPty can also accept raw numpy-arrays, but it's better to do this preprocessing step.
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#example_breakdown-__codelineno-1-1"></a><span class="n">path</span> <span class="o">=</span> <span class="n">path_to_your_data</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#example_breakdown-__codelineno-1-2"></a><span class="n">name</span> <span class="o">=</span> <span class="n">name</span> <span class="n">of</span> <span class="n">your</span> <span class="n">dataset</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#example_breakdown-__codelineno-1-3"></a><span class="n">path_raw</span> <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.npy&quot;</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#example_breakdown-__codelineno-1-4"></a><span class="n">path_h5</span>  <span class="o">=</span> <span class="n">path</span><span class="o">+</span><span class="n">name</span><span class="o">+</span><span class="s2">&quot;.h5&quot;</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#example_breakdown-__codelineno-1-5"></a>
<a id="__codelineno-1-6" name="__codelineno-1-6" href="#example_breakdown-__codelineno-1-6"></a><span class="n">pypty</span><span class="o">.</span><span class="n">initialize</span><span class="o">.</span><span class="n">create_pypty_data</span><span class="p">(</span><span class="n">path_raw</span><span class="p">,</span> <span class="n">path_h5</span><span class="p">,</span> <span class="n">swap_axes</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-1-7" name="__codelineno-1-7" href="#example_breakdown-__codelineno-1-7"></a>                    <span class="n">flip_ky</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">flip_kx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comcalc_len</span><span class="o">=</span><span class="mi">200</span><span class="o">*</span><span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-1-8" name="__codelineno-1-8" href="#example_breakdown-__codelineno-1-8"></a>                    <span class="n">comx</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">comy</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="nb">bin</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">crop_left</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-1-9" name="__codelineno-1-9" href="#example_breakdown-__codelineno-1-9"></a>                    <span class="n">crop_right</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crop_top</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">crop_bottom</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">normalize</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</code></pre></div></p>
<h2 id="example_breakdown-experimental-parameters"><strong><em>Experimental parameters</em></strong><a class="headerlink" href="#example_breakdown-experimental-parameters" title="Permanent link">&para;</a></h2>
<p>PyPty accepts .json metadata from Nion microscopes, but you can also specify all entries yourself. Here I create a dictionary <code>experimental_params</code> with relevant parameters. See the <a href="#experiment">experiment description</a> for further details.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#example_breakdown-__codelineno-2-1"></a><span class="n">path_json</span><span class="o">=</span><span class="s2">&quot;&quot;</span> <span class="c1">## I will leave this string like this and specify everything by hand.</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#example_breakdown-__codelineno-2-2"></a><span class="n">output_folder</span><span class="o">=</span><span class="n">your_output_folder</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#example_breakdown-__codelineno-2-3"></a>
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#example_breakdown-__codelineno-2-4"></a><span class="n">experimental_params</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#example_breakdown-__codelineno-2-5"></a>    <span class="s1">&#39;output_folder&#39;</span><span class="p">:</span> <span class="n">output_folder</span><span class="p">,</span>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#example_breakdown-__codelineno-2-6"></a>    <span class="s1">&#39;path_json&#39;</span><span class="p">:</span> <span class="n">path_json</span><span class="p">,</span> 
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#example_breakdown-__codelineno-2-7"></a>    <span class="s1">&#39;data_path&#39;</span><span class="p">:</span> <span class="n">path_h5</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#example_breakdown-__codelineno-2-8"></a>    
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#example_breakdown-__codelineno-2-9"></a>    <span class="c1">### You can specify one of the following three parameters</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#example_breakdown-__codelineno-2-10"></a>    <span class="s1">&#39;rez_pixel_size_A&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#example_breakdown-__codelineno-2-11"></a>    <span class="s1">&#39;rez_pixel_size_mrad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#example_breakdown-__codelineno-2-12"></a>    <span class="s1">&#39;conv_semiangle_mrad&#39;</span><span class="p">:</span> <span class="mf">33.8</span><span class="p">,</span>
<a id="__codelineno-2-13" name="__codelineno-2-13" href="#example_breakdown-__codelineno-2-13"></a>    
<a id="__codelineno-2-14" name="__codelineno-2-14" href="#example_breakdown-__codelineno-2-14"></a>    
<a id="__codelineno-2-15" name="__codelineno-2-15" href="#example_breakdown-__codelineno-2-15"></a>    <span class="s1">&#39;scan_size&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">256</span><span class="p">,</span><span class="mi">256</span><span class="p">],</span> <span class="c1">## this is number of scan points along slow and fast axes</span>
<a id="__codelineno-2-16" name="__codelineno-2-16" href="#example_breakdown-__codelineno-2-16"></a>    
<a id="__codelineno-2-17" name="__codelineno-2-17" href="#example_breakdown-__codelineno-2-17"></a>    <span class="c1">###  You can specify one of the following two parameters</span>
<a id="__codelineno-2-18" name="__codelineno-2-18" href="#example_breakdown-__codelineno-2-18"></a>    <span class="s1">&#39;scan_step_A&#39;</span><span class="p">:</span> <span class="mf">0.18</span><span class="p">,</span> <span class="c1"># scan step in Angstrom</span>
<a id="__codelineno-2-19" name="__codelineno-2-19" href="#example_breakdown-__codelineno-2-19"></a>    <span class="s1">&#39;fov_nm&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-2-20" name="__codelineno-2-20" href="#example_breakdown-__codelineno-2-20"></a>    
<a id="__codelineno-2-21" name="__codelineno-2-21" href="#example_breakdown-__codelineno-2-21"></a>    <span class="s1">&#39;acc_voltage&#39;</span><span class="p">:</span> <span class="mi">60</span><span class="p">,</span> <span class="c1">## kV</span>
<a id="__codelineno-2-22" name="__codelineno-2-22" href="#example_breakdown-__codelineno-2-22"></a>
<a id="__codelineno-2-23" name="__codelineno-2-23" href="#example_breakdown-__codelineno-2-23"></a>    <span class="s1">&#39;aberrations&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">200</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span><span class="c1">## Angstrom  [C10, C12a, C12b], can be longer</span>
<a id="__codelineno-2-24" name="__codelineno-2-24" href="#example_breakdown-__codelineno-2-24"></a>    
<a id="__codelineno-2-25" name="__codelineno-2-25" href="#example_breakdown-__codelineno-2-25"></a>    <span class="s1">&#39;PLRotation_deg&#39;</span><span class="p">:</span> <span class="mf">4.65</span><span class="p">,</span> <span class="c1"># deg</span>
<a id="__codelineno-2-26" name="__codelineno-2-26" href="#example_breakdown-__codelineno-2-26"></a>    
<a id="__codelineno-2-27" name="__codelineno-2-27" href="#example_breakdown-__codelineno-2-27"></a>    
<a id="__codelineno-2-28" name="__codelineno-2-28" href="#example_breakdown-__codelineno-2-28"></a>    <span class="s1">&#39;bright_threshold&#39;</span><span class="p">:</span> <span class="mf">0.2</span><span class="p">,</span> <span class="c1">## this parameter will be used to estimate the aperture</span>
<a id="__codelineno-2-29" name="__codelineno-2-29" href="#example_breakdown-__codelineno-2-29"></a>    
<a id="__codelineno-2-30" name="__codelineno-2-30" href="#example_breakdown-__codelineno-2-30"></a>    <span class="s1">&#39;total_thickness&#39;</span><span class="p">:</span> <span class="mi">6</span><span class="p">,</span> <span class="c1">## Angstrom, thickness of the sample</span>
<a id="__codelineno-2-31" name="__codelineno-2-31" href="#example_breakdown-__codelineno-2-31"></a>    <span class="s1">&#39;num_slices&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>  <span class="c1">## number of slices in your reconstruction</span>
<a id="__codelineno-2-32" name="__codelineno-2-32" href="#example_breakdown-__codelineno-2-32"></a>    
<a id="__codelineno-2-33" name="__codelineno-2-33" href="#example_breakdown-__codelineno-2-33"></a>    <span class="s1">&#39;plot&#39;</span><span class="p">:</span> <span class="kc">True</span><span class="p">,</span> <span class="c1">## pypty will plot a few things</span>
<a id="__codelineno-2-34" name="__codelineno-2-34" href="#example_breakdown-__codelineno-2-34"></a>    <span class="s1">&#39;print_flag&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="c1">## max verbosity</span>
<a id="__codelineno-2-35" name="__codelineno-2-35" href="#example_breakdown-__codelineno-2-35"></a>    <span class="s1">&#39;data_pad&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span> <span class="c1">## None will add 1/4 of pixels to each side. This is done to prevent aliasing. You can do any other positive int.</span>
<a id="__codelineno-2-36" name="__codelineno-2-36" href="#example_breakdown-__codelineno-2-36"></a>    
<a id="__codelineno-2-37" name="__codelineno-2-37" href="#example_breakdown-__codelineno-2-37"></a>    <span class="c1">## now there are 2 nexus tags you can specify. This will help to identify your reconstruction in the Future.</span>
<a id="__codelineno-2-38" name="__codelineno-2-38" href="#example_breakdown-__codelineno-2-38"></a>    <span class="s1">&#39;chemical_formula&#39;</span><span class="p">:</span> <span class="n">YOUR_Formula</span><span class="p">,</span> 
<a id="__codelineno-2-39" name="__codelineno-2-39" href="#example_breakdown-__codelineno-2-39"></a>    <span class="s1">&#39;sample_name&#39;</span><span class="p">:</span> <span class="n">NAME_of_YOUR_Sample</span><span class="p">,</span>
<a id="__codelineno-2-40" name="__codelineno-2-40" href="#example_breakdown-__codelineno-2-40"></a>    
<a id="__codelineno-2-41" name="__codelineno-2-41" href="#example_breakdown-__codelineno-2-41"></a>    <span class="p">}</span>
</code></pre></div>
<h2 id="example_breakdown-reconstruction-without-an-extra-h5-file">Reconstruction without an extra h5 file<a class="headerlink" href="#example_breakdown-reconstruction-without-an-extra-h5-file" title="Permanent link">&para;</a></h2>
<p>If you do not want to create an extra .h5 file (<strong>not recommended</strong>), you can specify the 4D-STEM data directly in the experimental parameters (before you join them with <code>pypty_params</code>). </p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#example_breakdown-__codelineno-3-1"></a><span class="n">experimental_params</span><span class="p">[</span><span class="s2">&quot;dataset&quot;</span><span class="p">]</span><span class="o">=</span><span class="n">dataset</span>
</code></pre></div>
Note than in this case the entry <code>data_path</code> will be ignored and you can leave this field empty. The dataset itself can be either 4D or 3D (with 2 scan axes merged into one).</p>
<h2 id="example_breakdown-loading-a-reconstruction-preset"><strong><em>Loading a reconstruction preset</em></strong><a class="headerlink" href="#example_breakdown-loading-a-reconstruction-preset" title="Permanent link">&para;</a></h2>
<p>Parameters for iterative ptychography are stored in a dictionary typically named <code>pypty_params</code>. </p>
<p>1) Such presets are typically stored as .pkl data and you can load them via a function in <code>utils</code> module</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#example_breakdown-__codelineno-4-1"></a><span class="n">path_to_your_pkl_preset</span><span class="o">=</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#example_breakdown-__codelineno-4-2"></a><span class="n">pypty_params</span><span class="o">=</span><span class="n">pypty</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_preset</span><span class="p">(</span><span class="n">path_to_your_pkl_preset</span><span class="p">)</span>
</code></pre></div>
<p>2) Alternatively, you can load them from a nexus data of another reconstruction</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#example_breakdown-__codelineno-5-1"></a><span class="n">path_to_your_nxs_preset</span><span class="o">=</span>
<a id="__codelineno-5-2" name="__codelineno-5-2" href="#example_breakdown-__codelineno-5-2"></a><span class="n">pypty_params</span><span class="o">=</span><span class="n">pypty</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">load_nexus_params</span><span class="p">(</span><span class="n">path_to_your_nxs_preset</span><span class="p">)</span>
</code></pre></div>
3) A third option is to construct your custom preset as a dictionary from scratch (Please see the <a href="#custom_presets">guide</a> )</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#example_breakdown-__codelineno-6-1"></a><span class="n">pypty_params</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#example_breakdown-__codelineno-6-2"></a>    <span class="s2">&quot;your_entry&quot;</span><span class="p">:</span> <span class="n">something</span><span class="p">,</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#example_breakdown-__codelineno-6-3"></a>    <span class="o">...</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#example_breakdown-__codelineno-6-4"></a>    <span class="p">}</span>
</code></pre></div>
4) Finally, you can specify it as <code>None</code>, then you will have a standard preset</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-7-1" name="__codelineno-7-1" href="#example_breakdown-__codelineno-7-1"></a><span class="n">pypty_params</span><span class="o">=</span><span class="kc">None</span>
</code></pre></div>
<h2 id="example_breakdown-joining-a-preset-with-experimental-parameters"><strong><em>Joining a preset with experimental parameters</em></strong><a class="headerlink" href="#example_breakdown-joining-a-preset-with-experimental-parameters" title="Permanent link">&para;</a></h2>
<p>Once you have a preset, you can add experimental data to it.</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-8-1" name="__codelineno-8-1" href="#example_breakdown-__codelineno-8-1"></a><span class="n">pypty_params</span><span class="o">=</span><span class="n">pypty</span><span class="o">.</span><span class="n">initialize</span><span class="o">.</span><span class="n">append_exp_params</span><span class="p">(</span><span class="n">experimental_params</span><span class="p">,</span> <span class="n">pypty_params</span><span class="p">)</span>
</code></pre></div>
<h2 id="example_breakdown-starting-ptychography"><strong><em>Starting Ptychography</em></strong><a class="headerlink" href="#example_breakdown-starting-ptychography" title="Permanent link">&para;</a></h2>
<p>This is done with a single function and single argument, <code>pypty_params</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-9-1" name="__codelineno-9-1" href="#example_breakdown-__codelineno-9-1"></a><span class="n">pypty</span><span class="o">.</span><span class="n">iterative</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">)</span>
</code></pre></div>
<h2 id="example_breakdown-saving-your-results-as-one-nexus-file"><strong><em>Saving your Results as one Nexus file</em></strong><a class="headerlink" href="#example_breakdown-saving-your-results-as-one-nexus-file" title="Permanent link">&para;</a></h2>
<p>Once your reconstruction is done, you will find a bunch of files in the <code>output_folder</code>. You can stack them into one big nexus file via a single function. You can also select where the .nxs file will be saved via
<code>path_to_your_nexus_file</code></p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-10-1" name="__codelineno-10-1" href="#example_breakdown-__codelineno-10-1"></a><span class="n">pypty</span><span class="o">.</span><span class="n">utils</span><span class="o">.</span><span class="n">convert_to_nxs</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="n">path_to_your_nexus_file</span><span class="p">)</span>
</code></pre></div></section><section class="print-page" id="examples_direct" heading-number="4"><h1 id="examples_direct-examples-for-direct-methods"><strong><em>Examples for direct methods</em></strong><a class="headerlink" href="#examples_direct-examples-for-direct-methods" title="Permanent link">&para;</a></h1>
<p>This page presents example usage of PyPty’s direct reconstruction methods: Differential Phase Contrast (DPC), Tilt-Corrected Bright Field (tcBF), and Wigner Distribution Deconvolution (WDD). These methods are used when a direct (non-iterative) reconstruction is preferred or as preprocessing for iterative methods.</p>
<hr />
<h2 id="examples_direct-differential-phase-contrast-dpc">Differential Phase Contrast (DPC)<a class="headerlink" href="#examples_direct-differential-phase-contrast-dpc" title="Permanent link">&para;</a></h2>
<p>PyPty is supplied with two functions for differential phase contrast. Both of them aim so solve a Poisson equation, i.e. to reconstruct a phase from its laplacian, gradient of the COM vector field. The first method, based on the Fast Fourier Transform (FFT), reconstructs the phase efficiently and can be executed as follows (including visualization using matplotlib)</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#examples_direct-__codelineno-0-1"></a><span class="n">dpc_phase</span><span class="p">,</span> <span class="n">pypty_params</span><span class="o">=</span> <span class="n">pypty</span><span class="o">.</span><span class="n">dpc</span><span class="o">.</span><span class="n">fft_based_dpc</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">,</span> <span class="n">hpass</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">lpass</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#examples_direct-__codelineno-0-2"></a>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#examples_direct-__codelineno-0-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dpc_phase</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#examples_direct-__codelineno-0-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DPC Phase (FFT-based)&quot;</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#examples_direct-__codelineno-0-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#examples_direct-__codelineno-0-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
Note that fft-based DPC returns both phase and parameter dictionary as it stores the calculated COM vector field (and the angle between real and reciprocal spaces). If these two quantities are not in <code>pypty_params</code>, it attempts to automatically calculate them.</p>
<p>Second method is iterative and accounts for non-periodic boundary conditions:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#examples_direct-__codelineno-1-1"></a><span class="n">dpc_phase</span><span class="o">=</span><span class="n">pypty</span><span class="o">.</span><span class="n">dpc</span><span class="o">.</span><span class="n">iterative_dpc</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">,</span> <span class="n">num_iterations</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">beta</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">hpass</span><span class="o">=</span><span class="mf">1e-1</span><span class="p">,</span> <span class="n">lpass</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">step_size</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#examples_direct-__codelineno-1-2"></a><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">dpc_phase</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#examples_direct-__codelineno-1-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;DPC Phase (iterative)&quot;</span><span class="p">)</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#examples_direct-__codelineno-1-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<a id="__codelineno-1-5" name="__codelineno-1-5" href="#examples_direct-__codelineno-1-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<p>Please see the <a href="#reference-dpc">module</a> description for detailed description of the parameters. </p>
<hr />
<h2 id="examples_direct-tilt-corrected-bright-field-tcbf">Tilt-Corrected Bright Field (tcBF)<a class="headerlink" href="#examples_direct-tilt-corrected-bright-field-tcbf" title="Permanent link">&para;</a></h2>
<p>In PyPty framework tcBF is done in two steps. First one aims to fit the aberrations of the beam and rotation angle between real and reciprocal spaces by creating an <strong>unupsampled</strong> tcBF image via <code>run_tcbf_alignment</code>:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#examples_direct-__codelineno-2-1"></a><span class="n">pypty_params</span><span class="o">=</span><span class="n">pypty</span><span class="o">.</span><span class="n">tcbf</span><span class="o">.</span><span class="n">run_tcbf_alignment</span><span class="p">(</span>
<a id="__codelineno-2-2" name="__codelineno-2-2" href="#examples_direct-__codelineno-2-2"></a>        <span class="n">pypty_params</span><span class="p">,</span>
<a id="__codelineno-2-3" name="__codelineno-2-3" href="#examples_direct-__codelineno-2-3"></a>        <span class="n">binning_for_fit</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">([</span><span class="mi">5</span><span class="p">],</span> <span class="mi">30</span><span class="p">),</span> 
<a id="__codelineno-2-4" name="__codelineno-2-4" href="#examples_direct-__codelineno-2-4"></a>        <span class="n">optimize_angle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-2-5" name="__codelineno-2-5" href="#examples_direct-__codelineno-2-5"></a>
<a id="__codelineno-2-6" name="__codelineno-2-6" href="#examples_direct-__codelineno-2-6"></a>        <span class="n">cross_corr_type</span><span class="o">=</span><span class="s2">&quot;abs&quot;</span><span class="p">,</span>
<a id="__codelineno-2-7" name="__codelineno-2-7" href="#examples_direct-__codelineno-2-7"></a>        <span class="n">refine_box_dim</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-2-8" name="__codelineno-2-8" href="#examples_direct-__codelineno-2-8"></a>        <span class="n">upsample</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span>
<a id="__codelineno-2-9" name="__codelineno-2-9" href="#examples_direct-__codelineno-2-9"></a>        <span class="n">cancel_large_shifts</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span>
<a id="__codelineno-2-10" name="__codelineno-2-10" href="#examples_direct-__codelineno-2-10"></a>        <span class="n">reference_type</span><span class="o">=</span><span class="s2">&quot;bf&quot;</span><span class="p">,</span>
<a id="__codelineno-2-11" name="__codelineno-2-11" href="#examples_direct-__codelineno-2-11"></a>        <span class="n">tol_ctf</span><span class="o">=</span><span class="mf">1e-8</span>
<a id="__codelineno-2-12" name="__codelineno-2-12" href="#examples_direct-__codelineno-2-12"></a>        <span class="p">)</span>
</code></pre></div>
<p>Note that you have to play with binning values and cross-correlation parameters to get an optimal result. Also, fitted rotation angle typically has a +- pi ambiguity, so if your defocus value comes out with a sign different from the experiment, I suggest to rerun the reconstruction.</p>
<p>A second tcBF function assumes that you already did an alignment and performs an upsampled reconstruction:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1" href="#examples_direct-__codelineno-3-1"></a><span class="n">tcbf_image</span><span class="p">,</span><span class="n">tcbf_px_size</span> <span class="o">=</span> <span class="n">pypty</span><span class="o">.</span><span class="n">tcbf</span><span class="o">.</span><span class="n">upsampled_tcbf</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">,</span> <span class="n">upsample</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-3-2" name="__codelineno-3-2" href="#examples_direct-__codelineno-3-2"></a>                                    <span class="n">pad</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">default_float</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span><span class="n">round_shifts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-3-3" name="__codelineno-3-3" href="#examples_direct-__codelineno-3-3"></a>                                    
<a id="__codelineno-3-4" name="__codelineno-3-4" href="#examples_direct-__codelineno-3-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">tcbf_image</span><span class="p">,</span>  <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-3-5" name="__codelineno-3-5" href="#examples_direct-__codelineno-3-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;tcBF image (x3 upsampling)&quot;</span><span class="p">)</span>
<a id="__codelineno-3-6" name="__codelineno-3-6" href="#examples_direct-__codelineno-3-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<a id="__codelineno-3-7" name="__codelineno-3-7" href="#examples_direct-__codelineno-3-7"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
<hr />
<h2 id="examples_direct-wigner-distribution-deconvolution-wdd">Wigner Distribution Deconvolution (WDD)<a class="headerlink" href="#examples_direct-wigner-distribution-deconvolution-wdd" title="Permanent link">&para;</a></h2>
<p>The last direct reconstruction method is Wigner distribution deconvolution (WDD). It is a direct method that reconstructs the object's complex wavefunction by deconvolving the measured intensity distribution with the known probe. WDD requires a calibrated <code>pypty_params</code>dictionary containing rotation angle, scan steps and a complex beam (or a set of aberrations). A simple usage example is</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1" href="#examples_direct-__codelineno-4-1"></a><span class="n">obj_wdd</span><span class="o">=</span><span class="n">pypty</span><span class="o">.</span><span class="n">direct</span><span class="o">.</span><span class="n">wdd</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">,</span>  <span class="n">eps_wiener</span><span class="o">=</span><span class="mf">1e-3</span><span class="p">)</span>
<a id="__codelineno-4-2" name="__codelineno-4-2" href="#examples_direct-__codelineno-4-2"></a>
<a id="__codelineno-4-3" name="__codelineno-4-3" href="#examples_direct-__codelineno-4-3"></a><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">angle</span><span class="p">(</span><span class="n">obj_wdd</span><span class="p">),</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">)</span>
<a id="__codelineno-4-4" name="__codelineno-4-4" href="#examples_direct-__codelineno-4-4"></a><span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;WDD Phase&quot;</span><span class="p">)</span>
<a id="__codelineno-4-5" name="__codelineno-4-5" href="#examples_direct-__codelineno-4-5"></a><span class="n">plt</span><span class="o">.</span><span class="n">colorbar</span><span class="p">()</span>
<a id="__codelineno-4-6" name="__codelineno-4-6" href="#examples_direct-__codelineno-4-6"></a><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div>
The parameter <code>eps_wiener</code> serves as a regularization term (high-pass filter) to stabilize the deconvolution, preventing division by zero.</p>
<hr />
<h2 id="examples_direct-using-direct-methods-for-initial-guesses">Using Direct Methods for Initial Guesses<a class="headerlink" href="#examples_direct-using-direct-methods-for-initial-guesses" title="Permanent link">&para;</a></h2>
<p><a href="#reference-initialize">pypty.initialize</a> module is supplied with a function <code>get_ptycho_obj_from_scan</code> that can be used to create complex transmission function based on a measurement sampled at the scan points, this can be a DPC or WDD phase. Usage example is:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1" href="#examples_direct-__codelineno-5-1"></a><span class="n">pypty_params</span> <span class="o">=</span>  <span class="n">pypty</span><span class="o">.</span><span class="n">initialize</span><span class="o">.</span><span class="n">get_ptycho_obj_from_scan</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">,</span> <span class="n">array_phase</span><span class="o">=</span><span class="n">dpc_phase</span><span class="p">,</span> <span class="n">array_abs</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
</code></pre></div>
<p>If you have an array on a grid with finer sampling than the actual scan grid of your reconstruction, you may first create an upsampled grid in the image coordinates and use the array for initial guess like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1" href="#examples_direct-__codelineno-6-1"></a><span class="n">image</span> <span class="o">=</span> <span class="c1">## your upsampled image</span>
<a id="__codelineno-6-2" name="__codelineno-6-2" href="#examples_direct-__codelineno-6-2"></a><span class="n">image_pixel_size</span> <span class="o">=</span> <span class="c1">## pixel size of your image</span>
<a id="__codelineno-6-3" name="__codelineno-6-3" href="#examples_direct-__codelineno-6-3"></a><span class="n">left_zero_of_scan_grid</span> <span class="o">=</span> <span class="c1"># how many pixels of the image are from left of the scan</span>
<a id="__codelineno-6-4" name="__codelineno-6-4" href="#examples_direct-__codelineno-6-4"></a><span class="n">top_zero_of_scan_grid</span>  <span class="o">=</span> <span class="c1"># how many pixels of the image are from top of the scan</span>
<a id="__codelineno-6-5" name="__codelineno-6-5" href="#examples_direct-__codelineno-6-5"></a><span class="n">scan_array_A</span><span class="o">=</span><span class="n">pypty</span><span class="o">.</span><span class="n">initialize</span><span class="o">.</span><span class="n">get_grid_for_upsampled_image</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">,</span> <span class="n">image</span><span class="p">,</span> <span class="n">image_pixel_size</span><span class="o">=</span><span class="n">image_pixel_size</span><span class="p">,</span> <span class="n">left_zero_of_scan_grid</span><span class="o">=</span><span class="n">left_zero_of_scan_grid</span><span class="p">,</span> <span class="n">top_zero_of_scan_grid</span><span class="o">=</span><span class="n">top_zero_of_scan_grid</span><span class="p">)</span>
<a id="__codelineno-6-6" name="__codelineno-6-6" href="#examples_direct-__codelineno-6-6"></a>
<a id="__codelineno-6-7" name="__codelineno-6-7" href="#examples_direct-__codelineno-6-7"></a><span class="n">pypty_params</span> <span class="o">=</span>  <span class="n">pypty</span><span class="o">.</span><span class="n">initialize</span><span class="o">.</span><span class="n">get_ptycho_obj_from_scan</span><span class="p">(</span><span class="n">pypty_params</span><span class="p">,</span> <span class="n">array_phase</span><span class="o">=</span><span class="n">image</span><span class="p">,</span> <span class="n">array_abs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">scan_array_A</span><span class="o">=</span><span class="n">scan_array_A</span><span class="p">)</span>
</code></pre></div>
<p>You can also manually specify the initial guess by providing keys like <code>"obj"</code>, <code>"probe"</code> or <code>"positions"</code>, for more see <a href="#custom_presets">Guide for creating custom presets</a>.</p>
<p>These direct methods are essential tools in PyPty for rapid insight and as a starting point for more advanced reconstructions. You can combine them with iterative pipelines by injecting results into the initialization phase.</p></section><section class="print-page" id="custom_presets" heading-number="5"><h1 id="custom_presets-pypty-parameters-for-creating-custom-presets"><strong><em>PyPty Parameters for Creating Custom Presets</em></strong><a class="headerlink" href="#custom_presets-pypty-parameters-for-creating-custom-presets" title="Permanent link">&para;</a></h1>
<hr />
<p>In PyPty, all functions operate using a dictionary that defines your reconstruction setup. This dictionary is typically named <code>pypty_params</code>.</p>
<p>The core function for running iterative ptychographic reconstruction is <a href="#reference-iterative"><code>pypty.iterative.run()</code></a>, which accepts <code>pypty_params</code> as its single argument.</p>
<p>For simple setups, we recommend using the <a href="#reference-initialize"><code>pypty.initialize</code></a> module, which helps generate common parameters and arrays automatically. However, for more complex or custom experiments, this guide explains how to construct your own <code>pypty_params</code> dictionary manually.</p>
<hr />
<h2 id="custom_presets-lambda-type-parameters-in-pypty">Lambda-Type Parameters in PyPty<a class="headerlink" href="#custom_presets-lambda-type-parameters-in-pypty" title="Permanent link">&para;</a></h2>
<p>Before diving into parameter details, it's important to understand a special type of input PyPty supports: <strong>lambda-type parameters</strong>.</p>
<p>Because PyPty is iterative, some parameters can be adjusted depending on the current epoch. To do this, use a lambda function that takes the current epoch number as input and returns a value dynamically.</p>
<h3 id="custom_presets-example">Example<a class="headerlink" href="#custom_presets-example" title="Permanent link">&para;</a></h3>
<p>To apply the <code>smart_memory</code> flag only every 10 epochs, set it like this:</p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#custom_presets-__codelineno-0-1"></a><span class="n">smart_memory</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">%</span> <span class="mi">10</span> <span class="o">==</span> <span class="mi">0</span><span class="p">;</span>
</code></pre></div>
<p>The parameters that can be written in this way are marked as <code>pypty_lambda</code> <strong>type</strong> in the  <strong>Default Data Type</strong> column. They can also be specified as a sting containing the code, e.g. </p>
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#custom_presets-__codelineno-1-1"></a><span class="n">smart_memory</span><span class="p">:</span> <span class="s2">&quot;lambda x: x % 10 == 0&quot;</span><span class="p">;</span>
</code></pre></div>
<blockquote>
<p><strong>Important Note on Lambda Usage</strong><br />
We do not recommend toggling constraints or critical parameters every few epochs. Doing so can interfere with PyPty’s BFGS optimizer, which builds a Hessian matrix based on parameter continuity. Sudden changes can disrupt convergence and lead to suboptimal results.</p>
</blockquote>
<p>Instead, design lambda functions so that once a parameter is activated, it <strong>remains consistently enabled</strong> for the rest of the reconstruction. This ensures smooth optimization behavior and compatibility with the underlying solver.</p>
<p>For example, to enable a parameter starting at epoch 20 and keep it active afterward:</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1" href="#custom_presets-__codelineno-2-1"></a><span class="s2">&quot;atv_weight&quot;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="mf">1e-3</span><span class="o">*</span><span class="p">(</span><span class="n">x</span> <span class="o">&gt;=</span> <span class="mi">20</span><span class="p">)</span>
</code></pre></div>
This pattern is ideal for turning on advanced features or constraints after an initialization period without destabilizing the optimization.</p>
<h2 id="custom_presets-full-list-of-paramerers-for-pyptyiterativerun">Full list of paramerers for pypty.iterative.run()<a class="headerlink" href="#custom_presets-full-list-of-paramerers-for-pyptyiterativerun" title="Permanent link">&para;</a></h2>
<hr />
<h3 id="custom_presets-dataset">Dataset<a class="headerlink" href="#custom_presets-dataset" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>data_path</code></td>
<td><code>""</code></td>
<td><code>str</code></td>
<td>Path to the dataset. It can be an <code>.h5</code> file with a dataset named <code>"data"</code> containing a <strong>3D measurement array</strong> <code>(N_measurements, y, x)</code>. Another option is a <strong>4D <code>.npy</code> array</strong> or a <strong>3D <code>.npy</code> array</strong>.</td>
</tr>
<tr>
<td><code>dataset</code></td>
<td><code>None</code></td>
<td><code>numpy-array</code> or None</td>
<td>If you don't want to store data on disk, you can attach a numpy-array with your data to the parameters. If it's provided, <code>data_path</code> is ignored.</td>
</tr>
<tr>
<td><code>masks</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>Masks (virtual detectors) used for data compression. For uncompressed data, leave it as <code>None</code>.</td>
</tr>
<tr>
<td><code>data_multiplier</code></td>
<td><code>1</code></td>
<td><code>float</code></td>
<td>Multiplier for data values. Used to rescale patterns on the fly without modifying the stored dataset. All patterns will be multiplied by this number.</td>
</tr>
<tr>
<td><code>data_pad</code></td>
<td><code>0</code></td>
<td><code>int</code></td>
<td>Padding applied to data. Use it to pad patterns on the fly without modifying the stored dataset. We recommend setting it to <strong>1/4 of the pattern width</strong> for optimal sampling conditions in far-field mode.</td>
</tr>
<tr>
<td><code>data_bin</code></td>
<td><code>1</code></td>
<td><code>int</code></td>
<td>Binning factor for data. Used to bin patterns on the fly without modifying the stored dataset. All patterns will be binned by this number.</td>
</tr>
<tr>
<td><code>flip_ky</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>Flag indicating that one has to flip <code>ky</code>. Useful if patterns are flipped and you don’t want to modify the stored dataset. Another option is to create a PyPty-style <code>.h5</code> dataset.</td>
</tr>
<tr>
<td><code>data_shift_vector</code></td>
<td><code>[0,0]</code></td>
<td><code>list</code></td>
<td>Shift vector (list with two-values) applied to measurements. Used to shift patterns on the fly without modifying the stored dataset. All patterns will be shifted by the specified number of pixels.</td>
</tr>
<tr>
<td><code>upsample_pattern</code></td>
<td><code>1</code></td>
<td><code>int</code></td>
<td>Upsampling factor. If the beam footprint is larger than the extent (in far-field mode), this allows to artificially upsample the beam in reciprocal space. <strong>Experimental feature!</strong> Windowing constraints may be required.</td>
</tr>
<tr>
<td><code>sequence</code></td>
<td><code>None</code></td>
<td><code>list</code> or <code>None</code> or <code>pypty_lambda</code></td>
<td>Sequence used in data processing. This is a list indicating the measurements that will be used for iterative refinement. If <code>None</code>, all measurements contribute. This parameter is useful for reconstructions on subscans without creating additional data files.</td>
</tr>
<tr>
<td><code>use_full_FOV</code></td>
<td><code>True</code></td>
<td><code>bool</code></td>
<td>Boolean flag. Only useful if a sequence is provided. If <code>True</code>, the object can accommodate all measurements. If <code>False</code>, the object accommodates only selected measurements.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-saving-and-printing">Saving and Printing<a class="headerlink" href="#custom_presets-saving-and-printing" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>output_folder</code></td>
<td><code>""</code></td>
<td><code>str</code></td>
<td>Path to the folder where output files will be saved.</td>
</tr>
<tr>
<td><code>save_loss_log</code></td>
<td><code>True</code></td>
<td><code>bool</code></td>
<td>Boolean flag. If <code>True</code>, the loss log will be saved as <code>loss.csv</code>.</td>
</tr>
<tr>
<td><code>epoch_prev</code></td>
<td><code>0</code></td>
<td><code>int</code></td>
<td>Previous epoch count. Useful for restarting a reconstruction.</td>
</tr>
<tr>
<td><code>save_checkpoints_every_epoch</code></td>
<td><code>False</code></td>
<td><code>bool</code>   or <code>int</code></td>
<td>Save checkpoints every epoch. If <code>True</code>, checkpoints will be always saved, if it is provided as an integer, checkpoints will be saved every n'th epoch.</td>
</tr>
<tr>
<td><code>save_inter_checkpoints</code></td>
<td><code>True</code></td>
<td><code>bool</code>  or <code>int</code></td>
<td>Save intermediate <strong>overwritable</strong> checkpoints. This will create <code>.npy</code> arrays: <code>co.npy</code> for the object, <code>cp.npy</code> for the probe, <code>cg.npy</code> for the scan grid, <code>ct.npy</code> for the tilts, <code>cs.npy</code> for the static background, and <code>cb.npy</code> for the beam current. If <code>True</code>, checkpoints will be always saved, if it is provided as an integer, checkpoints will be saved every n'th epoch.</td>
</tr>
<tr>
<td><code>print_flag</code></td>
<td><code>3</code></td>
<td><code>int</code></td>
<td>Print verbosity level: <code>0</code> for no printing, <code>1</code> for one overwritable line, <code>2</code> and <code>3</code> for moderate output. <code>4</code> gives the most detailed output.</td>
</tr>
<tr>
<td><code>strip_dataset_from_params</code></td>
<td><code>True</code></td>
<td><code>bool</code></td>
<td>If True, omit the dataset from the saved parameters file to reduce file size.</td>
</tr>
<tr>
<td><code>data_simulation_flag</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>If True, run in data simulation mode; skip loading actual measurement data.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-experimental-parameters">Experimental Parameters<a class="headerlink" href="#custom_presets-experimental-parameters" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>acc_voltage</code></td>
<td><code>60</code></td>
<td><code>float</code></td>
<td>Acceleration voltage in kV.</td>
</tr>
<tr>
<td><code>aperture_mask</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>Mask for the aperture. Can be used for reciprocal probe constaint later (see section constraints).</td>
</tr>
<tr>
<td><code>recon_type</code></td>
<td><code>"far_field"</code></td>
<td><code>str</code></td>
<td>Type of reconstruction. Options: <code>"far_field"</code> or <code>"near_field"</code>.</td>
</tr>
<tr>
<td><code>alpha_near_field</code></td>
<td><code>0.0</code></td>
<td><code>float</code></td>
<td>Alpha parameter for near-field reconstruction &amp; flux preservation.</td>
</tr>
<tr>
<td><code>defocus_array</code></td>
<td><code>np.array([0.0])</code></td>
<td><code>numpy.ndarray</code></td>
<td>Array of defocus values for near-field measurement. Irrelevant for far-field. It can contain either a single common defocus value for all measurements or individual values for each measurement. <strong>Units: Angstroms.</strong></td>
</tr>
<tr>
<td><code>Cs</code></td>
<td><code>0.0</code></td>
<td><code>float</code></td>
<td>Spherical aberration coefficient. <strong>Units: Angstroms.</strong></td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-spatial-calibration">Spatial Calibration<a class="headerlink" href="#custom_presets-spatial-calibration" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>slice_distances</code></td>
<td><code>np.array([10.0])</code></td>
<td><code>numpy.ndarray</code></td>
<td>Distances between object slices. <strong>Units: Angstroms.</strong> You can specify a single value common for all slices or provide individual values.</td>
</tr>
<tr>
<td><code>pixel_size_x_A</code></td>
<td><code>1.0</code></td>
<td><code>float</code></td>
<td>Pixel size in the <strong>x-direction</strong> (<strong>Angstroms</strong>).</td>
</tr>
<tr>
<td><code>pixel_size_y_A</code></td>
<td><code>1.0</code></td>
<td><code>float</code></td>
<td>Pixel size in the <strong>y-direction</strong> (<strong>Angstroms</strong>).</td>
</tr>
<tr>
<td><code>scan_size</code></td>
<td><code>None</code></td>
<td><code>tuple</code> or <code>None</code></td>
<td>Tuple describing the number of scan points in <strong>y- and x- directions</strong>. Required for constraining positions and tilts.</td>
</tr>
<tr>
<td><code>num_slices</code></td>
<td><code>1</code></td>
<td><code>int</code></td>
<td>Number of slices in the object.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-refinable-arrays">Refinable Arrays<a class="headerlink" href="#custom_presets-refinable-arrays" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>obj</code></td>
<td><code>np.ones((1, 1, num_slices, 1))</code></td>
<td><code>numpy.ndarray</code></td>
<td>Initial guess for the transmission function to be retrieved. Shape: <code>(y, x, z, modes)</code>. If the <code>y</code> and <code>x</code> dimensions are insufficient for the scan grid, the object will be padded with ones.</td>
</tr>
<tr>
<td><code>probe</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>Real-space probe. Shape: <code>(y, x, modes)</code>. For advanced experiments, the probe can be 4D <code>(y, x, modes, subscans)</code>. If <code>None</code>, PyPty will automatically initialize the beam from the dataset.</td>
</tr>
<tr>
<td><code>positions</code></td>
<td><code>np.array([[0.0, 0.0]])</code></td>
<td><code>numpy.ndarray</code></td>
<td>Scan positions in <strong>pixels</strong> of the reconstruction. Shape: <code>[N_measurements, 2]</code>, formatted as <code>[[y0, x0], [y1, x1], ..., [yn, xn]]</code>. Single-shot experiments can define one common scan point, e.g., <code>[[0,0]]</code>.</td>
</tr>
<tr>
<td><code>tilts</code></td>
<td><code>np.array([[0.0, 0.0, 0.0, 0.0, 0.0, 0.0]])</code></td>
<td><code>numpy.ndarray</code></td>
<td>Tilt angles in <strong>real and reciprocal spaces</strong>. There are 3 types of tilts in PyPty framework: before, inside and after. First one is a beam tilt before the specimen, i.e. a shift in aperture plane. Second type is a tilt inside of a specimen, i.e. after each slice the beam is shifted in real space. Third type is a post-specimen tilt i.e. a shift in a detector plane.  All three types of shifts are contained in this tilt array. Shape:  <code>[N_measurements, 6]</code>. Format: <code>[[y0_before, x0_before, y0_inside, x0_inside, y0_after, x0_after], ..., [yN, xN]]</code>. Single-shot experiments can define one common tilt (with shape <code>[1, 6]</code>).</td>
</tr>
<tr>
<td><code>tilt_mode</code></td>
<td><code>0</code></td>
<td><code>int</code></td>
<td>Mode for applying tilts: <code>0, 3, 4</code> for <strong>inside</strong>, <code>2, 4</code> for <strong>before</strong>, and <code>1, 3, 4</code> for <strong>after</strong> the specimen.</td>
</tr>
<tr>
<td><code>static_background</code></td>
<td><code>0</code></td>
<td><code>numpy.ndarray</code> or <code>float</code></td>
<td>Static background intensity. Shape should match initial patterns but padded by <code>data_pad//upsample_pattern</code>. Use <code>0</code> for no static offset. If provided as postive float, the algorithm will initialize the backgrund with a proper shape on its own.</td>
</tr>
<tr>
<td><code>beam_current</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>Accounts for different currents (or exposure times) during measurements. If provided, must be a <strong>1D array</strong> with length matching <code>N_measurements</code>.</td>
</tr>
<tr>
<td><code>puzzle_positions</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>Optional override of scan positions for puzzle-based scanning patterns.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-propagation-shifting-and-resizing">Propagation, Shifting, and Resizing<a class="headerlink" href="#custom_presets-propagation-shifting-and-resizing" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>propmethod</code></td>
<td><code>"multislice"</code></td>
<td><code>str</code></td>
<td>Wave propagation method. Currently the only option is <code>"multislice"</code>.</td>
</tr>
<tr>
<td><code>allow_subPixel_shift</code></td>
<td><code>True</code></td>
<td><code>bool</code></td>
<td>Allow <strong>subpixel shifts</strong>. If <code>False</code>, positions will be rounded to integers until refined.</td>
</tr>
<tr>
<td><code>dynamically_resize_yx_object</code></td>
<td><code>False</code></td>
<td><code>bool</code> or <code>int</code>  or <code>pypty_lambda</code></td>
<td>If position updates become too large, the object will be padded to accommodate the new scan grid. If set to a <strong>positive integer</strong>, resizing occurs when position updates exceed this value.</td>
</tr>
<tr>
<td><code>extra_space_on_side_px</code></td>
<td><code>0</code></td>
<td><code>int</code></td>
<td>Extra space added around the object in <strong>pixels</strong>.</td>
</tr>
<tr>
<td><code>skip_preprocessing</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>If True, skip all preprocessing steps such as padding and upsampling.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-bandwidth-limitation">Bandwidth Limitation<a class="headerlink" href="#custom_presets-bandwidth-limitation" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>damping_cutoff_multislice</code></td>
<td><code>2/3</code></td>
<td><code>float</code></td>
<td>Frequency cutoff for <strong>multislice beam propagation</strong>. Values larger than <code>2/3</code> can cause aliasing artifacts. Recommended <strong>≤ 2/3</strong>.</td>
</tr>
<tr>
<td><code>smooth_rolloff</code></td>
<td><code>0</code></td>
<td><code>float</code></td>
<td>Rolloff parameter for smooth frequency cutoffs.</td>
</tr>
<tr>
<td><code>update_extra_cut</code></td>
<td><code>0.005</code></td>
<td><code>float</code></td>
<td>Extra frequency cutoff for the <strong>full object</strong>. Ensures bandwidth limitation beyond the <strong>cropped ROIs</strong> of the multislice object.</td>
</tr>
<tr>
<td><code>lazy_clean</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>If <code>True</code>, the full transmission function <strong>will not</strong> be bandwidth-limited (only cropped ROIs will be). <strong>Recommended: <code>False</code></strong>.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-optimization-settings">Optimization Settings<a class="headerlink" href="#custom_presets-optimization-settings" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>algorithm</code></td>
<td><code>"lsq_sqrt"</code></td>
<td><code>str</code></td>
<td>Error metric for reconstruction comparison. Options: <code>"lsq_sqrt"</code> (Gaussian), <code>"ml"</code> (Poisson), <code>"lsq"</code> (classic summed squared error), and <code>"lsq_sqrt_2"</code> (modified Gaussian). If data is compressed via virtual detectors, the only option is <code>"lsq_compressed"</code> (summed squared error  between signals).</td>
</tr>
<tr>
<td><code>epoch_max</code></td>
<td><code>200</code></td>
<td><code>int</code></td>
<td>Maximum number of <strong>epochs (iterations)</strong>.</td>
</tr>
<tr>
<td><code>wolfe_c1_constant</code></td>
<td><code>0.1</code></td>
<td><code>float</code>  or <code>pypty_lambda</code></td>
<td><strong>Wolfe condition parameter (C1)</strong>. Prevents update steps from being too large. Must be <strong>&gt; 0</strong> and <strong>&lt; C2</strong>. Larger values enforce shorter step size.</td>
</tr>
<tr>
<td><code>wolfe_c2_constant</code></td>
<td><code>0.9</code></td>
<td><code>float</code>   or <code>pypty_lambda</code></td>
<td><strong>Wolfe condition parameter (C2)</strong>. Prevents update steps from being too small. Must be <strong>&gt; C1</strong> but <strong>&lt; 1</strong>. Larger values allow larger steps.</td>
</tr>
<tr>
<td><code>loss_weight</code></td>
<td><code>1</code></td>
<td><code>float</code>    or <code>pypty_lambda</code></td>
<td>Weight applied to the <strong>loss function</strong>.</td>
</tr>
<tr>
<td><code>max_count</code></td>
<td><code>20</code></td>
<td><code>int</code> or <code>None</code></td>
<td>Maximum number of forward-backward propagations per <strong>line search iteration</strong>. If exceeded, the update is <strong>rejected</strong> and history is reset. Use <code>None</code> or <code>np.inf</code> to disable.</td>
</tr>
<tr>
<td><code>reduce_factor</code></td>
<td><code>0.1</code></td>
<td><code>float</code></td>
<td>Factor for <strong>reducing step size</strong> when the first Wolfe condition <strong>is not met</strong>.</td>
</tr>
<tr>
<td><code>optimism</code></td>
<td><code>3.0</code></td>
<td><code>float</code></td>
<td>Factor for <strong>increasing step size</strong> when the second Wolfe condition <strong>is not met</strong>. To prevenet algorithm from going back and forth during linesearch, multiplication of optimism and reduce_factor (or of any powers of them) should not be equal to 1.</td>
</tr>
<tr>
<td><code>min_step</code></td>
<td><code>1e-20</code></td>
<td><code>float</code></td>
<td><strong>Minimum step size</strong>. If the step falls below this value, the algorithm <strong>resets history</strong>. Use <code>0</code> to disable.</td>
</tr>
<tr>
<td><code>hist_length</code></td>
<td><code>10</code></td>
<td><code>int</code> or <code>np.inf</code> or <code>pypty_lambda</code></td>
<td><strong>BFGS optimization history length</strong>. Values: <code>0</code> (Gradient Descent), <code>1</code> (Conjugate Gradient), <code>N&gt;1</code> (Limited-memory BFGS), <code>np.inf</code> (Full BFGS).</td>
</tr>
<tr>
<td><code>update_step_bfgs</code></td>
<td><code>1</code></td>
<td><code>float</code> or <code>pypty_lambda</code></td>
<td>Common step applied to all refinable quantities. By default, after the first iteration, a Barzilai-Borwein method is used to inistialize the inverse Hessian, so most of the time, an update step of 1 should be accepted. Only during the very first iteration the linesearch might take some time to find an appropriate step.</td>
</tr>
<tr>
<td><code>phase_only_obj</code></td>
<td><code>False</code></td>
<td><code>bool</code> or <code>pypty_lambda</code></td>
<td>Whether to consider the object as phase-only.</td>
</tr>
<tr>
<td><code>tune_only_probe_phase</code></td>
<td><code>False</code></td>
<td><code>bool</code> or <code>pypty_lambda</code></td>
<td>Optimize only the reciprocal-space phase (CTF) of the probe.</td>
</tr>
<tr>
<td><code>tune_only_probe_abs</code></td>
<td><code>False</code></td>
<td><code>bool</code> or <code>pypty_lambda</code></td>
<td>Optimize only the reciprocal-space amplitude (aperture) of the probe.</td>
</tr>
<tr>
<td><code>reset_history_flag</code></td>
<td><code>False</code></td>
<td><code>bool</code> or <code>pypty_lambda</code></td>
<td>Flag to reset optimization history. See section "lambda-types" in this document. If provided, history will be manually resetted.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-updating-refinable-arrays">Updating Refinable Arrays<a class="headerlink" href="#custom_presets-updating-refinable-arrays" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>update_probe</code></td>
<td><code>1</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>Whether to update the <strong>probe</strong> (<code>1</code> for yes, <code>0</code> for no).</td>
</tr>
<tr>
<td><code>update_obj</code></td>
<td><code>1</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>Whether to update the <strong>object</strong> (<code>1</code> for yes, <code>0</code> for no).</td>
</tr>
<tr>
<td><code>update_probe_pos</code></td>
<td><code>0</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>Whether to update <strong>probe positions</strong> (<code>1</code> for yes, <code>0</code> for no).</td>
</tr>
<tr>
<td><code>update_tilts</code></td>
<td><code>0</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>Whether to update <strong>tilt angles</strong> (<code>1</code> for yes, <code>0</code> for no).</td>
</tr>
<tr>
<td><code>update_beam_current</code></td>
<td><code>0</code></td>
<td><code>bool</code>    or <code>pypty_lambda</code></td>
<td>Whether to update <strong>beam current</strong> (<code>1</code> for yes, <code>0</code> for no).</td>
</tr>
<tr>
<td><code>update_aberrations_array</code></td>
<td><code>0</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>Whether to update <strong>aberration array</strong> (<code>1</code> for yes, <code>0</code> for no).</td>
</tr>
<tr>
<td><code>update_static_background</code></td>
<td><code>0</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>Whether to update <strong>static background</strong> (<code>1</code> for yes, <code>0</code> for no).</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-multiple-illumination-functions">Multiple Illumination Functions<a class="headerlink" href="#custom_presets-multiple-illumination-functions" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>aberrations_array</code></td>
<td><code>np.array([[0.0]])</code></td>
<td><code>numpy.ndarray</code></td>
<td>Array of aberration values for multiple beams. Useful for large fields of view where the beam changes. Shape: <code>[N_subscans, N_aberrations]</code>.</td>
</tr>
<tr>
<td><code>phase_plate_in_h5</code></td>
<td><code>None</code></td>
<td><code>str</code> or <code>None</code></td>
<td>Path to an <strong>HDF5 file</strong> containing phase plates for different measurements. Dataset name should be <code>"configs"</code>. Shape: <code>[N_measurements, Y_probe, X_probe]</code>.</td>
</tr>
<tr>
<td><code>aberration_marker</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td><strong>Marker for multiple CTFs</strong>. Should be a <strong>1D array</strong> of length <code>N_measurements</code>, where each entry corresponds to a CTF index in <code>aberrations_array</code>.</td>
</tr>
<tr>
<td><code>probe_marker</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td><strong>Marker for probe variations</strong>. If provided, the probe should have shape <code>[y, x, modes, N_subscans]</code>, and this array should contain indices specifying which probe to use for each measurement.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-memory-usage">Memory Usage<a class="headerlink" href="#custom_presets-memory-usage" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>load_one_by_one</code></td>
<td><code>True</code></td>
<td><code>bool</code></td>
<td>If <code>True</code>, data is <strong>loaded dynamically</strong> to save GPU memory. If <code>False</code>, all data is loaded at once (faster but memory-intensive).</td>
</tr>
<tr>
<td><code>smart_memory</code></td>
<td><code>True</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>If <code>True</code>, <strong>memory is managed intelligently</strong>, clearing cache when necessary to prevent memory fragmentation.</td>
</tr>
<tr>
<td><code>remove_fft_cache</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>If <code>True</code>, <strong>FFT cache is removed</strong> periodically to save memory. <strong>(Experimental feature)</strong></td>
</tr>
<tr>
<td><code>compute_batch</code></td>
<td><code>"auto"</code></td>
<td><code>int</code> or <code>str</code></td>
<td><strong>Batch size for multislice computation.</strong> Default value "auto" will automatically estimate a value that would fit into your memory, but ideally one should balance it by hand for a particular GPU. Increasing this can speed up reconstruction but requires more GPU memory. Super large values are also useless as at some point you will reash the limit the compute capability.</td>
</tr>
<tr>
<td><code>force_dataset_dtype</code></td>
<td><code>default_float_cpu</code></td>
<td><code>numpy.dtype</code></td>
<td>Forces the dataset to be stored in a specified <strong>data type</strong>. Can help reduce memory usage at the cost of precision.</td>
</tr>
<tr>
<td><code>preload_to_cpu</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>If <code>True</code>, <strong>preloads data to CPU</strong> before transferring it to GPU, improving transfer speeds for <code>.h5</code> datasets.</td>
</tr>
<tr>
<td><code>force_pad</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>If <code>True</code>, pads data <strong>at the start</strong> of reconstruction (uses more memory but speeds up computation). If <code>False</code>, padding is applied <strong>on the fly</strong> to save memory.</td>
</tr>
<tr>
<td><code>memory_saturation</code></td>
<td><code>0.7</code></td>
<td><code>float</code></td>
<td>If compute batch is set to <code>"auto"</code>, this ratio will be used to estimate a compute batch that would requiere <code>memory_saturation</code> of the avalible GPU memory. If <code>compute_batch</code> is integer, <code>memory_saturation</code> is ignored.</td>
</tr>
<tr>
<td><code>backend</code></td>
<td><code>gpu</code></td>
<td><code>string</code></td>
<td>A backend for linesearch (gpu or cpu). The computation of gradients <strong>always</strong> happens on a GPU if the code can automatically detect one. This parameters controlls how the previous estimates (history) are stored. For small dataset it may make sense to store all data on a GPU, but for larger datasets one excepts to spend most of the time computing the gradients. Setting the cpu backend will make the linesearch part slower, but will free some memory that can be used for a much heavier computation.</td>
</tr>
<tr>
<td><code>default_dtype</code></td>
<td><code>"double"</code></td>
<td><code>str</code></td>
<td>Default data type for computations. Another option is <code>"single"</code>.</td>
</tr>
<tr>
<td>---</td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h3 id="custom_presets-constraints-contributing-to-the-loss">Constraints Contributing to the Loss<a class="headerlink" href="#custom_presets-constraints-contributing-to-the-loss" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>mixed_variance_weight</code></td>
<td><code>0</code></td>
<td><code>float</code>   or <code>pypty_lambda</code></td>
<td>Regularization weight that prevents <strong>low-frequency variations</strong> between object states.</td>
</tr>
<tr>
<td><code>mixed_variance_sigma</code></td>
<td><code>0.5</code></td>
<td><code>float</code>   or <code>pypty_lambda</code></td>
<td>Controls the <strong>spatial frequency range</strong> affected by <code>mixed_variance_weight</code>.</td>
</tr>
<tr>
<td><code>probe_constraint_mask</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>Mask for <strong>probe constraint in reciprocal space</strong>. Masked pixels are <strong>regularized using L2 norm</strong>.</td>
</tr>
<tr>
<td><code>probe_reg_constraint_weight</code></td>
<td><code>0</code></td>
<td><code>float</code></td>
<td>L2 regularization weight for the <strong>probe in reciprocal space</strong>.</td>
</tr>
<tr>
<td><code>window_weight</code></td>
<td><code>0</code></td>
<td><code>float</code>   or <code>pypty_lambda</code></td>
<td>L2 regularization weight for the <strong>probe in real space</strong>.</td>
</tr>
<tr>
<td><code>window</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code> or or <code>pypty_lambda</code></td>
<td><strong>Window function</strong> used to constrain the probe in real space. Masked pixels are damped using L2 regularization. It can be either a 2d- real valued array with the same shape as upsampled and padded beam <strong>or</strong> a list containing two values: inner radius (fraction) and outer radius (fraction). Fractions will be multiplied with half of the probe width, everything inside of window will be kept intact, everything outside will be zeroed and intermediate values will be slighly damped.</td>
</tr>
<tr>
<td><code>abs_norm_weight</code></td>
<td><code>0</code></td>
<td><code>float</code></td>
<td>L1 regularization weight applied to the <strong>absorptive potential</strong> (negative log of the transmission function’s absolute value).</td>
</tr>
<tr>
<td><code>phase_norm_weight</code></td>
<td><code>0</code></td>
<td><code>float</code>   or <code>pypty_lambda</code></td>
<td>L1 regularization weight applied to the <strong>phase of the object</strong>.</td>
</tr>
<tr>
<td><code>atv_weight</code></td>
<td><code>0</code></td>
<td><code>float</code>   or <code>pypty_lambda</code></td>
<td>Weight for <strong>Adaptive Total Variation (ATV)</strong> regularization on the transmission function.</td>
</tr>
<tr>
<td><code>atv_q</code></td>
<td><code>1</code></td>
<td><code>float</code>   or <code>pypty_lambda</code></td>
<td>ATV <strong>q parameter</strong> (controls the strength of smoothing). Recommended: <code>1</code>.</td>
</tr>
<tr>
<td><code>atv_p</code></td>
<td><code>2</code></td>
<td><code>float</code>  or <code>pypty_lambda</code></td>
<td>ATV <strong>p parameter</strong> (<code>1</code> = L1-like regularization, <code>2</code> = L2-like smoothing). Recommended: <code>2</code>.</td>
</tr>
<tr>
<td><code>fast_axis_reg_weight_positions</code></td>
<td><code>0</code></td>
<td><code>float</code> or <code>pypty_lambda</code></td>
<td>Regularization weight for <strong>fast-axis scan positions</strong>. Reduces the acceleration along one line.</td>
</tr>
<tr>
<td><code>slow_axis_reg_weight_positions</code></td>
<td><code>0</code></td>
<td><code>float</code> or <code>pypty_lambda</code></td>
<td>Regularization weight for <strong>slow-axis scan positions</strong>. Reduces the acceleration along one column.</td>
</tr>
<tr>
<td><code>fast_axis_reg_weight_tilts</code></td>
<td><code>0</code></td>
<td><code>float</code>  or <code>pypty_lambda</code></td>
<td>Regularization weight for <strong>fast-axis tilts</strong>. Reduces the acceleration along one line.</td>
</tr>
<tr>
<td><code>slow_axis_reg_weight_tilts</code></td>
<td><code>0</code></td>
<td><code>float</code>  or <code>pypty_lambda</code></td>
<td>Regularization weight for <strong>slow-axis tilts</strong>. Reduces the acceleration along one column.</td>
</tr>
<tr>
<td><code>deformation_reg_weight_positions</code></td>
<td><code>0</code></td>
<td><code>float</code>  or <code>pypty_lambda</code></td>
<td>Regularization weight for enfourcing a regular (but deformed) <strong>scan</strong> grid.</td>
</tr>
<tr>
<td><code>deformation_reg_weight_tilts</code></td>
<td><code>0</code></td>
<td><code>float</code>  or <code>pypty_lambda</code></td>
<td>Regularization weight for enfourcing a regular (but deformed) <strong>tilts</strong> grid.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-constraints-that-modify-the-object-and-probe-by-hand">Constraints That Modify the Object and Probe 'By Hand'<a class="headerlink" href="#custom_presets-constraints-that-modify-the-object-and-probe-by-hand" title="Permanent link">&para;</a></h3>
<p><strong>Warning:</strong> These constraints <strong>reset the BFGS history</strong> when applied.</p>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>apply_gaussian_filter</code></td>
<td><code>False</code></td>
<td><code>bool</code>   or <code>pypty_lambda</code></td>
<td>Applies a <strong>Gaussian filter</strong> to the <strong>phase</strong> of the object.</td>
</tr>
<tr>
<td><code>apply_gaussian_filter_amplitude</code></td>
<td><code>False</code></td>
<td><code>bool</code>    or <code>pypty_lambda</code></td>
<td>Applies a <strong>Gaussian filter</strong> to the <strong>amplitude</strong> of the object.</td>
</tr>
<tr>
<td><code>beta_wedge</code></td>
<td><code>0</code></td>
<td><code>float</code>  or <code>pypty_lambda</code></td>
<td><strong>Removes high kz frequencies</strong> for low kx and ky in <strong>3D object FFTs</strong>.</td>
</tr>
<tr>
<td><code>keep_probe_states_orthogonal</code></td>
<td><code>False</code></td>
<td><code>bool</code>  or <code>pypty_lambda</code></td>
<td>Enforces <strong>orthogonality of probe modes</strong>.</td>
</tr>
<tr>
<td><code>do_charge_flip</code></td>
<td><code>False</code></td>
<td><code>bool</code></td>
<td>Performs <strong>charge flipping</strong> on the object.</td>
</tr>
<tr>
<td><code>cf_delta_phase</code></td>
<td><code>0.1</code></td>
<td><code>float</code></td>
<td><strong>Delta phase</strong> for charge flipping.</td>
</tr>
<tr>
<td><code>cf_delta_abs</code></td>
<td><code>0.01</code></td>
<td><code>float</code></td>
<td><strong>Delta amplitude</strong> for charge flipping.</td>
</tr>
<tr>
<td><code>do_charge_flip</code></td>
<td><code>False</code></td>
<td><code>bool</code>      or <code>pypty_lambda</code></td>
<td>Perform charge flipping on the object.</td>
</tr>
<tr>
<td><code>cf_delta_phase</code></td>
<td><code>0.1</code></td>
<td><code>float</code> or <code>pypty_lambda</code></td>
<td>Delta phase for charge flipping.</td>
</tr>
<tr>
<td><code>cf_delta_abs</code></td>
<td><code>0.01</code></td>
<td><code>float</code> or <code>pypty_lambda</code></td>
<td>Delta amplitude for charge flipping.</td>
</tr>
<tr>
<td><code>cf_beta_phase</code></td>
<td><code>-0.95</code></td>
<td><code>float</code> or <code>pypty_lambda</code></td>
<td>Beta phase parameter for charge flipping.</td>
</tr>
<tr>
<td><code>cf_beta_abs</code></td>
<td><code>-0.95</code></td>
<td><code>float</code> or <code>pypty_lambda</code></td>
<td>Beta amplitude parameter for charge flipping.</td>
</tr>
<tr>
<td><code>fancy_sigma</code></td>
<td><code>None</code></td>
<td><code>None</code> or <code>float</code> oor <code>pypty_lambda</code></td>
<td>Custom sigma parameter to enforce atomicity.</td>
</tr>
<tr>
<td><code>restart_from_vacuum</code></td>
<td><code>False</code></td>
<td><code>bool</code> or <code>pypty_lambda</code></td>
<td><strong>Resets the object to 1</strong> while keeping other parameters unchanged. See section "lambda-types" in this document.</td>
</tr>
<tr>
<td><code>reset_positions</code></td>
<td><code>False</code></td>
<td><code>bool</code> or <code>pypty_lambda</code></td>
<td><strong>Resets the positions to initial guess</strong> while keeping other parameters unchanged. See section "lambda-types" in this document.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="custom_presets-beam-initialization">Beam Initialization<a class="headerlink" href="#custom_presets-beam-initialization" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Parameter</th>
<th>Default Value</th>
<th>Default Data Type</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>n_hermite_probe_modes</code></td>
<td><code>None</code></td>
<td><code>tuple</code> or <code>None</code></td>
<td>Number of <strong>Hermite probe modes</strong>. A tuple <code>[nx, ny]</code> specifying mode orders in <code>x</code> and <code>y</code> directions. If <code>None</code>, no Hermite modes are applied.</td>
</tr>
<tr>
<td><code>defocus_spread_modes</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>1D array with <strong>different defocus values</strong> for initializing probe modes. Useful for simulating <strong>defocus spread</strong> in the beam.</td>
</tr>
<tr>
<td><code>aberrations</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td>1D array of <strong>aberration coefficients</strong> in <strong>Krivanek notation</strong>, e.g., <code>C10, C12a, C12b, C21a, C21b, C23a, C23b, C30</code>. Units: <strong>Angstroms</strong>.</td>
</tr>
<tr>
<td><code>extra_probe_defocus</code></td>
<td><code>0</code></td>
<td><code>float</code></td>
<td>Extra <strong>probe defocus</strong> applied in <strong>Angstroms</strong>. Useful for adjusting initial beam focus in <strong>multislice reconstructions</strong>.</td>
</tr>
<tr>
<td><code>estimate_aperture_based_on_binary</code></td>
<td><code>0</code></td>
<td><code>float</code></td>
<td>If <strong>&gt; 0</strong>, the aperture is estimated <strong>based on a binary threshold</strong>. Pixels in the data larger than <code>mean(data) * estimate_aperture_based_on_binary</code> are considered part of the <strong>aperture</strong>.</td>
</tr>
<tr>
<td><code>beam_ctf</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td><strong>Beam Contrast Transfer Function (CTF).</strong> If provided, must be a <strong>2D NumPy array</strong> with dimensions matching the upsampled probe size.</td>
</tr>
<tr>
<td><code>mean_pattern</code></td>
<td><code>None</code></td>
<td><code>numpy.ndarray</code> or <code>None</code></td>
<td><strong>Mean diffraction pattern</strong> used for probe initialization. If provided, the probe is created using an <strong>inverse Fourier transform</strong> of this pattern.</td>
</tr>
</tbody>
</table>
<hr /></section><section class="print-page" id="incoherent" heading-number="6"><h1 id="incoherent-incoherent-ptychography">Incoherent Ptychography<a class="headerlink" href="#incoherent-incoherent-ptychography" title="Permanent link">&para;</a></h1>
<p>PyPty supports three types of incoherent scattering:</p>
<ul>
<li><strong>Probe modes</strong>: multiple coherent probes</li>
<li><strong>Object modes</strong>: multiple transmission functions</li>
<li><strong>Static background</strong>: uniform parasitic scattering</li>
</ul>
<p>Let (O) be a coherent object and (P) a coherent probe. Define the forward model</p>
<p>[
FM(O, P)
],</p>
<p>which maps object and probe to an intensity pattern. The total measured intensity is then</p>
<p>[
S + \sum_{i,j} FM(O_i, P_j),
]</p>
<p>where:</p>
<ul>
<li>(S) is a static offset common to all patterns,</li>
<li>(O_i) are object modes,</li>
<li>(P_j) are probe modes.</li>
</ul>
<h2 id="incoherent-probe-modes">Probe Modes<a class="headerlink" href="#incoherent-probe-modes" title="Permanent link">&para;</a></h2>
<p>By default, PyPty generates a single coherent probe mode using a calibrated <code>pypty_params</code> dictionary. To use multiple modes, you have three options:</p>
<ol>
<li>
<p><strong>User-defined modes</strong><br />
   Provide an array of shape <code>[Ny, Nx, Nmodes]</code> or <code>[Ny, Nx, Nmodes, Nroi]</code> via the <code>probe_modes</code> key.</p>
</li>
<li>
<p><strong>Defocus spread modes</strong><br />
   Set <code>defocus_spread_modes</code> in <code>pypty_params</code> to a 1D array of defocus values (in Å). PyPty applies different defocus values to generate multiple modes. This can be useful for monolayers or for samples with drift or wobble along the beam propgation direction.</p>
</li>
<li>
<p><strong>Hermite modes</strong><br />
   Specify <code>n_hermite_probe_modes: (order_x, order_y)</code> to generate Hermite polynomials up to the given orders in the x and y directions.</p>
</li>
</ol>
<h2 id="incoherent-static-background">Static Background<a class="headerlink" href="#incoherent-static-background" title="Permanent link">&para;</a></h2>
<p>PyPty models a static incoherent offset in two ways:</p>
<ol>
<li>
<p><strong>User-defined background</strong><br />
   Provide <code>static_background</code> as a 2D array matching your diffraction pattern size (including padding).</p>
</li>
<li>
<p><strong>Automatic initialization</strong><br />
   Set <code>static_background</code> to a float &gt; 1E-7. PyPty will create a randomized background normalized to the total number counts specified by the provided float.</p>
</li>
</ol>
<h2 id="incoherent-object-modes">Object Modes<a class="headerlink" href="#incoherent-object-modes" title="Permanent link">&para;</a></h2>
<p>Reconstructing incoherent object modes requires a well-calibrated probe and accurate positions. Initialization options include:</p>
<ol>
<li>
<p><strong>User-defined modes</strong><br />
   Provide <code>obj</code> as a 4D array of shape <code>(y, x, z, Nmodes)</code> in <code>pypty_params</code> (<strong>after</strong> attached experimental parameters to the preset <code>pypty_params</code>).</p>
</li>
<li>
<p><strong>Automatic initialization</strong><br />
   In <code>experimental_params</code> (<strong>before</strong> appending them to <code>pypty_params</code>), set:</p>
</li>
<li><code>num_obj_modes</code>: integer number of object modes</li>
<li><code>obj_phase_sigma</code>: standard deviation of Gaussian noise for initial phase</li>
</ol>
<p>Ensure each mode starts from a different random seed to avoid identical updates.</p></section><section class="print-page" id="compressed" heading-number="7"><h1 id="compressed-iterative-ptychography-from-virtual-detectors"><strong><em>Iterative Ptychography from Virtual Detectors</em></strong><a class="headerlink" href="#compressed-iterative-ptychography-from-virtual-detectors" title="Permanent link">&para;</a></h1>
<p>PyPty can deal not only with raw 4D-STEM like data, but also with lossy-compression. If you want to perform a reconstruction from data compressed by virtual detectors, you first have to ensure that the array of detectors has shape <code>[N_detectors, k_Y, k_X]</code> and your data has shape <code>[Scan_Y, Scan_X, N_detectors]</code>. Then you should attach these two arrays to experimental parameters.</p>
<p><div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#compressed-__codelineno-0-1"></a><span class="n">experimental_params</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#compressed-__codelineno-0-2"></a>    <span class="s2">&quot;dataset&quot;</span><span class="p">:</span> <span class="n">compressed_data</span><span class="p">,</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#compressed-__codelineno-0-3"></a>    <span class="s2">&quot;masks&quot;</span><span class="p">:</span> <span class="n">virtual_detector_array</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#compressed-__codelineno-0-4"></a>    
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#compressed-__codelineno-0-5"></a>    
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#compressed-__codelineno-0-6"></a>    <span class="c1">###  In this case you must specify one of the following two parameters</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#compressed-__codelineno-0-7"></a>    <span class="s1">&#39;rez_pixel_size_A&#39;</span><span class="p">:</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#compressed-__codelineno-0-8"></a>    <span class="s1">&#39;rez_pixel_size_mrad&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#compressed-__codelineno-0-9"></a>    
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#compressed-__codelineno-0-10"></a>   <span class="c1"># ... Rest of your parameters.</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#compressed-__codelineno-0-11"></a><span class="p">}</span>
</code></pre></div>
Also, you may want to update your reconstruction settings. For Compressed data PyPty has following objective function types:</p>
<table>
<thead>
<tr>
<th>Objective_name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>lsq_compressed</code></td>
<td>Least-squared fit</td>
</tr>
<tr>
<td><code>gauss_compressed</code></td>
<td>Gaussian noise model</td>
</tr>
<tr>
<td><code>poisson_compressed</code></td>
<td>Poissonian noise model</td>
</tr>
</tbody>
</table>
<p>Then you must specify <code>algorithm</code> as one of these three options in <code>pypty_params</code>:
<div class="highlight"><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1" href="#compressed-__codelineno-1-1"></a><span class="n">pypty_params</span><span class="o">=</span><span class="p">{</span>
<a id="__codelineno-1-2" name="__codelineno-1-2" href="#compressed-__codelineno-1-2"></a>        <span class="s2">&quot;algorithm&quot;</span><span class="p">:</span> <span class="s2">&quot;gauss_compressed&quot;</span><span class="p">,</span> 
<a id="__codelineno-1-3" name="__codelineno-1-3" href="#compressed-__codelineno-1-3"></a>        <span class="c1">#... Rest of your parameters</span>
<a id="__codelineno-1-4" name="__codelineno-1-4" href="#compressed-__codelineno-1-4"></a>        <span class="p">}</span>
</code></pre></div>
Then you can launch ptychography with the same <a href="#reference-iterative">pypty.iterative.run</a> function.</p></section>
                    <section class='print-page md-section' id='section-8' heading-number='8'>
                        <h1>API Reference<a class='headerlink' href='#section-8' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="reference-initialize" heading-number="8.1"><h1 id="reference-initialize-pyptyinitialize"><code>pypty.initialize</code><a class="headerlink" href="#reference-initialize-pyptyinitialize" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.initialize"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.create_pypty_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_pypty_data</span></code>

<a href="#reference-initialize-pypty.initialize.create_pypty_data" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a PyPty-style <code>.h5</code> dataset from 4D-STEM data.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to <code>.h5</code> or <code>.npy</code> data file or a 4D numpy array [scan_y, scan_x, ky, kx].</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" optional>str</autoref> or <autoref identifier="ndarray" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_output</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Output file path for the PyPty <code>.h5</code> dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>swap_axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Swap the last two axes (kx, ky). Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flip_ky</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flip the data along specific axes. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flip_kx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flip the data along specific axes. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flip_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flip the data along specific axes. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flip_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flip the data along specific axes. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comcalc_len</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of patterns to use to estimate center-of-mass. Default is 1000.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1000</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Predefined center-of-mass. If None, it will be computed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Predefined center-of-mass. If None, it will be computed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial binning factor on the diffraction patterns. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_left</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Crop edges of patterns. Defaults are None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_right</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Crop edges of patterns. Defaults are None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_top</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Crop edges of patterns. Defaults are None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>crop_bottom</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Crop edges of patterns. Defaults are None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>normalize</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Normalize pattern sums to 1. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff_ratio</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Mask out pixels farther than <code>cutoff_ratio × max_radius</code>. Default is None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" optional>float</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_k</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding to apply to diffraction patterns. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Output data type. Default is np.float32.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>dtype</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.float32" optional hover>float32</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rescale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scale factor for intensity. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exist_ok</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, skip writing if file exists. Default is True.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.create_pypty_data" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Saves a <code>.h5</code> file containing processed 4D-STEM data with standardized formatting for PyPty.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.append_exp_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">append_exp_params</span></code>

<a href="#reference-initialize-pypty.initialize.append_exp_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Attach experimental parameters to a PyPty preset dictionary and calibrate an extisting PyPty preset to new data. </p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>experimental_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary containing experimental metadata and setup for PyPty reconstruction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.append_exp_params" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Existing PyPty preset to update, a filepath to a preset, or None to create a new one.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" optional>dict</autoref> or <autoref identifier="str" optional>str</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.append_exp_params" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated PyPty parameter dictionary.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>experimental_params should contain following entries:</p>
<div class="codehilite"><pre><span></span><code>data_path - path to a PyPty-style 3d .h5 file [N_measurements, ky,kx] or .npy Nion-style 4d-stem dataset (or 3d .npy dataset)

masks - 3d numpy array or None. if data is compressed provide the virtual detectors (masks) shape should be [N_masks,ky,kx]

output_folder - path to an outputfolder where the results will be stored

path_json - path to a nion-style json file with metadata (optional)

acc_voltage - float, accelerating voltage in kV

One or multiple of the following callibrations:
    rez_pixel_size_A - reciprocal pixel size in Å^-1
    rez_pixel_size_mrad - reciprocal pixel size in mrad
    conv_semiangle_mrad - beam convergence semi-angle in mrad
    aperture - (optional)- binary 2D mask
    bright_threshold - threshold to estimate an aperture, everything above threshold times maximum value in a pacbed will be concidered as bright field disk.

data_pad - int, reciprocal space padding. If None (default), pading is 1/4 of the total width of a diffraction pattern
upsample_pattern - int, default 1 (no upsampling)

aberrations - list or 1d numpy array containing beam aberrations (in Å). Aberrations are stored in Krivanek notation, e.g. C10, C12a, C12b, C21a, C21b, C23a, C23b, C30 etc

defocus - float, default 0. Extra probe defocus besides the one contained in aberrations.

scan_size - tuple of two ints, number of scan points along slow (y) and fast (x) axes. Optional. If no scan step or position grid is provided, it will be used to get the scan step

scan_step_A - float, scan step (STEM pixel size) in Å.

fov_nm - float, FOV along the fast axis in nm.

special_postions_A - 2d numpy array, default None. If you acquiered a data on a special non-rectangular grid, please specify the positions in Å via this array for all measurements in a following format: [[y_0,x_0],[y_1,x_1],....[y_n,x_n]]

transform_axis_matrix- 2x2 matrix for postions transformation

PLRotation_deg - float, rotation angle between scan and detector axes. Default None. If None, a DPC measurement will be executed to get this angle. !!!!!!! Note that negative PLRotation_deg values rotate scan counter clockwise and diffraction space clockwise !!!!!!!!!!!

flip_ky - boolean Flag. Default is False. If no PyPty-style h5 data was created, this flag will flip the y-axis of diffraction patterns.

total_thickness - total thickness of a sample in Å. Has no effect if num_slices is 1 and propagation method (pypty_params entry) is multislice

num_slices - integer, number of slices, default is 1.

num_obj_modes - integer, number of object modes, default is None (single mode)

obj_phase_sigma - float, random noise std. used for for object initialization. default is 0

plot - boolean Flag, default is True

print_flag - integer. Default is 1. If 0 nothing will be printed. 1 prints only thelatest state of the computation, 2 prints every state as a separate line. 3 prints the linesearch progress in iterative optimization. 4 prints everything that 3 does and if constraints are applied, it prints how they contribute so that a user can configure the weights properly.

save_preprocessing_files - Boolean Flag. Default is True. 
erase_probe -  Boolean Flag. Default is False. If True, probe will be deleted from provided preset. This is usefull when replicating a reconstruction setting created for a completely different dataset.

chemical_formula - Nexus tag, composition of the sample
sample_name - Nexus tag, name of a sample
</code></pre></div>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.get_offset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_offset</span></code>

<a href="#reference-initialize-pypty.initialize.get_offset" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute pixel offsets between scan grid and reconstruction grid. In PyPty framework, scan grid is usually rotated to compensate the misalignment between scan- and detector- axes. Also, a reconstruction grid is larger than the scanned FOV, this is done to accomodate the extent of the probe. </p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x_range</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan dimensions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.get_offset" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_range</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan dimensions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.get_offset" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_step_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>STEM scan step size in Å.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_offset" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>detector_pixel_size_rezA</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reciprocal space pixel size in Å⁻¹.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_offset" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patternshape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of diffraction patterns.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.initialize.get_offset" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rot_angle_deg</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation between scan and detector axes (degrees).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_offset" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>offy, offx : float</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Offset values (in reconstruction pixels).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.get_positions_pixel_size" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_positions_pixel_size</span></code>

<a href="#reference-initialize-pypty.initialize.get_positions_pixel_size" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate scan positions in reconstruction pixel units.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x_range</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan grid size.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_range</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan grid size.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_step_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>STEM scan step size (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>detector_pixel_size_rezA</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in reciprocal space (Å⁻¹).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patternshape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the diffraction pattern.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rot_angle_deg</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan-detector rotation angle in degrees. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flip_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flip scan axes. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>flip_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flip scan axes. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Print pixel size. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform_axis_matrix</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional 2x2 matrix to apply to positions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>array_like</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.eye" optional hover>eye</autoref>(2)</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Scan positions in reconstruction pixels.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Size of one reconstruction pixel in Å.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.initialize.get_positions_pixel_size" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.get_grid_for_upsampled_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_grid_for_upsampled_image</span></code>

<a href="#reference-initialize-pypty.initialize.get_grid_for_upsampled_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Map coordinates of an upsampled image onto the reconstruction grid.</p>
<p>This function calculates where pixel of an arbitary image (e.g. upsampled tcBF image) will land on a grid corresponding to a ptychographic reconstruction.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary of PyPty reconstruction parameters.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.get_grid_for_upsampled_image" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>2D image (e.g., upsampled tcBF) to map.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.initialize.get_grid_for_upsampled_image" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>image_pixel_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size of the image in Å.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_grid_for_upsampled_image" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>left_zero_of_scan_grid</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel offset on left side of image relative to scan grid. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.get_grid_for_upsampled_image" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top_zero_of_scan_grid</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel offset on top side of image relative to scan grid. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.get_grid_for_upsampled_image" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>sc</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Array of pixel coordinates [[y, x], ...] in reconstruction grid units (pixels of final object).</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.initialize.get_grid_for_upsampled_image" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.get_ptycho_obj_from_scan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ptycho_obj_from_scan</span></code>

<a href="#reference-initialize-pypty.initialize.get_ptycho_obj_from_scan" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Construct an initial object guess using interpolated phase and amplitude maps. You can use output of dpc, wdd of tcBF reconstructions to generate it.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.get_ptycho_obj_from_scan" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slices</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of slices or "auto" to estimate from max phase shift.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or <autoref identifier="str" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array_phase</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>2D phase map to interpolate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.initialize.get_ptycho_obj_from_scan" optional>ndarray</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array_abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>2D amplitude map to interpolate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.initialize.get_ptycho_obj_from_scan" optional>ndarray</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale_phase</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scale factor for phase.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_ptycho_obj_from_scan" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale_abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scale factor for amplitude.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.get_ptycho_obj_from_scan" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_array_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial reference grid for the input maps (in Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fill_value_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding strategy outside scanned region: None, "edge", or "median".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" optional>str</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.get_ptycho_obj_from_scan" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated PyPty parameter dictionary with object guess.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.create_aberrations_chunks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_aberrations_chunks</span></code>

<a href="#reference-initialize-pypty.initialize.create_aberrations_chunks" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create chunks, i.e. multiple subscans with independent beam aberrations. Usefull for large fields of view where the beam is varyying. If applied, the iterative reconstruction will have the same beam in each subscan, but apply a different CTF in each of these regions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.create_aberrations_chunks" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chop_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of each subscan region (in scan points).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_aberrations_chunks" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of aberration coefficients per region.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_aberrations_chunks" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.create_aberrations_chunks" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated parameter dictionary with aberration array and marker.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.create_probe_marker_chunks" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_probe_marker_chunks</span></code>

<a href="#reference-initialize-pypty.initialize.create_probe_marker_chunks" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates chunks, i.e. multiple subscans with independent beam aberrations. Usefull for large fields of view where the beam is varyying. If applied, the iterative reconstruction will have the a differenet beam in each of these subscans.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.create_probe_marker_chunks" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chop_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of each subscan region (in scan points).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_probe_marker_chunks" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.create_probe_marker_chunks" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with probe marker.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.create_sub_sequence" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_sub_sequence</span></code>

<a href="#reference-initialize-pypty.initialize.create_sub_sequence" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Define a measurement subsequence for local reconstructions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sub_sequence" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>left</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Leftmost scan coordinate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sub_sequence" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>top</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Top scan coordinate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sub_sequence" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Width of subregion (in scan points).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sub_sequence" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Height of subregion (in scan points).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sub_sequence" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sub</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sampling factor (take every Nth point).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sub_sequence" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.create_sub_sequence" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated parameter dictionary with <code>sequence</code> key.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.create_sequence_from_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_sequence_from_points</span></code>

<a href="#reference-initialize-pypty.initialize.create_sequence_from_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create scan subsequence around specified feature points.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sequence_from_points" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>yf</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Y-coordinates of feature points (in scan points).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xf</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>X-coordinates of feature points.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width_roi</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Width of the reconstruction window around each point.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.create_sequence_from_points" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>20</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="list" backlink-type="returned-by" backlink-anchor="pypty.initialize.create_sequence_from_points" optional>list</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of scan indices to reconstruct.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.rotate_scan_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">rotate_scan_grid</span></code>

<a href="#reference-initialize-pypty.initialize.rotate_scan_grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply a rigid rotation to the scan grid.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.rotate_scan_grid" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>angle_deg</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation angle in degrees.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.initialize.rotate_scan_grid" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.rotate_scan_grid" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with rotated positions and angle.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.conjugate_beam" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">conjugate_beam</span></code>

<a href="#reference-initialize-pypty.initialize.conjugate_beam" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply beam conjugation (flip defocus and aberrations).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.conjugate_beam" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.conjugate_beam" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with conjugated probe and CTF.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.get_focussed_probe_from_vacscan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_focussed_probe_from_vacscan</span></code>

<a href="#reference-initialize-pypty.initialize.get_focussed_probe_from_vacscan" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reconstruct a focused probe from a vacuum PACBED pattern.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.get_focussed_probe_from_vacscan" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mean_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Measured PACBED from vacuum.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.initialize.get_focussed_probe_from_vacscan" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.get_focussed_probe_from_vacscan" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with a probe estimate.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.append_aperture_to_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">append_aperture_to_params</span></code>

<a href="#reference-initialize-pypty.initialize.append_aperture_to_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Append a measured aperture to the reconstruction parameters.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.append_aperture_to_params" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mean_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Aperture image to be rescaled and added.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.initialize.append_aperture_to_params" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.append_aperture_to_params" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with aperture.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.tiltbeamtodata" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tiltbeamtodata</span></code>

<a href="#reference-initialize-pypty.initialize.tiltbeamtodata" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Align the probe momentum to the center of the measured PACBED pattern.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.tiltbeamtodata" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>align_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Type of alignment ("com" or "cross_corr").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.initialize.tiltbeamtodata" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;com&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.tiltbeamtodata" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with shifted probe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.get_approx_beam_tilt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_approx_beam_tilt</span></code>

<a href="#reference-initialize-pypty.initialize.get_approx_beam_tilt" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Estimate scan-position-dependent beam tilt from PACBED. </p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.initialize.get_approx_beam_tilt" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>power</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Degree of polynomial fitting.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or <autoref identifier="str" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>3</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>make_binary</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True or float &gt; 0, binarize patterns.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" optional>bool</autoref> or <autoref identifier="float" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>percentile_filter_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Value for optional percentile filtering.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" optional>float</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>percentile_filter_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Filter size if filtering is enabled.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.initialize.get_approx_beam_tilt" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>10</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.get_approx_beam_tilt" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with estimated tilts.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-initialize-pypty.initialize.prepare_restart" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_restart</span></code>

<a href="#reference-initialize-pypty.initialize.prepare_restart" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Prepare a reconstruction restart by loading the latest checkpoint.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_folder</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Directory containing checkpoint files.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.initialize.prepare_restart" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_folder</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>New output directory for resumed reconstruction. Default is None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.initialize.prepare_restart" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.initialize.prepare_restart" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated <code>pypty_params</code> dictionary including loaded state and 'epoch_prev'.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><autoref identifier="ValueError" backlink-type="raised-by" backlink-anchor="pypty.initialize.prepare_restart" optional>ValueError</autoref></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If no checkpoints are available to restart from.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-dpc" heading-number="8.2"><h1 id="reference-dpc-pyptydpc"><code>pypty.dpc</code><a class="headerlink" href="#reference-dpc-pyptydpc" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.dpc"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-dpc-pypty.dpc.get_curl" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_curl</span></code>

<a href="#reference-dpc-pypty.dpc.get_curl" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the standard deviation of the curl of a rotated DPC vector field. This is the objective function for minimization. This particular function was copied from a DPC plugin written by Jordan Hachtel.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>angle</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation angle in radians.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.get_curl" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dpcx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>X-component of the DPC signal.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.dpc.get_curl" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dpcy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Y-component of the DPC signal.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.dpc.get_curl" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.dpc.get_curl" optional>float</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Standard deviation of the curl after rotation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-dpc-pypty.dpc.get_curl_derivative" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_curl_derivative</span></code>

<a href="#reference-dpc-pypty.dpc.get_curl_derivative" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the derivative of the curl-based objective function with respect to rotation angle.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>angle</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation angle in radians.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.get_curl_derivative" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dpcx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>X-component of the DPC signal.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.dpc.get_curl_derivative" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dpcy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Y-component of the DPC signal.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.dpc.get_curl_derivative" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.dpc.get_curl_derivative" optional>float</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Derivative of the curl-based objective function.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-dpc-pypty.dpc.GetPLRotation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">GetPLRotation</span></code>

<a href="#reference-dpc-pypty.dpc.GetPLRotation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Estimate rotation angle that minimizes the curl of the DPC signal.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dpcx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>X-component of the DPC signal (2D array).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.dpc.GetPLRotation" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dpcy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Y-component of the DPC signal (2D array).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.dpc.GetPLRotation" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.dpc.GetPLRotation" optional>float</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Optimal rotation angle in radians.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-dpc-pypty.dpc.fft_based_dpc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fft_based_dpc</span></code>

<a href="#reference-dpc-pypty.dpc.fft_based_dpc" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>FFT-based DPC phase reconstruction. If you setted up the pypty_params properly, you would only need to specify the hpass and lpass values, both are non-negative floats.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary with dataset and calibration settings.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.dpc.fft_based_dpc" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hpass</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>High-pass filtering coefficient (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.fft_based_dpc" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lpass</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Low-pass filtering coefficient (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.fft_based_dpc" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the reconstructed phase (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.fft_based_dpc" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Precomputed center-of-mass x-component.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>comy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Precomputed center-of-mass y-component.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, display the phase reconstruction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.fft_based_dpc" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pot</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Reconstructed 2D phase image.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.dpc.fft_based_dpc" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated parameter dictionary with computed COM and rotation angle.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.dpc.fft_based_dpc" optional>dict</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-dpc-pypty.dpc.iterative_dpc" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iterative_dpc</span></code>

<a href="#reference-dpc-pypty.dpc.iterative_dpc" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Iterative DPC phase reconstruction. If you setted up the pypty_params properly, you would only need to specify the hpass and lpass values, both are non-negative floats.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>PyPty parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_iterations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of gradient descent iterations (default is 100).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>100</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Step reduction factor for backtracking (default is 0.5).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.5</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hpass</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>High-pass filtering coefficient (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lpass</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Low-pass filtering coefficient (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial gradient descent step size (default is 0.1).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>COMx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>X-component of COM map.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>COMy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Y-component of COM map.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>px_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan step size in Ångströms.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" optional>float</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to print progress information (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the result to disk (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>select</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional binary mask to constrain reconstruction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, plot the reconstruction result.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_backtracking</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to use backtracking line search (default is True).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding width to suppress FFT boundary artifacts (default is 5).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>5</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>padded_phase</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Reconstructed 2D phase image.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.dpc.iterative_dpc" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-dpc-pypty.dpc.iterative_poisson_solver" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">iterative_poisson_solver</span></code>

<a href="#reference-dpc-pypty.dpc.iterative_poisson_solver" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Iterative solver for Poisson equation given a Laplacian map.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>laplace</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input 2D array representing the Laplacian of the desired phase.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_iterations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of iterations (default is 100).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>100</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Step size reduction factor (default is 0.5).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.5</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hpass</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>High-pass filtering parameter (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lpass</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Low-pass filtering parameter (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>select</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional binary mask to restrict updates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>px_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in Ångströms (default is 1).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, print convergence status (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial gradient descent step size (default is 0.1).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_backtracking</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to use backtracking line search (default is True).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of pixels to pad around the solution (default is 1).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Backend array library (NumPy or CuPy, default is NumPy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.dpc.iterative_poisson_solver" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Reconstructed 2D phase from the input Laplacian.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-se" heading-number="8.3"><h1 id="reference-se-pyptyse"><code>pypty.se</code><a class="headerlink" href="#reference-se-pyptyse" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.se"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.getvirtualhaadf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getvirtualhaadf</span></code>

<a href="#reference-se-pypty.se.getvirtualhaadf" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute a virtual HAADF image from 4D-STEM data.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary with keys 'data_path', 'scan_size', 'plot', 'output_folder'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.se.getvirtualhaadf" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the image. Default is True.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.se.getvirtualhaadf" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>haadf</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>HAADF intensities array.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.get_aperture" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_aperture</span></code>

<a href="#reference-se-pypty.se.get_aperture" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate a binary aperture mask from diffraction data.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary with keys 'data_path', 'data_pad', 'plot', 'bright_threshold', 'flip_ky'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.se.get_aperture" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dict including 'aperture_mask'.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.se.get_aperture" optional>dict</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.create_binned_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_binned_dataset</span></code>

<a href="#reference-se-pypty.se.create_binned_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Downsample a dataset by spatial binning and save to a new file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_orig</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the original dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.create_binned_dataset" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_new</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to save the binned dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.create_binned_dataset" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binning factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.create_binned_dataset" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><autoref identifier="IOError" backlink-type="raised-by" backlink-anchor="pypty.se.create_binned_dataset" optional>IOError</autoref></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If file operations fail.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.compensate_pattern_drift" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compensate_pattern_drift</span></code>

<a href="#reference-se-pypty.se.compensate_pattern_drift" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compensate drift in diffraction patterns via phase correlation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>aperture</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binary aperture mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patterns</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>4D diffraction patterns.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Drift-compensated patterns.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.get_virtual_annular_detector" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_virtual_annular_detector</span></code>

<a href="#reference-se-pypty.se.get_virtual_annular_detector" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute virtual detector signal using annular masks.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary with keys 'data_path', 'scan_size', 'plot', 'output_folder'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inner_rad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Inner radius in normalized units. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outer_rad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Outer radius in normalized units. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the signal. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>X-offset. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Y-offset. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D detector signal array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.coordinate_transformation_2d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">coordinate_transformation_2d</span></code>

<a href="#reference-se-pypty.se.coordinate_transformation_2d" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Map coordinates from XY space to UV space using polynomial coefficients.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Coordinates to transform. Shape (2, N) or (N, 2).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.coordinate_transformation_2d" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ab</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation coefficients. Length 3 (linear),
6 (quadratic), or 10 (cubic).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Transformed coordinates, shape (N, 2).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.find_ab" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_ab</span></code>

<a href="#reference-se-pypty.se.find_ab" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Estimate polynomial coefficients for coordinate mapping.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Source x-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Source y-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Target u-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Target v-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trafo_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation order: 0=linear, 1=quadratic, 2=cubic. Default is 2.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>2</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Transformation coefficients.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.unwarp_im" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwarp_im</span></code>

<a href="#reference-se-pypty.se.unwarp_im" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Correct distortions and illumination in warped images.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>warp_im</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input image(s).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_im" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ab</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation method. Default is 'linear'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_im" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;linear&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Unwarped image(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.coordinate_transformation_2d_areamag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">coordinate_transformation_2d_areamag</span></code>

<a href="#reference-se-pypty.se.coordinate_transformation_2d_areamag" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute local area magnification of polynomial mapping.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Coordinates of shape (2, N) or (N, 2).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.coordinate_transformation_2d_areamag" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ab</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Local magnification values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.fit_vector_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit_vector_field</span></code>

<a href="#reference-se-pypty.se.fit_vector_field" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Fit a smooth displacement field from calibration points.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Nominal coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Nominal coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Xi</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid coordinates for mapping.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Yi</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid coordinates for mapping.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>tuple of numpy.ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Displacement fields (dV, dU).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.warp_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warp_image</span></code>

<a href="#reference-se-pypty.se.warp_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Warp image(s) based on a displacement field.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input image(s).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_image" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Displacement fields (U, V).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of numpy.ndarray</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.warp_image" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extra_angle_rotation_compensation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation angle in degrees. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.warp_image" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warped image(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.compose_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compose_fields</span></code>

<a href="#reference-se-pypty.se.compose_fields" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compose two displacement fields for use with warp_image.</p>
<p>Resulting field corresponds to: first apply field1, then field2.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field1</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>First displacement field. Applied closest to the original image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="U1" optional>U1</autoref>, <autoref identifier="V1" optional>V1</autoref>)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Second displacement field. Applied after field1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="U2" optional>U2</autoref>, <autoref identifier="V2" optional>V2</autoref>)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order used to resample field1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.compose_fields" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mode</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Boundary mode for map_coordinates (e.g. 'nearest', 'constant').</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.compose_fields" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;nearest&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>U_tot, V_tot : np.ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Composed displacement field such that:
warp_image(warp_image(I, field1), field2)
≈ warp_image(I, (U_tot, V_tot))</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.warp_images_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warp_images_batch</span></code>

<a href="#reference-se-pypty.se.warp_images_batch" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply warping to a batch of images using precomputed indices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batch of images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Not used.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ignored" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>ignored</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batches</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batch indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warped_rows</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened row and column indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warped_cols</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened row and column indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warped images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.unwarp_4dstem_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwarp_4dstem_batch</span></code>

<a href="#reference-se-pypty.se.unwarp_4dstem_batch" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Unwarp a 4D-STEM dataset in batches.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_old</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" optional>str</autoref> or <autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_numpy_new</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to save warped data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Displacement fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of numpy.ndarray</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Frames per batch. Default is 20.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>20</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order. Default is 5.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>5</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, return data instead of saving.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref> or None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warped dataset or None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><autoref identifier="ValueError" backlink-type="raised-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>ValueError</autoref></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If total frames not divisible by batch_size.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.remove_hot_pixels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_hot_pixels</span></code>

<a href="#reference-se-pypty.se.remove_hot_pixels" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove hot pixels from 4D-STEM data.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>percentile</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Threshold percentile. Default is 99.99.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.remove_hot_pixels" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>99.99</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Corrected dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-tcbf" heading-number="8.4"><h1 id="reference-tcbf-pyptytcbf"><code>pypty.tcbf</code><a class="headerlink" href="#reference-tcbf-pyptytcbf" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.tcbf"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-tcbf-pypty.tcbf.run_tcbf_alignment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_tcbf_alignment</span></code>

<a href="#reference-tcbf-pypty.tcbf.run_tcbf_alignment" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Align and fit the beam contrast transfer function (CTF) using 4D-STEM data.</p>
<p>This function estimates beam aberrations by aligning individual pixel images using 
cross-correlation and fitting a CTF model. It supports iterative fitting with various 
binning levels and options for low-frequency drift compensation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary containing PyPTY experimental and reconstruction settings.</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binning_for_fit</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List (for integers) of binning factors for each iteration of the CTF fit.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>list</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>[8]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save intermediate tcBF images and shift estimates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimize_angle</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to include probe rotation angle in the fit.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial guess for aberrations. If None, n_aberrations_to_fit zeros will be used.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>list</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_aberrations_to_fit</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of aberrations to fit if no initial guess is provided.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>12</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reference used for cross-correlation ("bf" or "zero").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="string" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>string</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;bf&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ctf_sign_flip</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Boolean flag, helps to align the images.</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>refine_box_dim</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Radius (in pixels) of the interpolation box for sub-pixel shift refinement.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>10</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Factor for refining cross-correlation to estimate sub-pixel shifts.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>3</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cross_corr_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Type of cross-correlation to use ("phase" or "classical").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;phase&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cancel_large_shifts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Threshold (0–1) to ignore large shift outliers in the fit.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern_blur_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Radius for optional circular blur mask applied to patterns.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of scan pixels to pad around the dataset (auto if None).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Aperture mask. If None, attempts to extract from parameters.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>ndarray</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subscan_region</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Subregion for CTF fitting: [left, top, right, bottom].</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>list</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compensate_lowfreq_drift</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to compensate for pattern drift in large FOVs.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>append_lowfreq_shifts_to_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to store low-frequency drift corrections in <code>params</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interpolate_scan_factor</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Factor to upsample the scan via interpolation (experimental).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binning_cross_corr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binning factor before peak detection in cross-correlation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_cross_corr_formula</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Use analytical peak refinement formula for phase correlation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>f_scale_lsq</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scaling factor for residuals in <code>least_squares</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_scale_lsq</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scaling for initial step size in <code>least_squares</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_lsq</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loss function for <code>least_squares</code> optimization.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="string" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>string</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;linear&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tol_ctf</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tolerance (<code>ftol</code>) for stopping criterion in optimization.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1e-08</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.tcbf.run_tcbf_alignment" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated parameter dictionary with fitted aberrations, defocus, and potentially updated scan positions and rotation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-tcbf-pypty.tcbf.upsampled_tcbf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upsampled_tcbf</span></code>

<a href="#reference-tcbf-pypty.tcbf.upsampled_tcbf" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform an upsampled tcBF (transmission coherent Bright Field) reconstruction.</p>
<p>This function reconstructs a tcBF image on an upsampled scan grid from 4D-STEM data.
It applies Fourier-based shifts to align the bright field pixel images and combines them into a final image.
Prior to calling this function, it is recommended to run the tcBF alignment routine to update <code>pypty_params</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary containing experimental parameters and reconstruction settings.
This should include keys such as 'data_path', 'scan_size', 'aperture_mask', 'acc_voltage', etc.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor for the scan grid. Default is 5.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>5</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of additional scan positions to pad on each side to avoid wrap-around artifacts.
Default is 10.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>10</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compensate_lowfreq_drift</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, compensates for low-frequency drift of the aperture.
Requires that run_tcbf_alignment has been executed to provide drift corrections.
Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ctf_sign_flig</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Boolean flag, helps to compensate artifacts</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Precision for floating point computations. Use 64 for higher precision or 32 for lower memory usage.
Default is 64.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(64, 32)</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>64</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>round_shifts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, shifts are rounded and alignment is performed using array roll operations.
If False, FFT-based subpixel shifting is used. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Backend array module (e.g., numpy or cupy). Default is cupy.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag to save the output image. If True, the image is saved to disk.
Ignored if 'save_preprocessing_files' is set in <code>pypty_params</code>. Default is 0 (False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" optional>bool</autoref> or <autoref identifier="int" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_parallel_fft</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum number of FFTs to perform in parallel for vectorized processing.
Default is 100.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>100</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin_fac</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binning factor for the data in reciprocal space. Default is 1 (no binning).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Real-valued tcBF image reconstructed on the upsampled grid.</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.tcbf.upsampled_tcbf" optional>float</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Final pixel size in Ångströms after upsampling.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-tcbf-pypty.tcbf.run_tcbf_compressed_alignment" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run_tcbf_compressed_alignment</span></code>

<a href="#reference-tcbf-pypty.tcbf.run_tcbf_compressed_alignment" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform a CTF alignment using compressed 4D-STEM data and masked bright-field regions.</p>
<p>This function fits the beam CTF to the shifts between the individual pixel images of the 4d-stem dataset. It's the same as run_tcbf_alignment, but for compressed data. The shift estimation is done via cross-correaltion.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary containing experimental and reconstruction settings.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_iterations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of fitting iterations to perform.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save intermediate tcBF images and shift maps. Default is True.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>optimize_angle</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to include probe rotation angle in the CTF fit. Default is True.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial guess for the aberration coefficients. If None, it will be inferred or zero-initialized.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_aberrations_to_fit</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of aberration coefficients to fit if <code>aberrations</code> is not provided. Default is 12.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>12</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reference_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>"bf" to use the tcBF image as a reference, "zero" to use the central pixel. Default is "bf".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;bf&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ctf_sign_flip</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Boolean flag, helps to compensate artifacts</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>refine_box_dim</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the cropped region around the cross-correlation peak for sub-pixel refinement. Default is 10.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>10</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor for sub-pixel interpolation. Default is 3.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>3</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cross_corr_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Cross-correlation method: "phase" (recommended) or "classic". Default is "phase".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;phase&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cancel_large_shifts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Threshold to reject large shift outliers during fitting. Value between 0 and 1. Default is None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" optional>float</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pattern_blur_width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Width of blur kernel for patterns prior to analysis. Default is None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of scan pixels to pad around the scan to prevent wrap-around. Default is auto.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" optional>int</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Aperture mask defining pixels to analyze. If None, it will be loaded from <code>params</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>subscan_region</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional subregion [left, top, right, bottom] on which to perform the alignment. Default is None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compensate_lowfreq_drift</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to compute and correct for slow drifting of the aperture over time. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>append_lowfreq_shifts_to_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, saves the low-frequency correction back into <code>params</code>. Default is True.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interpolate_scan_factor</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Experimental: interpolate scan grid by this factor (e.g., 2 for 2x upsampled grid). Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>binning_cross_corr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binning factor applied to cross-correlation maps before refinement. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_cross_corr_formula</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, uses analytical subpixel peak estimation for phase correlation. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>f_scale_lsq</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scaling factor for least squares residuals (<code>f_scale</code>). Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_scale_lsq</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial step scaling (<code>x_scale</code>) for least squares. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss_lsq</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loss type for least squares optimizer. E.g., "linear", "huber". Default is "linear".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;linear&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tol_ctf</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tolerance for optimizer convergence (<code>ftol</code>). Default is 1e-8.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1e-08</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.tcbf.run_tcbf_compressed_alignment" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary of reconstruction parameters including fitted aberrations and scan rotation.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-direct" heading-number="8.5"><h1 id="reference-direct-pyptydirect"><code>pypty.direct</code><a class="headerlink" href="#reference-direct-pyptydirect" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.direct"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-direct-pypty.direct.wdd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wdd</span></code>

<a href="#reference-direct-pypty.direct.wdd" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform Wigner Distribution Deconvolution (WDD).</p>
<p>This function applies Wigner Distribution Deconvolution to the provided data,
allowing for enhanced reconstruction of complex objects and probes. It handles both
GPU (via CuPy) and CPU (via NumPy) computations based on the availability of CuPy.
The <code>pypty_params</code> dictionary must be prepared via the <code>initialize</code> module.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary containing calibrated parameters, including paths and settings
for data processing.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.direct.wdd" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>eps_wiener</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Epsilon parameter for the Wiener filter. Default is 1e-3.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.direct.wdd" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.001</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>thresh</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If provided, <code>eps_wiener</code> is ignored. Denominator values below this threshold
are set to 1, and the corresponding numerator values are set to 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.direct.wdd" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save output files (False by default). Ignored if
<code>save_preprocessing_files</code> is specified in <code>pypty_params</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.direct.wdd" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>deconvolved_object</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D deconvolved complex object.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.direct.wdd" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Make sure <code>pypty_params</code> includes all necessary paths and data arrays prior
to calling this function.</p>
</details>

    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-iterative" heading-number="8.6"><h1 id="reference-iterative-pyptyiterative"><code>pypty.iterative</code><a class="headerlink" href="#reference-iterative-pyptyiterative" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.iterative"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-iterative-pypty.iterative.run" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">run</span></code>

<a href="#reference-iterative-pypty.iterative.run" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Launch an iterative ptychographic reconstruction.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reconstruction parameters dictionary or path to a saved parameters file. Must include
experiment setup and algorithm settings (see <code>custom_presets.md</code> and <code>reference/initialize.md</code>).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" optional>dict</autoref> or <autoref identifier="str" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>The function mutates global state, including <code>obj</code>, <code>probe</code>, and <code>history_bfgs</code>.</li>
<li>Parameters can be dynamically varied via lambda functions in <code>pypty_params</code>.</li>
<li>Checkpoints and logs are saved to <code>output_folder</code> as specified in the parameters.</li>
</ul>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-iterative-pypty.iterative.bfgs_update" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">bfgs_update</span></code>

<a href="#reference-iterative-pypty.iterative.bfgs_update" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>x
Internal function of PyPTy. Perform a single L-BFGS update step for all active reconstruction parameters.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>Way</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>total_loss</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Total objective loss for this epoch.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.iterative.bfgs_update" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_sse</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sum of squared errors for this epoch.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.iterative.bfgs_update" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraint_contributions</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Regularization term contributions.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code>list of float</code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>actual_step</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Final step length chosen by line search.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.iterative.bfgs_update" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Number of line search iterations performed.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="returned-by" backlink-anchor="pypty.iterative.bfgs_update" optional>int</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_value</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Directional derivative before update.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.iterative.bfgs_update" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_d_value</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Directional derivative after update.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.iterative.bfgs_update" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warnings</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warnings generated during update.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="returned-by" backlink-anchor="pypty.iterative.bfgs_update" optional>str</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>This function updates global variables: <code>obj</code>, <code>probe</code>, <code>positions</code>, etc.</li>
<li>Handles both first-time and history-based L-BFGS updates.</li>
</ul>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-iterative-pypty.iterative.reset_bfgs_history" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reset_bfgs_history</span></code>

<a href="#reference-iterative-pypty.iterative.reset_bfgs_history" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reset the global BFGS history and free GPU memory.</p>


<details class="note" open>
  <summary>Notes</summary>
  <ul>
<li>Clears all stored vectors and scalars in <code>history_bfgs</code>.</li>
<li>Attempts to free memory pools for CuPy and pinned memory.</li>
</ul>
</details>

    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-objective" heading-number="8.7"><h1 id="reference-objective-pyptyobjective"><code>pypty.objective</code><a class="headerlink" href="#reference-objective-pyptyobjective" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.objective"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.loss_and_direction" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">loss_and_direction</span></code>

<a href="#reference-objective-pypty.objective.loss_and_direction" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the total loss and gradients for ptychographic reconstruction.</p>
<p>This is the core function of PyPty that performs forward and backward propagation,
calculates the loss between measured and simulated patterns, and computes the gradients
of all active reconstruction parameters (object, probe, positions, tilts, etc.).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>this_obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex 4D object (current estimate)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex probe (y,x,modes) optionally 4D (y,x,modes, scenatios)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_pos_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Integer beam postions in pixels [[y0,x0],.. [yn, xn]]. Note: units are pixels, not angstrom!</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_pos_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float sub-pixel postions for more precise beam shift. Note: units are pixels, not angstrom!</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_tilt_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Beam tilts in radians, shape should be (N_measurements, 6), where first two tilts are applied before the sample, second and third are applied inside (tilted propagator) and two last are applied after the sample</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_tilts_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>legacy paramter, actually is not really required. It is a correction that is added to the tilts array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_distances</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>either just one value for a common slice spacing or list of values for each slice. If object has N slices, it should have N-1 entries.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>measured_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>array or h5-dataset with diffraction patterns. Should be 3D, [N_measurements, y,x]</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>algorithm_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>string indicating the loss function (error metric)</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Electron wavelength in Angstrom</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>do you refine the beam?</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>do you refine the object?</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_pos_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>do you refine the positions?</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>do you refine the tilts?</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>masks</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>optional, if the data is compressed, you should provide the 3D array with virtual detectors [N_detectors, y,x].</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_x_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>real-space pixel size in x-direction (Angstrom).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_y_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>real-space pixel size in y-direction (Angstrom).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>recon_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>"far_field" or "near_field". Changes the exit-wave propagation regime.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="string" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>string</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Cs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spherical aberration (Angstrom). Only needed for near-field propagation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>defocus_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of exit-wave defocus values (Angstrom). Only needed for near-field propagation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>alpha_near_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flux-preserving correction for near-field propagation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>damping_cutoff_multislice</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Cutoff (fraction smaller than 1) beyond which the Fouirer-space is cleaned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth_rolloff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Smooth rolloff for Fourier masking</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>propmethod</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>string indicating the method for split-step integration</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="string" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>string</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_chopped_sequence</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>sequence of measruement indices used for loss and grad calculation (should be sorted)</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_one_by_one</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>boolean flag. should be True for lazy loading.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_multiplier</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>multiplicative factor applied to data on the fly.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>padding factor applied to data on the fly.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_plate_in_h5</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>path to h5 dataset containing phase plates for each measurement.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="string" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>string</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_loss_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>weight applied to the main part of the loss</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_bin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>binning factor applied to data on the fly</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_shift_vector</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>shift vector in pixels (y,x) applied to data on the fly</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>virtual "decompression" of the data used to enlarge the probe window</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_background</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>real-valued array descripting the square root of the static offset on the diffraction patterns.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or <autoref identifier="float" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_static_background</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>do you refine the static background?</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilt_mode</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>flag for tilting</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberration_marker</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_marker</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_batch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_only_obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beam_current</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_beam_current_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_aberrations_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_first_epoch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fast_axis_reg_weight_positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slow_axis_reg_weight_positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slow_axis_reg_weight_tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_deformation_reg_weight_positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_deformation_reg_weight_tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fast_axis_reg_weight_tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_reg_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_window_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_window</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_norm_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abs_norm_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atv_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atv_q</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atv_p</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mixed_variance_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mixed_variance_sigma</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smart_memory</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>do you want to prevent memory fragmentation? Makes the reconstrcution slightly slower</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>verbodity level</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.objective.loss_and_direction" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>loss</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Total loss value.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sse</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sum of squared errors.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>object_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to the object.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to the probe.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pos_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to scan position corrections.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to tilts.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_background_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to static background.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations_array_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to aberration coefficients.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beam_current_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to beam current.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraint_contributions</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Individual regularization loss terms added to the total loss.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="returned-by" backlink-anchor="pypty.objective.loss_and_direction" optional>list</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.scatteradd_probe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scatteradd_probe</span></code>

<a href="#reference-objective-pypty.objective.scatteradd_probe" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Adds batched probe updates to their respective positions in the full probe array. This wrapper is needed to support older CuPy version.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>full</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Full probe gradient array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.scatteradd_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indic</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indices specifying where to add each batch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.objective.scatteradd_probe" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batches</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batched gradients to scatter-add.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.scatteradd_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.scatteradd_abers" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scatteradd_abers</span></code>

<a href="#reference-objective-pypty.objective.scatteradd_abers" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Adds batched aberration updates to their respective positions in the full aberration array. This wrapper is needed to support older CuPy version.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>full</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Full aberration gradient array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.scatteradd_abers" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>indic</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indices specifying where to add each batch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.objective.scatteradd_abers" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batches</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batched gradients to scatter-add.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.scatteradd_abers" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.charge_flip" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">charge_flip</span></code>

<a href="#reference-objective-pypty.objective.charge_flip" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform charge-flipping style object regularization to enhance phase and absorption contrast.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>a</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex object to regularize.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.charge_flip" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delta_phase</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Phase threshold ratio.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.charge_flip" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.03</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>delta_abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Absorption threshold ratio.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.charge_flip" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.14</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta_phase</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Inversion multiplier for low-phase regions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.charge_flip" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>-0.95</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta_abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Inversion multiplier for low-absorption regions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.charge_flip" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>-0.95</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fancy_sigma</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tuple of atomic-shape gaussian kernel sigmas (for phase, absorption).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" optional>tuple</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.charge_flip" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Regularized complex object.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.make_states_orthogonal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_states_orthogonal</span></code>

<a href="#reference-objective-pypty.objective.make_states_orthogonal" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply Gram-Schmidt orthogonalization to probe modes.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe_states</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe array with multiple modes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.make_states_orthogonal" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.make_states_orthogonal" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Orthogonalized probe states.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.make_basis_orthogonal" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_basis_orthogonal</span></code>

<a href="#reference-objective-pypty.objective.make_basis_orthogonal" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Orthogonalize a set of 1D basis vectors using Gram-Schmidt.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vectors</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>2D array of vectors to orthogonalize.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.make_basis_orthogonal" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.make_basis_orthogonal" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Orthogonalized basis.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_fast_axis_constraint_on_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_fast_axis_constraint_on_grid</span></code>

<a href="#reference-objective-pypty.objective.compute_fast_axis_constraint_on_grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply second-order TV regularization along the fast scan axis.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>something</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Positions or tilts to regularize.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_fast_axis_constraint_on_grid" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the scan grid.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.objective.compute_fast_axis_constraint_on_grid" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tv_reg_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Regularization weight.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_fast_axis_constraint_on_grid" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Value of the regularization term.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_fast_axis_constraint_on_grid" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the regularization.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_fast_axis_constraint_on_grid" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_slow_axis_constraint_on_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_slow_axis_constraint_on_grid</span></code>

<a href="#reference-objective-pypty.objective.compute_slow_axis_constraint_on_grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply second-order TV regularization along the slow scan axis.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>something</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Positions or tilts to regularize.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_slow_axis_constraint_on_grid" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the scan grid.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.objective.compute_slow_axis_constraint_on_grid" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tv_reg_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Regularization weight.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_slow_axis_constraint_on_grid" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Regularization loss.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_slow_axis_constraint_on_grid" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient with respect to the input.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_slow_axis_constraint_on_grid" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_deformation_constraint_on_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_deformation_constraint_on_grid</span></code>

<a href="#reference-objective-pypty.objective.compute_deformation_constraint_on_grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Penalize deviations from affine transformations in local scan patches.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>something</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid to regularize (positions or tilts).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_deformation_constraint_on_grid" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dimensions of the scan.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.objective.compute_deformation_constraint_on_grid" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reg_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Regularization weight.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_deformation_constraint_on_grid" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Regularization loss.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_deformation_constraint_on_grid" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to the grid.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_deformation_constraint_on_grid" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_full_l1_constraint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_full_l1_constraint</span></code>

<a href="#reference-objective-pypty.objective.compute_full_l1_constraint" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply L1 norm regularization to the object's phase and absorption.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>object</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex object array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_full_l1_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abs_norm_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Weight for absorption norm.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_full_l1_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase_norm_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Weight for phase norm.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_full_l1_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grad_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Mask to restrict gradient computation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_full_l1_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_direction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, return the gradient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.compute_full_l1_constraint" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smart_memory</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Memory-efficient option.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.compute_full_l1_constraint" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Regularization loss.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_full_l1_constraint" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient if <code>return_direction</code> is True, else None.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_window_constraint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_window_constraint</span></code>

<a href="#reference-objective-pypty.objective.compute_window_constraint" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Penalize probe values outside a predefined window region in real-space.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>to_reg_probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex probe array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_window_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_window</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Window mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_window_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_window_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Weight of the constraint.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_window_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Window constraint loss.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_window_constraint" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>reg_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to the probe.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_window_constraint" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_probe_constraint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_probe_constraint</span></code>

<a href="#reference-objective-pypty.objective.compute_probe_constraint" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply reciprocal space constraint to the probe using an aperture mask. Penalize probe values outside an aperture.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>to_reg_probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex probe array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_probe_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binary mask or scalar defining aperture radius.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or <autoref identifier="float" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Regularization weight.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_probe_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_direction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, return the gradient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.compute_probe_constraint" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Loss from masked frequency components.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_probe_constraint" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_fft</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the constraint if requested.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_atv_constraint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_atv_constraint</span></code>

<a href="#reference-objective-pypty.objective.compute_atv_constraint" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply adaptive total variation (ATV) regularization to the object.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atv_weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Regularization weight.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atv_q</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>q-norm parameter.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atv_p</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>p-norm parameter.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_x_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size along x (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_y_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size along y (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>atv_grad_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional gradient mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_direction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, return the gradient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smart_memory</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, use memory-efficient computation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>ATV regularization value.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dR_dTerm</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient with respect to the object.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_atv_constraint" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_missing_wedge_constraint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_missing_wedge_constraint</span></code>

<a href="#reference-objective-pypty.objective.compute_missing_wedge_constraint" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Enforce missing wedge constraint in 3D reciprocal space.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>3D complex object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_x_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size along x (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_y_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size along y (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slice_distance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Slice spacing (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beta_wedge</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Cone sharpness.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wedge_mu</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Regularization weight.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>loss_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Regularization loss.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grad_obj</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to the object.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_missing_wedge_constraint" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-objective-pypty.objective.compute_mixed_object_variance_constraint" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compute_mixed_object_variance_constraint</span></code>

<a href="#reference-objective-pypty.objective.compute_mixed_object_variance_constraint" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Regularize variance across object modes by penalizing their differences.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>this_obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex object array with multiple modes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.objective.compute_mixed_object_variance_constraint" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>weight</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Regularization strength.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_mixed_object_variance_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Smoothing kernel width in frequency space.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.objective.compute_mixed_object_variance_constraint" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_direction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, return the gradient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.compute_mixed_object_variance_constraint" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smart_memory</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Use memory-efficient FFT loops.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.objective.compute_mixed_object_variance_constraint" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>reg_term</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Mixed variance loss.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.objective.compute_mixed_object_variance_constraint" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient with respect to the object if <code>return_direction</code> is True.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-multislice_core" heading-number="8.8"><h1 id="reference-multislice_core-pyptymultislice_core"><code>pypty.multislice_core</code><a class="headerlink" href="#reference-multislice_core-pyptymultislice_core" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.multislice_core"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-multislice_core-pypty.multislice_core.multislice" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multislice</span></code>

<a href="#reference-multislice_core-pypty.multislice_core.multislice" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Simulate multislice wave propagation using a classic split-step integrator (2nd order precision with respect to slice thickness if beam is optimized).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>full_probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe wavefunction with shape [N_batch, y,x, modes]</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_obj_chopped</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Object slices with shape [N_batch, y,x, z, modes].</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slices</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of object slices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_obj_modes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of object modes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_probe_modes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of probe modes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_distances</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Slice thicknesses.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Electron wavelength.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>q2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency grids.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency grids.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency grids.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Mask to exclude undesired frequencies.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_single_dist</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, use the same distance for all slices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_tan_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Beam tilts with shape N_batch</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_tan_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Beam tilts with shape N_batch</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>damping_cutoff_multislice</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Damping frequency cutoff.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth_rolloff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rolloff rate for the damping filter.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>master_propagator_phase_space</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Full propagator in Fourier space (optional).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>half_master_propagator_phase_space</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Half-step propagator (optional).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask_clean</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Clean propagation mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>waves_multislice</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>This array contains interediate exit-waves</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wave</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>This array contains final exit-wave</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Numerical types.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Numerical types.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>waves_multislice</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Multislice stack of propagated waves.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wave</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Final exit wave.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.multislice_core.multislice" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-multislice_core-pypty.multislice_core.multislice_grads" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">multislice_grads</span></code>

<a href="#reference-multislice_core-pypty.multislice_core.multislice_grads" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute gradients for classic multislice propagation model (object, probe, and tilts).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dLoss_dP_out</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Gradient of the loss with respect to the final propagated wave.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>waves_multislice</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Intermediate wave stack from the forward multislice pass.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_obj_chopped</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>4D sliced object [batch, y, x, z, modes].</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>object_grad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Gradient accumulator for object slices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts_grad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Accumulator for tilt gradients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_single_dist</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, slice distances are constant.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_distances</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Per-slice thicknesses.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>exclude_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Frequency mask for FFT operations.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe wavelength (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>q2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency grids.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency grids.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>qy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency grids.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_tan_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Beam tilt values per batch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_tan_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Beam tilt values per batch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_slices</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of slices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_obj_modes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of object modes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tiltind</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Index in tilt update array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>master_propagator_phase_space</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Full Fourier propagation kernel.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether tilt gradient is updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>damping_cutoff_multislice</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Damping cutoff for high-frequency noise.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth_rolloff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Width of damping transition.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilt_mode</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Mode selector for tilt optimization.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>compute_batch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current batch size.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask_clean</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>FFT domain mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to compute probe gradient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to compute object gradient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>this_step_pos_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>(Unused) Flag for positional corrections.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>masked_pixels_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indices for applying gradients to global object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>masked_pixels_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Indices for applying gradients to global object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Floating-point type.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex type.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>helper_flag_4</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, return probe gradient; else return None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>object_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient for object slices.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>interm_probe_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Gradient for input probe (if helper_flag_4 is True).</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts_grad</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated tilt gradient.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.multislice_core.multislice_grads" optional>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-multislice_core-pypty.multislice_core.scatteradd" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">scatteradd</span></code>

<a href="#reference-multislice_core-pypty.multislice_core.scatteradd" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Adds batched object updates to their respective positions in the full object array.
This wrapper is needed to support older CuPy versions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>full</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Full object gradient array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.scatteradd" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>masky</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Index array for the y-axis.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.scatteradd" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>maskx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Index array for the x-axis.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.scatteradd" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>chop</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batched gradients to scatter-add.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.multislice_core.scatteradd" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-fft" heading-number="8.9"><h1 id="reference-fft-pyptyfft"><code>pypty.fft</code><a class="headerlink" href="#reference-fft-pyptyfft" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.fft"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.fftfreq" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fftfreq</span></code>

<a href="#reference-fft-pypty.fft.fftfreq" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for fftfreq function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>length</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Length of the output array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.fft.fftfreq" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampling</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sample spacing (default is 1).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.fft.fftfreq" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.fftfreq" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.fftfreq" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Discrete Fourier Transform sample frequencies.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.ifftfreq" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ifftfreq</span></code>

<a href="#reference-fft-pypty.fft.ifftfreq" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for ifftfreq function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>length</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Length of the output array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.fft.ifftfreq" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sampling</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sample spacing (default is 1).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.fft.ifftfreq" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.ifftfreq" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.ifftfreq" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Discrete inverse Fourier Transform sample frequencies.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.fftshift" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fftshift</span></code>

<a href="#reference-fft-pypty.fft.fftshift" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for fftshift function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be shifted.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.fftshift" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.fftshift" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.fftshift" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Shifted array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.ifftshift" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ifftshift</span></code>

<a href="#reference-fft-pypty.fft.ifftshift" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for ifftshift function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be inverse shifted.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.ifftshift" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.ifftshift" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.ifftshift" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Inverse shifted array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.shift_fft2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shift_fft2</span></code>

<a href="#reference-fft-pypty.fft.shift_fft2" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for xp.fft.fftshift(xp.fft.fft2(...)) functions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.shift_fft2" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the FFT (default is (0, 1)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, allow overwriting the input array (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.fft.shift_fft2" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.shift_fft2" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.shift_fft2" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D Fourier Transform of the input array, shifted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.fft2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fft2</span></code>

<a href="#reference-fft-pypty.fft.fft2" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for fft2 function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.fft2" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the FFT (default is (0, 1)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, allow overwriting the input array (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.fft.fft2" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.fft2" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.fft2" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D Fourier Transform of the input array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.ifft2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ifft2</span></code>

<a href="#reference-fft-pypty.fft.ifft2" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for ifft2 function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.ifft2" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the inverse FFT (default is (0, 1)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, allow overwriting the input array (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.fft.ifft2" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.ifft2" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.ifft2" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D inverse Fourier Transform of the input array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.ifft2_ishift" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ifft2_ishift</span></code>

<a href="#reference-fft-pypty.fft.ifft2_ishift" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for xp.fft.ifft2(xp.fft.ifftshift(...)) function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.ifft2_ishift" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the inverse FFT (default is (0, 1)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>overwrite_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, allow overwriting the input array (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.fft.ifft2_ishift" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.ifft2_ishift" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.ifft2_ishift" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D inverse Fourier Transform of the input array, after shifting.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.shift_fftn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shift_fftn</span></code>

<a href="#reference-fft-pypty.fft.shift_fftn" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for xp.fft.fftshift(xp.fft.fftn(...)) function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.shift_fftn" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the FFT (default is (0, 1, 2)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1, 2)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.shift_fftn" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.shift_fftn" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>N-dimensional Fourier Transform of the input array, shifted.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.ifftn_ishift" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ifftn_ishift</span></code>

<a href="#reference-fft-pypty.fft.ifftn_ishift" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for xp.fft.ifftn(xp.fft.ifftshift(...)) function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.ifftn_ishift" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the inverse FFT (default is (0, 1, 2)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1, 2)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.ifftn_ishift" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.ifftn_ishift" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>N-dimensional inverse Fourier Transform of the input array, after shifting.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.ifftn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">ifftn</span></code>

<a href="#reference-fft-pypty.fft.ifftn" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for ifftn function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.ifftn" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the inverse FFT (default is (0, 1, 2)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1, 2)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.ifftn" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.ifftn" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>N-dimensional inverse Fourier Transform of the input array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-fft-pypty.fft.fftn" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fftn</span></code>

<a href="#reference-fft-pypty.fft.fftn" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Wrapper for fftn function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>arr</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be transformed.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.fft.fftn" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>axes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axes over which to compute the FFT (default is (0, 1, 2)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>(0, 1, 2)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>numpy or cupy, cpu or gpu backend</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.fft.fftn" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.fft.fftn" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>N-dimensional Fourier Transform of the input array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-utils" heading-number="8.10"><h1 id="reference-utils-pyptyutils"><code>pypty.utils</code><a class="headerlink" href="#reference-utils-pyptyutils" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.utils"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.fourier_clean_3d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fourier_clean_3d</span></code>

<a href="#reference-utils-pypty.utils.fourier_clean_3d" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply a 3D Fourier filter to the input array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input 3D array to be filtered.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean_3d" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Cutoff frequency (default is 0.66).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean_3d" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.66</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Predefined mask to apply. If None, a mask is generated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" optional>array_like</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rolloff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rolloff parameter for smoothing the mask (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean_3d" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data type for computations (default is cp.float32).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="data" optional>data</autoref> - <autoref identifier="type" optional>type</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.float32" optional hover>float32</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module (default is cupy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean_3d" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean_3d" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="array_like" backlink-type="returned-by" backlink-anchor="pypty.utils.fourier_clean_3d" optional>array_like</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The filtered array after applying the Fourier filter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.fourier_clean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fourier_clean</span></code>

<a href="#reference-utils-pypty.utils.fourier_clean" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply a Fourier filter to the input array. Supports 2D or 3D arrays.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array (2D or 3D) to be filtered.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>cutoff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Cutoff frequency (default is 0.66).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.66</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Predefined mask to apply. If None, a mask is generated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" optional>array_like</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rolloff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rolloff parameter for smoothing the mask (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data type for computations (default is cp.float32).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="data" optional>data</autoref> - <autoref identifier="type" optional>type</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.float32" optional hover>float32</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module (default is cupy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.fourier_clean" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="array_like" backlink-type="returned-by" backlink-anchor="pypty.utils.fourier_clean" optional>array_like</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The filtered array after applying the Fourier filter.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.create_spatial_frequencies" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_spatial_frequencies</span></code>

<a href="#reference-utils-pypty.utils.create_spatial_frequencies" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate spatial frequency grids and corresponding masks for multislice simulations.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>px</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in the x-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>py</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in the y-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the grid.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>damping_cutoff_multislice</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Damping cutoff factor for multislice simulations.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smooth_rolloff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Smoothing rolloff parameter.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data type for computations.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="data" optional>data</autoref> - <autoref identifier="type" optional>type</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy (default is cupy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="tuple" backlink-type="returned-by" backlink-anchor="pypty.utils.create_spatial_frequencies" optional>tuple</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Tuple containing:
- q2: 2D array of squared spatial frequencies.
- qx: 2D array of spatial frequencies in x.
- qy: 2D array of spatial frequencies in y.
- exclude_mask: Mask in Fourier space.
- exclude_mask_ishift: Unshifted mask.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.shift_probe_fourier" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">shift_probe_fourier</span></code>

<a href="#reference-utils-pypty.utils.shift_probe_fourier" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Shift a probe in Fourier space by applying a phase ramp.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The input probe array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.shift_probe_fourier" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shift_px</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shift in pixels (y, x).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of float</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="tuple" backlink-type="returned-by" backlink-anchor="pypty.utils.shift_probe_fourier" optional>tuple</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Tuple containing the shifted probe, the phase mask, the Fourier transform of the probe,
and the spatial frequency grids (maskx, masky).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.generate_mask_for_grad_from_pos" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_mask_for_grad_from_pos</span></code>

<a href="#reference-utils-pypty.utils.generate_mask_for_grad_from_pos" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Construct a binary mask from given positions and footprint dimensions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>shapex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Width of the mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.generate_mask_for_grad_from_pos" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shapey</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Height of the mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.generate_mask_for_grad_from_pos" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>positions_list</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of (y, x) positions where the mask should be activated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of tuple</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape_footprint_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Footprint width.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.generate_mask_for_grad_from_pos" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shape_footprint_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Footprint height.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.generate_mask_for_grad_from_pos" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shrink</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shrink factor to adjust the footprint (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.generate_mask_for_grad_from_pos" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="array_like" backlink-type="returned-by" backlink-anchor="pypty.utils.generate_mask_for_grad_from_pos" optional>array_like</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The constructed binary mask.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.complex_grad_to_phase_grad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complex_grad_to_phase_grad</span></code>

<a href="#reference-utils-pypty.utils.complex_grad_to_phase_grad" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert a Wirtinger derivative to the gradient with respect to the phase.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The Wirtinger derivative (dL/dz*).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_phase_grad" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The complex array (z = |z| exp(i*phase)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_phase_grad" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="array_like" backlink-type="returned-by" backlink-anchor="pypty.utils.complex_grad_to_phase_grad" optional>array_like</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The phase gradient (dL/dp).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.complex_grad_to_phase_abs_grad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complex_grad_to_phase_abs_grad</span></code>

<a href="#reference-utils-pypty.utils.complex_grad_to_phase_abs_grad" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the phase gradient and negative amplitude gradient from a complex gradient.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The Wirtinger derivative (dL/dz*).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_phase_abs_grad" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The complex array (z = exp(-a + i*phase)).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_phase_abs_grad" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy (default is cupy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_phase_abs_grad" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_phase_abs_grad" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>tuple of array_like</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A tuple containing:
- Phase gradient (dL/dp).
- Negative amplitude gradient (dL/da).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.complex_grad_to_mag_grad" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complex_grad_to_mag_grad</span></code>

<a href="#reference-utils-pypty.utils.complex_grad_to_mag_grad" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Calculate a magnitude gradient from a complex gradient and separate magnitude and phase arrays.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>grad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The complex gradient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_mag_grad" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The magnitude array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_mag_grad" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>phase</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The phase array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_mag_grad" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy (default is cupy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_mag_grad" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.complex_grad_to_mag_grad" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="array_like" backlink-type="returned-by" backlink-anchor="pypty.utils.complex_grad_to_mag_grad" optional>array_like</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The magnitude gradient.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.wolfe_1" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wolfe_1</span></code>

<a href="#reference-utils-pypty.utils.wolfe_1" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check the Armijo condition (Wolfe condition 1) for line search.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The current function value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_1" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The function value after the step.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_1" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The directional derivative at the current point.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_1" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Step size.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_1" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wolfe_c1</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Armijo condition constant (default is 0.5).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_1" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.5</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="bool" backlink-type="returned-by" backlink-anchor="pypty.utils.wolfe_1" optional>bool</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if the condition is satisfied, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.wolfe_2" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">wolfe_2</span></code>

<a href="#reference-utils-pypty.utils.wolfe_2" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check the curvature condition (Wolfe condition 2) for line search.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>d_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The directional derivative at the current point.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_2" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_d_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The directional derivative after the step.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_2" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wolfe_c2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Curvature condition constant (default is 0.9).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.wolfe_2" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.9</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="bool" backlink-type="returned-by" backlink-anchor="pypty.utils.wolfe_2" optional>bool</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if the condition is satisfied, False otherwise.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.upsample_something_3d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upsample_something_3d</span></code>

<a href="#reference-utils-pypty.utils.upsample_something_3d" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Upsample a 3D array along the last two axes.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>something</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The 3D array to be upsampled.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something_3d" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something_3d" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, scales the upsampled result to conserve total sum (default is True).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something_3d" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy (default is numpy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something_3d" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something_3d" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.upsample_something_3d" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The upsampled 3D array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.downsample_something_3d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">downsample_something_3d</span></code>

<a href="#reference-utils-pypty.utils.downsample_something_3d" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Downsample a 3D array along the last two axes.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>something</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The 3D array to be downsampled.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.downsample_something_3d" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Downsampling factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.downsample_something_3d" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.downsample_something_3d" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.downsample_something_3d" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The downsampled 3D array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.upsample_something" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">upsample_something</span></code>

<a href="#reference-utils-pypty.utils.upsample_something" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Upsample a 2D array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>something</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The 2D array to be upsampled.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scale</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, scales the result to conserve total sum (default is True).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module (default is numpy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.upsample_something" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.upsample_something" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The upsampled array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.downsample_something" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">downsample_something</span></code>

<a href="#reference-utils-pypty.utils.downsample_something" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Downsample a 2D array.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>something</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The 2D array to be downsampled.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.downsample_something" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Downsampling factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.downsample_something" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.downsample_something" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.downsample_something" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The downsampled array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_cupy_memory_usage" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_cupy_memory_usage</span></code>

<a href="#reference-utils-pypty.utils.get_cupy_memory_usage" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Print current CuPy GPU memory usage statistics.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_compute_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_compute_batch</span></code>

<a href="#reference-utils-pypty.utils.get_compute_batch" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Estimate the optimal compute batch size based on GPU memory usage.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>compute_batch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial guess or default.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_one_by_one</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether data is streamed instead of fully loaded.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hist_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>History size for optimizers.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>measured_data_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the input dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>memory_saturation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Proportion of GPU memory to use.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>smart_memory</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>User-provided memory strategy.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="callable" optional>callable</autoref> or <autoref identifier="bool" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding applied to data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obj_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the object array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the probe array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data type string ('single' or 'double').</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>propmethod</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Propagation method name.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Verbosity.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_compute_batch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="tuple" backlink-type="returned-by" backlink-anchor="pypty.utils.get_compute_batch" optional>tuple</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Suggested batch size, load_one_by_one flag, and memory strategy.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.preprocess_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">preprocess_dataset</span></code>

<a href="#reference-utils-pypty.utils.preprocess_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply preprocessing steps to the dataset including shifting, binning, padding, and scaling.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The input dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_one_by_one</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether data is loaded incrementally.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>algorithm_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Type of reconstruction algorithm.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>recon_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Type of reconstruction (e.g., near_field, far_field).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_shift_vector</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Vector indicating pixel shift in y and x.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_bin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binning factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding size.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor for the pattern.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_multiplier</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Factor to scale data intensity.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>force_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, apply forced padding.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="tuple" backlink-type="returned-by" backlink-anchor="pypty.utils.preprocess_dataset" optional>tuple</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Tuple containing:
- preprocessed dataset
- data_shift_vector
- data_bin
- data_pad
- data_multiplier</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_window" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_window</span></code>

<a href="#reference-utils-pypty.utils.get_window" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a circular cosine-tapered window mask.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the square window.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_window" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>r0</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Inner radius where tapering begins (normalized).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_window" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>r_max</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Outer radius where mask falls to zero (normalized).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_window" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inverted</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, returns 1 - mask (default is True).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.get_window" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.get_window" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>A 2D mask array of the specified shape.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.create_static_background_from_nothing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_static_background_from_nothing</span></code>

<a href="#reference-utils-pypty.utils.create_static_background_from_nothing" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate an initial static background if none is provided.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>static_background</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial static background value or None.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" optional>float</autoref> or <autoref identifier="ndarray" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe wavefunction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.create_static_background_from_nothing" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>damping_cutoff_multislice</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum spatial frequency used.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_static_background_from_nothing" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding to be applied.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_static_background_from_nothing" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor used.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_static_background_from_nothing" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Data type for output.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.create_static_background_from_nothing" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>recon_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Type of reconstruction ('near_field' or 'far_field').</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.create_static_background_from_nothing" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.create_static_background_from_nothing" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Initialized static background.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.create_probe_from_nothing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_probe_from_nothing</span></code>

<a href="#reference-utils-pypty.utils.create_probe_from_nothing" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate an initial probe guess when no valid probe is provided.</p>
<p>Depending on the input, this function either uses an aperture mask, computes a mean pattern
from the dataset, or adjusts an existing mean pattern to generate a probe. It applies shifting,
binning, padding, and scaling to produce a probe suitable for the specified reconstruction type.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input probe. If set to "aperture", the aperture mask is used. If None, the probe is generated
based on the mean pattern.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>ndarray, str, or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding size applied to the data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mean_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Mean pattern used to generate the probe if no probe is provided.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Aperture mask used when probe is set to "aperture".</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilt_mode</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating if tilt mode is active.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tilt values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Measured dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>estimate_aperture_based_on_binary</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Factor used to threshold the dataset for aperture estimation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" optional>bool</autoref> or <autoref identifier="float" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_x_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in the x-direction in angstroms.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_voltage</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Acceleration voltage in keV.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_multiplier</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Factor to scale the data intensity.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>masks</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional masks to apply to the mean pattern.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_shift_vector</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Vector indicating the shift to be applied to the data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list or tuple of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_bin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binning factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor applied to the pattern.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex_cpu</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex data type for CPU computations.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag controlling verbosity.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>algorithm</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Identifier for the reconstruction algorithm.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>measured_data_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the measured data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_obj_modes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of object modes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_marker</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Marker array for probe scenarios.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>recon_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Type of reconstruction ("near_field" or "far_field").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>defocus_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of defocus values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Cs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spherical aberration coefficient.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skip_preprocessing</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Default False. If True, preprocessing steps (rescaling) will be skipped</p>
              </div>
              <p>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.create_probe_from_nothing" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The generated probe as a complex array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.generate_hermite_modes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">generate_hermite_modes</span></code>

<a href="#reference-utils-pypty.utils.generate_hermite_modes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate Hermite polynomial-based probe modes from a main mode.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>main_mode</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The main probe mode.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.generate_hermite_modes" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_herm_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Max Degree of Hermite polynomials in x.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.generate_hermite_modes" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_herm_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Max Degree of Hermite polynomials in y.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.generate_hermite_modes" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex data type to use.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.generate_hermite_modes" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.generate_hermite_modes" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.generate_hermite_modes" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Stack of Hermite-based probe modes.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.apply_probe_modulation" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_probe_modulation</span></code>

<a href="#reference-utils-pypty.utils.apply_probe_modulation" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply defocus, aberrations, Hermite mode generation, and other modulations to the probe.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial probe.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extra_probe_defocus</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Defocus distance to apply.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_voltage</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Accelerating voltage in keV.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_x_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in x (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_y_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in y (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or <autoref identifier="ndarray" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to print info.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beam_ctf</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional beam CTF to apply.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_hermite_probe_modes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of Hermite modes in (y, x).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" optional>tuple</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>defocus_spread_modes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Defocus values to generate additional modes.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_marker</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe assignment array for multi-scenario.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex type.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float type.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.apply_probe_modulation" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Modulated probe array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.resample_slices" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">resample_slices</span></code>

<a href="#reference-utils-pypty.utils.resample_slices" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Resample the object along the slice (z) axis and optionally pad slices.</p>
<p>This utility optionally prepends/appends empty slices (<code>N_before</code>, <code>N_after</code>).
If <code>refactor_thickness != 1</code>, the slice sampling is refined by linear
interpolation along z (requires homogeneous <code>slice_distances</code>). After resampling,
the object is adjusted by a power-law to keep the effective thickness scaling.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>o</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Object array of shape <code>(Ny, Nx, Nz, Nm)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Parameter dictionary containing at least <code>"slice_distances"</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.utils.resample_slices" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>refactor_thickness</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Factor by which to refine slice sampling (default is 1). Values &gt; 1 increase
the number of slices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.resample_slices" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N_before</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of empty slices to prepend (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.resample_slices" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N_after</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of empty slices to append (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.resample_slices" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>o</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Resampled/padded object array.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated parameter dictionary. Keys updated:</p>
<ul>
<li><code>slice_distances</code></li>
<li><code>total_thickness</code></li>
<li><code>obj</code></li>
</ul>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.utils.resample_slices" optional>dict</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><autoref identifier="ValueError" backlink-type="raised-by" backlink-anchor="pypty.utils.resample_slices" optional>ValueError</autoref></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If <code>refactor_thickness != 1</code> but <code>slice_distances</code> are not homogeneous.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.probe_modes_from_spreads" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">probe_modes_from_spreads</span></code>

<a href="#reference-utils-pypty.utils.probe_modes_from_spreads" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate a coherent-mode expansion of a partially coherent probe via MC sampling + SVD.</p>
<p>The probe is perturbed by random transverse shifts (spatial coherence) and
defocus offsets (focal spread) in reciprocal space. The resulting ensemble is
reshaped into a matrix and decomposed with SVD; the leading left singular
vectors are returned as coherent modes in real space.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe array. Expected shape is <code>(Ny, Nx, 1)</code> (real-space). Only the first
mode is used as the starting point.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref> or <autoref identifier="cupy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Electron wavelength in Å.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rez_px_size_rad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reciprocal-space sampling in radians per pixel.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>focal_spread</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Standard deviation of defocus spread (Å).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spatial_coh_x_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>RMS spatial coherence in x (Å). Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spatial_coh_y_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>RMS spatial coherence in y (Å). Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>spatial_coh_xy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Correlation coefficient between x/y coherence in <code>[-1, 1]</code>. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_modes</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of coherent modes to return (default is 4).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>4</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_samples</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of Monte-Carlo samples used to build the ensemble (default is 256).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>256</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>seed</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Random seed for sampling (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding (pixels) to crop before SVD and then restore afterwards for far-field
reconstructions (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>recon_type</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If not <code>"near_field"</code>, the function optionally crops/pads the probe in
reciprocal space by <code>data_pad</code> (default is "far_field").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="far_field" optional>far_field</autoref>, <autoref identifier="near_field" optional>near_field</autoref>)</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#34;far_field&#34;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, typically <code>numpy</code> or <code>cupy</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.probe_modes_from_spreads" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>modes_r</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Real-space coherent probe modes of shape <code>(Ny, Nx, n_modes)</code>.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref> or <autoref identifier="cupy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The mode weights are absorbed into the returned amplitudes; i.e., the returned
modes are already scaled by <code>sqrt(lambda_i)</code>.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.convert_num_to_nmab" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_num_to_nmab</span></code>

<a href="#reference-utils-pypty.utils.convert_num_to_nmab" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert a number of aberration terms to (n, m, ab) indices based on Krivanek notation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>num_abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.convert_num_to_nmab" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>tuple of lists</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Lists of n, m, and ab strings ('', 'a', or 'b') for each aberration mode.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.nmab_to_strings" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">nmab_to_strings</span></code>

<a href="#reference-utils-pypty.utils.nmab_to_strings" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert aberration indices into string identifiers in Krivanek notation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>possible_n</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of radial indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>possible_m</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of azimuthal indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>possible_ab</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of aberration mode types ('', 'a', 'b').</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of str</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>list of str</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of formatted aberration identifiers like 'C10', 'C12a', etc.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_ctf_matrix" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ctf_matrix</span></code>

<a href="#reference-utils-pypty.utils.get_ctf_matrix" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate a matrix of phase contributions for all aberration modes.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>kx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in x-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_matrix" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ky</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in y-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_matrix" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_abs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_matrix" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Electron wavelength.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_matrix" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>backend (default is cupy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_matrix" optional>module</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_matrix" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.get_ctf_matrix" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>list of Zernike polynomials (num_abs, height, width) with phase contributions.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_ctf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ctf</span></code>

<a href="#reference-utils-pypty.utils.get_ctf" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the scalar contrast transfer function (CTF) from aberrations.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or <autoref identifier="ndarray" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in x-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ky</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in y-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Electron wavelength.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>angle_offset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional rotation angle in radians (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.get_ctf" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The computed CTF.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_ctf_derivatives" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ctf_derivatives</span></code>

<a href="#reference-utils-pypty.utils.get_ctf_derivatives" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute spatial derivatives of the CTF with respect to kx and ky.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or <autoref identifier="ndarray" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in x-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_derivatives" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ky</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in y-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_derivatives" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Electron wavelength.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_derivatives" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>angle_offset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional rotation angle (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_derivatives" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>tuple of ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Derivatives of CTF with respect to kx and ky.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_ctf_gradient_rotation_angle" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_ctf_gradient_rotation_angle</span></code>

<a href="#reference-utils-pypty.utils.get_ctf_gradient_rotation_angle" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute the gradient of the phase with respect to rotation angle.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or <autoref identifier="ndarray" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>kx</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in x-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_gradient_rotation_angle" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ky</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Spatial frequency in y-direction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_gradient_rotation_angle" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wavelength</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Electron wavelength.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_gradient_rotation_angle" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>angle_offset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Additional angular offset (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.get_ctf_gradient_rotation_angle" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>tuple of ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Derivatives of the CTF gradient in x and y directions with respect to angular change.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.apply_defocus_probe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">apply_defocus_probe</span></code>

<a href="#reference-utils-pypty.utils.apply_defocus_probe" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply a defocus phase shift to a probe in Fourier space.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The input probe wavefunction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>distance</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Defocus distance in meters.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_voltage</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Acceleration voltage in kiloelectronvolts (keV).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_x_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size along x in angstroms.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pixel_size_y_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size along y in angstroms.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex data type for computation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float data type for computation.
xp : module, optional
Array module, e.g., numpy or cupy</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.apply_defocus_probe" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The defocused probe.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.padfft" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">padfft</span></code>

<a href="#reference-utils-pypty.utils.padfft" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Pad the input array in Fourier space by padding its FFT.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input array to be padded.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.padfft" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of pixels to pad on each side.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.padfft" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.padfft" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The padded array in spatial domain.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.padprobetodatafarfield" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">padprobetodatafarfield</span></code>

<a href="#reference-utils-pypty.utils.padprobetodatafarfield" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Pad or crop a probe in Fourier space to match far-field data dimensions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The probe wavefunction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatafarfield" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>measured_data_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the measured data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatafarfield" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding applied to the data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatafarfield" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor used in the reconstruction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatafarfield" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.padprobetodatafarfield" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Adjusted probe wavefunction.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.padprobetodatanearfield" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">padprobetodatanearfield</span></code>

<a href="#reference-utils-pypty.utils.padprobetodatanearfield" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Pad or crop a probe for near-field reconstruction.</p>
<p>This function adjusts the probe wavefunction by padding or cropping it to match the
near-field measured data dimensions after upsampling and padding.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The input probe wavefunction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatanearfield" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>measured_data_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the measured data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatanearfield" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data_pad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding size applied to the data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatanearfield" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample_pattern</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor applied to the measured data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.padprobetodatanearfield" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.padprobetodatanearfield" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The adjusted probe wavefunction.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.prepare_main_loop_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_main_loop_params</span></code>

<a href="#reference-utils-pypty.utils.prepare_main_loop_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Prepare main loop parameters for reconstruction.</p>
<p>This function adjusts scan positions, pads the object if necessary, handles subpixel corrections,
and computes the electron wavelength based on the accelerating voltage.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>algorithm</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Identifier for the reconstruction algorithm.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="any" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>any</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The probe array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The object array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of scan positions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of tilt angles.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>measured_data_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of the measured data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_voltage</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Accelerating voltage in keV.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>allow_subPixel_shift</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, compute subpixel corrections (default is True).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sequence</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sequence of indices for positions (default is None, which uses full range).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" optional>list</autoref> or <autoref identifier="callable" optional>callable</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>use_full_FOV</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, use full field-of-view adjustments (default is False).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Verbosity flag (default is 0).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float_cpu</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float data type for CPU computations (default is np.float64).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="data" optional>data</autoref> - <autoref identifier="type" optional>type</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.float64" optional hover>float64</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex_cpu</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex data type for CPU computations (default is np.complex128).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="data" optional>data</autoref> - <autoref identifier="type" optional>type</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.complex128" optional hover>complex128</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_int_cpu</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Integer data type for CPU computations (default is np.int64).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="data" optional>data</autoref> - <autoref identifier="type" optional>type</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.int64" optional hover>int64</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe_constraint_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional mask for probe constraints.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional aperture mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extra_space_on_side_px</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Padding to add around the object. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ignore_positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, skip position adjustments. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Padded object array.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Adjusted integer scan positions.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>zero_placeholder</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Placeholder zero (reserved for future use).</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="returned-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>int</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sequence</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sequence of indices used for processing.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="returned-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>list</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wavelength</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Computed electron wavelength in angstroms.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.utils.prepare_main_loop_params" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_pos_correction</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sub-pixel corrections for scan positions.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts_correction</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Zero array matching <code>tilts</code> shape.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture_mask</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Selected probe constraint or aperture mask.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref> or None</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.try_to_initialize_beam_current" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">try_to_initialize_beam_current</span></code>

<a href="#reference-utils-pypty.utils.try_to_initialize_beam_current" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Initialize beam current array or pad if it's too short.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>beam_current</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Existing beam current values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>measured_data_shape</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Shape of measured dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="tuple" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_initialize_beam_current" optional>tuple</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float type for the array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_initialize_beam_current" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_initialize_beam_current" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.try_to_initialize_beam_current" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Initialized or padded beam current.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.save_updated_arrays" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_updated_arrays</span></code>

<a href="#reference-utils-pypty.utils.save_updated_arrays" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save current reconstruction state and log loss metrics during training.</p>
<p>This function saves checkpoints for object, probe, tilts, scan positions, static background, 
aberration coefficients, and beam current if specified. It also logs loss and constraint 
contributions in a CSV file if logging is enabled.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_folder</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Directory where files will be saved.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epoch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current epoch number.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_probe_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the current probe.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_probe_pos_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save current scan positions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_tilts_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save current tilts.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_obj_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the current object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Object array to save.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or <autoref identifier="xp.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe array to save.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or <autoref identifier="xp.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tilt correction values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_pos_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sub-pixel scan position correction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Integer scan positions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Original tilt values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_background</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Static background array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or <autoref identifier="xp.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_aberrations_array_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save aberration array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_static_background_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save static background.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Not used inside the function.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_loss</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current loss value.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_sse</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current sum of squared errors.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or <autoref identifier="xp.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beam_current</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of beam current values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or <autoref identifier="xp.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_beam_current_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save beam current.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to trigger checkpoint saving.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_loss_log</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to log loss. If set to 2, log full breakdown of constraints.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" optional>bool</autoref> or <autoref identifier="int" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>constraint_contributions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of constraint term contributions to the loss.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>list</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>actual_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Step size applied in the optimizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>count_linesearch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of line search iterations.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>d_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial directional derivative.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_d_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>New directional derivative after the step.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_update_step_bfgs</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Step size suggested by BFGS or optimizer.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>t0</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Start time of the epoch (used for timing).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>NumPy or CuPy module used for computation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warnings</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Warning string to be logged.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.save_updated_arrays" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.prepare_saving_stuff" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_saving_stuff</span></code>

<a href="#reference-utils-pypty.utils.prepare_saving_stuff" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Prepare folder and loss CSV for saving training logs.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_folder</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Directory for results.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_saving_stuff" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_loss_log</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save loss values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_saving_stuff" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epoch_prev</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Previous epoch index.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.prepare_saving_stuff" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.print_pypty_header" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_pypty_header</span></code>

<a href="#reference-utils-pypty.utils.print_pypty_header" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Print formatted header announcing start of reconstruction.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.print_pypty_header" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_folder</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Directory where results are saved.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.print_pypty_header" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save_loss_log</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether loss logging is enabled.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_pypty_header" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.save_current_checkpoint_obj_probe" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_current_checkpoint_obj_probe</span></code>

<a href="#reference-utils-pypty.utils.save_current_checkpoint_obj_probe" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save intermediate reconstruction data as checkpoints.</p>
<p>This function saves the current state of the object, probe, tilt corrections, scan positions,
static background, and aberrations to disk. It is intended to allow resuming reconstruction
from the last checkpoint.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>output_folder</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Directory where checkpoint files will be saved.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The current object array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>ndarray or GPU array</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The current probe array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>ndarray or GPU array</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Correction values for tilt angles.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_pos_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sub-pixel correction values for scan positions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan positions array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tilt angles array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_background</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Static background array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_probe_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating whether to save the probe.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_obj_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating whether to save the object.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_probe_pos_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating whether to save the scan positions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_tilts_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating whether to save the tilt angles.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_static_background_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating whether to save the static background.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_aberrations_array_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating whether to save the aberrations array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The current aberrations array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>ndarray or GPU array</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beam_current</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>The current beam current array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>ndarray or GPU array or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bcstep</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flag indicating whether to save the beam current.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module (e.g., numpy or cupy).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.save_current_checkpoint_obj_probe" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.print_recon_state" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">print_recon_state</span></code>

<a href="#reference-utils-pypty.utils.print_recon_state" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Display current reconstruction progress including loss, optimization state, and updates.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>t0</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Start time of the epoch (Unix timestamp).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>algorithm</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Name of the loss or optimization algorithm used.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epoch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current training epoch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_loss</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loss value at current epoch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_sse</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sum of squared errors.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_obj_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether the object is being updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_probe_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether the probe is being updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_probe_pos_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether the scan grid is being updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_tilts_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether tilt corrections are being updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_static_background_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether static background is being updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_aberrations_array_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether aberration coefficients are being updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_beam_current_step</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether beam current is being updated.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>current_hist_length</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optimizer memory length (0=GD, 1=CG, &gt;1=BFGS).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Verbosity flag: 0 = silent, 1 = single-line print, 2 = verbose.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.print_recon_state" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.try_to_gpu" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">try_to_gpu</span></code>

<a href="#reference-utils-pypty.utils.try_to_gpu" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert all key reconstruction variables to GPU arrays if using CuPy.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>obj</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Object array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>probe</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Integer scan positions.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>full_pos_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Sub-pixel scan grid correction.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tilt values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tilts_correction</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Tilt corrections.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>masks</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Optional segmentation or region masks.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>defocus_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of defocus values per position.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>slice_distances</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Slice spacing in multislice simulations.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aperture_mask</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Probe aperture mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dataset</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Measured dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>load_one_by_one</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether dataset is streamed from disk.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>static_background</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Static background array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations_array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of aberration coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>beam_current</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Beam current scaling factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" optional>ndarray</autoref> or None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float precision dtype for casting.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_complex</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex precision dtype for casting.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_int</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Integer dtype for casting.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g., numpy or cupy</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="module" backlink-type="used-by" backlink-anchor="pypty.utils.try_to_gpu" optional>module</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="tuple" backlink-type="returned-by" backlink-anchor="pypty.utils.try_to_gpu" optional>tuple</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The same variables in GPU format (if using CuPy), with proper types.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_value_for_epoch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_value_for_epoch</span></code>

<a href="#reference-utils-pypty.utils.get_value_for_epoch" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Evaluate a list of values or functions at the current epoch.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>func_or_value</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of fixed values or callables.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="used-by" backlink-anchor="pypty.utils.get_value_for_epoch" optional>list</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epoch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current epoch number.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_value_for_epoch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float precision type.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.get_value_for_epoch" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="list" backlink-type="returned-by" backlink-anchor="pypty.utils.get_value_for_epoch" optional>list</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Evaluated values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.get_steps_epoch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_steps_epoch</span></code>

<a href="#reference-utils-pypty.utils.get_steps_epoch" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Evaluate step values for the current epoch.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>steps</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>List of (multiplier, callable) or fixed values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="used-by" backlink-anchor="pypty.utils.get_steps_epoch" optional>list</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epoch</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current training epoch.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.get_steps_epoch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>default_float</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Float precision type.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dtype" backlink-type="used-by" backlink-anchor="pypty.utils.get_steps_epoch" optional>dtype</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="list" backlink-type="returned-by" backlink-anchor="pypty.utils.get_steps_epoch" optional>list</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>List of step values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.lambda_to_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lambda_to_string</span></code>

<a href="#reference-utils-pypty.utils.lambda_to_string" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Extract lambda function source as a string.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>f</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Lambda function.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="function" backlink-type="used-by" backlink-anchor="pypty.utils.lambda_to_string" optional>function</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="str" backlink-type="returned-by" backlink-anchor="pypty.utils.lambda_to_string" optional>str</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Extracted string source of the lambda.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.convert_to_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_to_string</span></code>

<a href="#reference-utils-pypty.utils.convert_to_string" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert parameter dictionary to string format, including lambda serialization.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dicti2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Original parameter dictionary.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.utils.convert_to_string" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strip_dataset_from_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to exclude 'dataset' key (default is True).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.convert_to_string" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.utils.convert_to_string" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Dictionary with string values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.string_to_lambda" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">string_to_lambda</span></code>

<a href="#reference-utils-pypty.utils.string_to_lambda" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert stringified lambda expression to a Python function.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lambda_string</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Lambda string to evaluate.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.string_to_lambda" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="callable" optional>callable</autoref> or <autoref identifier="str" optional>str</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The resulting function or original string if evaluation fails.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.load_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_params</span></code>

<a href="#reference-utils-pypty.utils.load_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load parameter dictionary from a .pkl file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the .pkl parameter file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.load_params" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.utils.load_params" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Loaded parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.string_params_to_usefull_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">string_params_to_usefull_params</span></code>

<a href="#reference-utils-pypty.utils.string_params_to_usefull_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert string-encoded lambdas in parameter dictionary back to callables.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Parameter dictionary possibly containing lambda strings.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.utils.string_params_to_usefull_params" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.utils.string_params_to_usefull_params" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dictionary with callables.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.save_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">save_params</span></code>

<a href="#reference-utils-pypty.utils.save_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Save parameters to a .pkl file, optionally removing the dataset.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Output path for the parameter file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.save_params" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Parameter dictionary to save.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.utils.save_params" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>strip_dataset_from_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, remove the dataset entry.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.save_params" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.change_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">change_params</span></code>

<a href="#reference-utils-pypty.utils.change_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Update one or more entries in a saved parameter file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the .pkl parameter file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.change_params" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keys</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Key(s) to change.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>str or list of str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>new_values</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>New value(s) corresponding to <code>keys</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="any" optional>any</autoref> or <autoref identifier="list" optional>list</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.detect_changed_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">detect_changed_params</span></code>

<a href="#reference-utils-pypty.utils.detect_changed_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Check for manual hyperparameter edits and update in-memory list.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>list_hyperparams</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Current hyperparameter values.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="used-by" backlink-anchor="pypty.utils.detect_changed_params" optional>list</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>keys_hyperparams</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Names of hyperparameters to monitor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>list of str</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the .pkl parameter file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.detect_changed_params" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warnings</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Existing warning messages.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.detect_changed_params" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, print a warning when changes are detected.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.utils.detect_changed_params" optional>bool</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>list_hyperparams</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>list with changed hyperparameters</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="list" backlink-type="returned-by" backlink-anchor="pypty.utils.detect_changed_params" optional>list</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warnings</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated warning messages.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="returned-by" backlink-anchor="pypty.utils.detect_changed_params" optional>str</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.load_nexus_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">load_nexus_params</span></code>

<a href="#reference-utils-pypty.utils.load_nexus_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Load reconstruction parameters from a NeXus (.nxs) HDF5 file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_nexus</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the .nxs file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.load_nexus_params" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.utils.load_nexus_params" optional>dict</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Dictionary of extracted parameters.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.delete_dataset_from_params" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">delete_dataset_from_params</span></code>

<a href="#reference-utils-pypty.utils.delete_dataset_from_params" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Delete the 'dataset' key from saved parameter file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the pickled parameters file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.delete_dataset_from_params" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.phase_cross_corr_align" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">phase_cross_corr_align</span></code>

<a href="#reference-utils-pypty.utils.phase_cross_corr_align" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Align two FFT-transformed images using phase cross-correlation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>im_ref_fft</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Reference image FFT.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.phase_cross_corr_align" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>im_2_fft</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>FFT of the image to be aligned.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.phase_cross_corr_align" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>refine_box_dim</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the interpolation box for sub-pixel alignment.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.phase_cross_corr_align" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>upsample</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Upsampling factor for interpolation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.phase_cross_corr_align" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_real</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Real space x grid.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.phase_cross_corr_align" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_real</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Real space y grid.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ndarray" backlink-type="used-by" backlink-anchor="pypty.utils.phase_cross_corr_align" optional>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shift_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Predefined shift in y (optional).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" optional>float</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>shift_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Predefined shift in x (optional).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" optional>float</autoref> or None</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="ndarray" backlink-type="returned-by" backlink-anchor="pypty.utils.phase_cross_corr_align" optional>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Shifted FFT of the second image.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.segment_regions_from_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">segment_regions_from_image</span></code>

<a href="#reference-utils-pypty.utils.segment_regions_from_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Segment regions in an image based on edge detection and boundary blocking.</p>
<p>This function applies Gaussian smoothing to the input image, thresholds it to detect edges, 
dilates the edges to thicken boundaries, and inverts the result to identify regions. 
Finally, it labels connected regions in the image.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input 2D grayscale image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>threshold</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Intensity threshold for edge detection.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.segment_regions_from_image" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Standard deviation for Gaussian blur.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.segment_regions_from_image" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dilation_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Size of the dilation kernel for boundaries.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.segment_regions_from_image" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>labeled_regions</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D array where each region has a unique label.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>num_regions</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Total number of regions.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="returned-by" backlink-anchor="pypty.utils.segment_regions_from_image" optional>int</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>edge_mask</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Binary edge map.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.interpolate_label0_points" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">interpolate_label0_points</span></code>

<a href="#reference-utils-pypty.utils.interpolate_label0_points" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Interpolate positions for points with label == 0 using neighboring labeled samples.</p>
<p>The input <code>points</code> array stores measured coordinates (x, y) along with integer
grid indices (i, j) and a region label. For entries with <code>label == 0</code>, x/y are
interpolated from labeled entries in (i, j)-space using <code>scipy.interpolate.griddata</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of shape <code>(N, 5)</code> with columns <code>[x, y, i, j, label]</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Primary interpolation method for <code>griddata</code> (default is "linear").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="linear" optional>linear</autoref>, <autoref identifier="cubic" optional>cubic</autoref>, <autoref identifier="nearest" optional>nearest</autoref>)</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#34;linear&#34;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fallback</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Backup method used where the primary interpolation returns NaNs (default is
"nearest").</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="nearest" optional>nearest</autoref>, None)</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#34;nearest&#34;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Copy of <code>points</code> with x/y updated for rows where <code>label == 0</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.optimize_2d_block_shifts" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">optimize_2d_block_shifts</span></code>

<a href="#reference-utils-pypty.utils.optimize_2d_block_shifts" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Optimize per-region (block) shifts to enforce smooth scan-grid geometry.</p>
<p>The function assigns an (dx, dy) shift to each non-zero <code>label</code> such that:</p>
<ul>
<li>The discrete Laplacian of the resulting 2D displacement field is minimized
  (smoothness / low curvature), and</li>
<li>Points in each scan column/row align well to a line and preserve ordering.</li>
</ul>
<p>Points with <code>label == 0</code> are treated as unknowns and are filled by
<code>interpolate_label0_points</code> during optimization.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array of shape <code>(N, 5)</code> with columns <code>[x, y, i, j, label]</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>shifted_points</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Array of shape <code>(N, 5)</code> with updated x/y after optimal block shifts.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>block_shifts</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Mapping <code>label -&gt; (dx, dy)</code> for each optimized block.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.utils.optimize_2d_block_shifts" optional>dict</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.position_puzzling" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">position_puzzling</span></code>

<a href="#reference-utils-pypty.utils.position_puzzling" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Detect and correct block-wise scan-position discontinuities by segmentation + puzzling.</p>
<p>The function computes a Laplacian-based score on the scan-position field. If the
score exceeds <code>score_threshold</code>, it segments the displacement map into regions
and then solves for per-region shifts using <code>optimize_2d_block_shifts</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>points</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan positions of shape <code>(N, 2)</code> in (y, x) order.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref> or <autoref identifier="cupy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan grid size as <code>(Ny, Nx)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sigma</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Smoothing parameter used during segmentation (default is 0.4).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.position_puzzling" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0.4</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>score_threshold</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Threshold on the Laplacian score above which puzzling is applied (default is 1.2).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.position_puzzling" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1.2</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>puzzling_worked</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>True if segmentation found multiple regions and puzzling was applied.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="returned-by" backlink-anchor="pypty.utils.position_puzzling" optional>bool</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>points_np</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Corrected scan positions of shape <code>(N, 2)</code> (CPU array).</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.fit_vector_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit_vector_field</span></code>

<a href="#reference-utils-pypty.utils.fit_vector_field" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Fit a smooth displacement field from calibration points.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Nominal and observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Nominal and observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Xi</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid coordinates for mapping.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Yi</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid coordinates for mapping.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>tuple of numpy.ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Displacement fields (dV, dU).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.warp_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warp_image</span></code>

<a href="#reference-utils-pypty.utils.warp_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Warp image(s) based on a displacement field.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input image(s).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.utils.warp_image" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Displacement fields (U, V).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of numpy.ndarray</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.warp_image" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extra_angle_rotation_compensation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation angle in degrees. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.utils.warp_image" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warped image(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-utils-pypty.utils.intorplate_puzzled_obj" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">intorplate_puzzled_obj</span></code>

<a href="#reference-utils-pypty.utils.intorplate_puzzled_obj" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Interpolate a puzzled object array using a displacement field.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input object array of shape (Y, X, slices, modes).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref> or <autoref identifier="cupy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pos_old</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Original scan positions, shape (N, 2).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pos_new</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>New scan positions, shape (N, 2).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.utils.intorplate_puzzled_obj" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation method ('linear', 'nearest', etc.). Default is 'linear'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.utils.intorplate_puzzled_obj" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;linear&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xp</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Array module, e.g. numpy or cupy</p>
              </div>
              <p>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy" backlink-type="used-by" backlink-anchor="pypty.utils.intorplate_puzzled_obj" optional>numpy</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Interpolated object array with same shape as <code>array</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-se" heading-number="8.11"><h1 id="reference-se-pyptyse"><code>pypty.se</code><a class="headerlink" href="#reference-se-pyptyse" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.se"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.getvirtualhaadf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">getvirtualhaadf</span></code>

<a href="#reference-se-pypty.se.getvirtualhaadf" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute a virtual HAADF image from 4D-STEM data.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary with keys 'data_path', 'scan_size', 'plot', 'output_folder'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.se.getvirtualhaadf" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the image. Default is True.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.se.getvirtualhaadf" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>haadf</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>HAADF intensities array.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.get_aperture" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_aperture</span></code>

<a href="#reference-se-pypty.se.get_aperture" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Generate a binary aperture mask from diffraction data.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary with keys 'data_path', 'data_pad', 'plot', 'bright_threshold', 'flip_ky'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.se.get_aperture" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Updated dict including 'aperture_mask'.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="returned-by" backlink-anchor="pypty.se.get_aperture" optional>dict</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.create_binned_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_binned_dataset</span></code>

<a href="#reference-se-pypty.se.create_binned_dataset" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Downsample a dataset by spatial binning and save to a new file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>path_orig</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the original dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.create_binned_dataset" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_new</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to save the binned dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.create_binned_dataset" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>bin</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binning factor.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.create_binned_dataset" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><autoref identifier="IOError" backlink-type="raised-by" backlink-anchor="pypty.se.create_binned_dataset" optional>IOError</autoref></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If file operations fail.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.compensate_pattern_drift" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compensate_pattern_drift</span></code>

<a href="#reference-se-pypty.se.compensate_pattern_drift" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compensate drift in diffraction patterns via phase correlation.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>aperture</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Binary aperture mask.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>patterns</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>4D diffraction patterns.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Drift-compensated patterns.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.get_virtual_annular_detector" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_virtual_annular_detector</span></code>

<a href="#reference-se-pypty.se.get_virtual_annular_detector" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute virtual detector signal using annular masks.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>pypty_params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Dictionary with keys 'data_path', 'scan_size', 'plot', 'output_folder'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>inner_rad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Inner radius in normalized units. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>outer_rad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Outer radius in normalized units. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>save</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Whether to save the signal. Default is False.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>X-offset. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>offset_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Y-offset. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.get_virtual_annular_detector" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2D detector signal array.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.coordinate_transformation_2d" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">coordinate_transformation_2d</span></code>

<a href="#reference-se-pypty.se.coordinate_transformation_2d" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Map coordinates from XY space to UV space using polynomial coefficients.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Coordinates to transform. Shape (2, N) or (N, 2).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.coordinate_transformation_2d" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ab</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation coefficients. Length 3 (linear),
6 (quadratic), or 10 (cubic).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Transformed coordinates, shape (N, 2).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.find_ab" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">find_ab</span></code>

<a href="#reference-se-pypty.se.find_ab" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Estimate polynomial coefficients for coordinate mapping.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Source x-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Source y-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Target u-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Target v-coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>trafo_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation order: 0=linear, 1=quadratic, 2=cubic. Default is 2.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.find_ab" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>2</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Transformation coefficients.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.unwarp_im" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwarp_im</span></code>

<a href="#reference-se-pypty.se.unwarp_im" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Correct distortions and illumination in warped images.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>warp_im</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input image(s).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_im" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ab</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>method</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation method. Default is 'linear'.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_im" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;linear&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Unwarped image(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.coordinate_transformation_2d_areamag" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">coordinate_transformation_2d_areamag</span></code>

<a href="#reference-se-pypty.se.coordinate_transformation_2d_areamag" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute local area magnification of polynomial mapping.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>xy</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Coordinates of shape (2, N) or (N, 2).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.coordinate_transformation_2d_areamag" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ab</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Transformation coefficients.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Local magnification values.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>Original implementation by Wouter Van den Broek.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.fit_vector_field" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit_vector_field</span></code>

<a href="#reference-se-pypty.se.fit_vector_field" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Fit a smooth displacement field from calibration points.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Nominal coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Nominal coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>u</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>v</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Observed coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Xi</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid coordinates for mapping.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>Yi</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid coordinates for mapping.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.fit_vector_field" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>tuple of numpy.ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Displacement fields (dV, dU).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.warp_image" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warp_image</span></code>

<a href="#reference-se-pypty.se.warp_image" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Warp image(s) based on a displacement field.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>image</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input image(s).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_image" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Displacement fields (U, V).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of numpy.ndarray</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order. Default is 1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.warp_image" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>extra_angle_rotation_compensation</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation angle in degrees. Default is 0.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.warp_image" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warped image(s).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.compose_fields" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">compose_fields</span></code>

<a href="#reference-se-pypty.se.compose_fields" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compose two displacement fields for use with warp_image.</p>
<p>Resulting field corresponds to: first apply field1, then field2.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>field1</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>First displacement field. Applied closest to the original image.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="U1" optional>U1</autoref>, <autoref identifier="V1" optional>V1</autoref>)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>field2</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Second displacement field. Applied after field1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="U2" optional>U2</autoref>, <autoref identifier="V2" optional>V2</autoref>)</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order used to resample field1.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.compose_fields" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mode</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Boundary mode for map_coordinates (e.g. 'nearest', 'constant').</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.compose_fields" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;nearest&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>U_tot, V_tot : np.ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Composed displacement field such that:
warp_image(warp_image(I, field1), field2)
≈ warp_image(I, (U_tot, V_tot))</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.warp_images_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">warp_images_batch</span></code>

<a href="#reference-se-pypty.se.warp_images_batch" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Apply warping to a batch of images using precomputed indices.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>images</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batch of images.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Not used.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="ignored" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>ignored</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batches</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Batch indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warped_rows</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened row and column indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>warped_cols</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened row and column indices.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.warp_images_batch" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warped images.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.unwarp_4dstem_batch" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">unwarp_4dstem_batch</span></code>

<a href="#reference-se-pypty.se.unwarp_4dstem_batch" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Unwarp a 4D-STEM dataset in batches.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_old</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" optional>str</autoref> or <autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>path_numpy_new</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to save warped data.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_field</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Displacement fields.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of numpy.ndarray</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>batch_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Frames per batch. Default is 20.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>20</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>order</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Interpolation order. Default is 5.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>5</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>return_data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, return data instead of saving.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>False</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref> or None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Warped dataset or None.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RAISES</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
              <span class="doc-raises-annotation">
                  <code><autoref identifier="ValueError" backlink-type="raised-by" backlink-anchor="pypty.se.unwarp_4dstem_batch" optional>ValueError</autoref></code>
              </span>
            </td>
            <td class="doc-raises-details">
              <div class="doc-md-description">
                <p>If total frames not divisible by batch_size.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-se-pypty.se.remove_hot_pixels" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_hot_pixels</span></code>

<a href="#reference-se-pypty.se.remove_hot_pixels" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Remove hot pixels from 4D-STEM data.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Input dataset.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>percentile</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Threshold percentile. Default is 99.99.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.se.remove_hot_pixels" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>99.99</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Corrected dataset.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>



  </div>

    </div>

</div></section><section class="print-page" id="reference-vaa" heading-number="8.12"><h1 id="reference-vaa-pyptyvaa"><code>pypty.vaa</code><a class="headerlink" href="#reference-vaa-pyptyvaa" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">



<a id="pypty.vaa"></a>
    <div class="doc doc-contents first">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.plot_modes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_modes</span></code>

<a href="#reference-vaa-pypty.vaa.plot_modes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot probe/object modes in real and reciprocal space.</p>
<p>Shows four panels per mode: real-space magnitude/phase and Fourier-space
magnitude/phase.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ttt</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex mode stack. Accepted shapes are <code>(Ny, Nx, nmodes)</code> or
<code>(Ny, Nx, nstates, nmodes)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The function displays figures using Matplotlib.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.fit_aberrations_to_wave" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fit_aberrations_to_wave</span></code>

<a href="#reference-vaa-pypty.vaa.fit_aberrations_to_wave" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Fit aberration coefficients to a complex wave by matching Fourier phase.</p>
<p>The function computes the Fourier transform of <code>wave</code>, unwraps its phase
(optionally masked by magnitude threshold and angular cutoff), and fits a
Krivanek-style aberration expansion using nonlinear least squares.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>wave</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex real-space wave, shape <code>(Ny, Nx)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>px_size_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Real-space pixel size in Å.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_voltage</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Acceleration voltage in kV.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>thresh</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Relative magnitude threshold (fraction of max) used to mask Fourier pixels
before fitting.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>aberrations_guess</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Initial guess for aberration coefficients in Å. Length sets the number of
fitted aberration terms.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>array_like</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>[0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0]</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, show diagnostic plots (fitted phase, target phase, difference).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ftol</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Relative tolerance for termination by the change of the cost function.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1e-20</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>xtol</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Relative tolerance for termination by the change of the parameters.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1e-20</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>loss</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Loss function for <code>scipy.optimize.least_squares</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>str</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;linear&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_mrad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum scattering angle included in the fit, in mrad.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.fit_aberrations_to_wave" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code><autoref identifier="numpy.inf" optional hover>inf</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>aberrations</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Fitted aberration coefficients in Å.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>This routine assumes the Fourier phase of the wave is dominated by probe
aberrations after removing the center-of-mass (COM) tilt term.</p>
</details>

    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.mesh_model_positions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mesh_model_positions</span></code>

<a href="#reference-vaa-pypty.vaa.mesh_model_positions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute an ideal rotated scan grid from step size and angle.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>step_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Step size in the same units as <code>x</code>/<code>y</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.mesh_model_positions" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>angle_rad</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rotation angle in radians.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.mesh_model_positions" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened coordinate arrays describing the nominal scan grid.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened coordinate arrays describing the nominal scan grid.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>x_model, y_model : numpy.ndarray</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Modeled coordinates after applying the rotation and step size.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.mesh_objective_positions" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">mesh_objective_positions</span></code>

<a href="#reference-vaa-pypty.vaa.mesh_objective_positions" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Objective for fitting a rotated/stepped grid to measured positions.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ini_guess</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Two parameters <code>[step, angle]</code> where angle is in radians.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="array_like" backlink-type="used-by" backlink-anchor="pypty.vaa.mesh_objective_positions" optional>array_like</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened nominal grid coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened nominal grid coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened measured coordinates to be matched.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>mesh_y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Flattened measured coordinates to be matched.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.vaa.mesh_objective_positions" optional>float</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Sum of squared residuals between modeled and measured coordinates.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.get_step_angle_scan_grid" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_step_angle_scan_grid</span></code>

<a href="#reference-vaa-pypty.vaa.get_step_angle_scan_grid" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Estimate mean scan step and rotation angle from measured positions.</p>
<p>A simple global fit is performed assuming a rectangular scan grid that is
uniformly rotated and scaled.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Measured positions with shape <code>(N, 2)</code> ordered as <code>(y, x)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan grid size <code>(Ny, Nx)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, prints the standard deviation of the residuals in pixels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.vaa.get_step_angle_scan_grid" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>step</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Estimated step size (same units as <code>positions</code>).</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.vaa.get_step_angle_scan_grid" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>angle_deg</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Estimated rotation angle in degrees.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="returned-by" backlink-anchor="pypty.vaa.get_step_angle_scan_grid" optional>float</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.get_affine_tranform" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_affine_tranform</span></code>

<a href="#reference-vaa-pypty.vaa.get_affine_tranform" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Estimate an affine deformation matrix from measured scan positions.</p>
<p>The mapping is fit from ideal integer grid coordinates to measured positions
using linear least squares. The returned matrix is scaled by <code>px_size_A</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>positions</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Measured positions with shape <code>(N, 2)</code> ordered as <code>(y, x)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>scan_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scan grid size <code>(Ny, Nx)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>tuple of int</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>px_size_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size used to scale the affine transform, in Å.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.get_affine_tranform" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>print_flag</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, prints deformation and shift parameters.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.vaa.get_affine_tranform" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>deformation</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>2×2 deformation matrix mapping ideal grid vectors to measured coordinates,
scaled by <code>px_size_A</code>.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.add_scalebar_ax" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">add_scalebar_ax</span></code>

<a href="#reference-vaa-pypty.vaa.add_scalebar_ax" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Add a scale bar annotation to an image axis.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axis to draw into.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="matplotlib.axes.Axes" optional hover>Axes</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bottom-left corner of the bar in data coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bottom-left corner of the bar in data coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>width</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Scale bar length in <code>unit</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>height</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bar thickness in data pixels.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>x_t</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Text anchor position in data coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>y_t</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Text anchor position in data coordinates.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>px_size</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Pixel size in the same physical units as <code>width</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>unit</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Unit label (e.g. <code>'Å'</code>, <code>'nm'</code>).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fontsize</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Font size for the label.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.vaa.add_scalebar_ax" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>20</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The function modifies <code>ax</code> in place.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.outputlog_plots" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">outputlog_plots</span></code>

<a href="#reference-vaa-pypty.vaa.outputlog_plots" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot PyPty optimization log columns from a CSV file.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>loss_path</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Path to the CSV log file.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="str" backlink-type="used-by" backlink-anchor="pypty.vaa.outputlog_plots" optional>str</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>skip_first</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If nonzero, ignore iterations with epoch &lt; <code>skip_first</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.vaa.outputlog_plots" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot_time</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, adds a secondary x-axis showing elapsed time (hours).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.vaa.outputlog_plots" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>figs</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>One figure per plotted column.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code>list of matplotlib.figure.Figure</code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.radial_average" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">radial_average</span></code>

<a href="#reference-vaa-pypty.vaa.radial_average" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Compute radial average of a 2D Fourier-domain quantity.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ff</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>2D array to be radially averaged.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>r_bins</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Bin width in pixels (in Fourier grid radius units).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.radial_average" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>r_max</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum and minimum normalized radii (fractions of the max radius).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.radial_average" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>r_min</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum and minimum normalized radii (fractions of the max radius).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.radial_average" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>px_size_A</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Real-space pixel size in Å (used to label spatial frequency axis).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.radial_average" optional>float</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>plot</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If True, plots the radial average.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.vaa.radial_average" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>True</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Figure handle if <code>plot=True</code>.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="matplotlib.figure.Figure" optional hover>Figure</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.complex_pca" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complex_pca</span></code>

<a href="#reference-vaa-pypty.vaa.complex_pca" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Perform PCA on complex observations.</p>
<p>The last axis is treated as the observation axis. The covariance is computed
on mean-centered complex data and eigen-decomposed.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex array with shape <code>(Ny, Nx, N_obs)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>n_components</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of principal components to retain.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.vaa.complex_pca" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data_reduced</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Complex array with shape <code>(Ny, Nx, n_components)</code>.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.complex_array_to_rgb" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">complex_array_to_rgb</span></code>

<a href="#reference-vaa-pypty.vaa.complex_array_to_rgb" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Map a complex array to an RGB image using phase/magnitude encoding.</p>
<p>Hue encodes the complex phase. Magnitude is mapped either to value (dark theme)
or saturation (light theme).</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>X</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex array.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>theme</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Rendering theme.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="dark" optional>dark</autoref>, <autoref identifier="light" optional>light</autoref>)</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;dark&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rmax</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Magnitude used for normalization. If None, uses <code>abs(X).max()</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.complex_array_to_rgb" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>None</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>rgb</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>RGB image array with shape <code>X.shape + (3,)</code> and dtype float.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.plot_complex_modes" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_complex_modes</span></code>

<a href="#reference-vaa-pypty.vaa.plot_complex_modes" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Plot a subset of complex modes in RGB with intensity percentages.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>p</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Complex mode stack with shape <code>(Ny, Nx, nmodes)</code>.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nm</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of modes to plot.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.vaa.plot_complex_modes" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>sub</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Number of subplot rows.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.vaa.plot_complex_modes" optional>int</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>fig</code>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Figure handle.</p>
              </div>
                <p>
                  <span class="doc-returns-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="matplotlib.figure.Figure" optional hover>Figure</autoref></code>
                  </span>
                </p>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.plot_complex_colorwheel" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">plot_complex_colorwheel</span></code>

<a href="#reference-vaa-pypty.vaa.plot_complex_colorwheel" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Complex-plane color wheel legend on an axis.
This helper renders the HSV mapping used by :func:<code>complex_array_to_rgb</code> by drawing
a filled disk of radius <code>rmax</code> in the complex plane. Hue encodes the complex phase
(argument), while value/saturation encodes magnitude depending on <code>theme</code>.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ax</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Axis to draw into.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="matplotlib.axes.Axes" optional hover>Axes</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>theme</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Color theme that matches :func:<code>complex_array_to_rgb</code>. For <code>'dark'</code>, magnitude
is mapped to value (brightness) and saturation is fixed. For <code>'light'</code>,
magnitude is mapped to saturation.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code>(<autoref identifier="dark" optional>dark</autoref>, <autoref identifier="light" optional>light</autoref>)</code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>&#39;dark&#39;</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>N</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Grid size used to sample the complex plane (image will be <code>N x N</code>).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.vaa.plot_complex_colorwheel" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>512</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rmax</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Maximum radius shown in the colorwheel. Values outside the disk are set to a
uniform background.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="float" backlink-type="used-by" backlink-anchor="pypty.vaa.plot_complex_colorwheel" optional>float</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>1.0</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>fontsize</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Font size for the annotations ("0", <code>rmax</code>, and <code>2pi</code>).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="int" backlink-type="used-by" backlink-anchor="pypty.vaa.plot_complex_colorwheel" optional>int</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>15</code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>background</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>If truthy, sets the outside-of-disk background to white; otherwise uses a
theme-appropriate background (black for <code>'dark'</code>, white for <code>'light'</code>).</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="bool" backlink-type="used-by" backlink-anchor="pypty.vaa.plot_complex_colorwheel" optional>bool</autoref></code>
                  </span>
                  <span class="doc-param-default">
                    <b>DEFAULT:</b>
                      <code>0</code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code>None</code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>The function draws directly onto <code>ax</code>.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="reference-vaa-pypty.vaa.crop_ptycho_object_to_stem_roi" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">crop_ptycho_object_to_stem_roi</span></code>

<a href="#reference-vaa-pypty.vaa.crop_ptycho_object_to_stem_roi" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Crop a reconstructed ptychography object to the STEM scan region of interest.</p>
<p>The function rotates the object by <code>params["PLRotation_deg"]</code> (in degrees) without
reshaping and then crops the rotated object to the field of view implied by the
scan parameters.</p>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">PARAMETER</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>o</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>2D object array with axes (y, x). Can be real or complex.</p>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>params</code>
            </td>
            <td class="doc-param-details">
              <div class="doc-md-description">
                <p>Parameter dictionary. Must contain:</p>
<ul>
<li><code>PLRotation_deg</code> : float</li>
<li><code>scan_size</code> : tuple of int</li>
<li><code>scan_step_A</code> : float</li>
<li><code>pixel_size_x_A</code> : float</li>
<li><code>pixel_size_y_A</code> : float</li>
</ul>
              </div>
              <p>
                  <span class="doc-param-annotation">
                    <b>TYPE:</b>
                      <code><autoref identifier="dict" backlink-type="used-by" backlink-anchor="pypty.vaa.crop_ptycho_object_to_stem_roi" optional>dict</autoref></code>
                  </span>
              </p>
            </td>
          </tr>
      </tbody>
    </table>


<table>
      <thead>
        <tr>
          <th><span class="doc-section-title">RETURNS</span></th>
          <th><span>DESCRIPTION</span></th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <span class="doc-returns-annotation">
                    <code><autoref identifier="numpy.ndarray" optional hover>ndarray</autoref></code>
                </span>
            </td>
            <td class="doc-returns-details">
              <div class="doc-md-description">
                <p>Cropped object array with axes (y, x).</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


<details class="note" open>
  <summary>Notes</summary>
  <p>The crop size is computed in physical units (Å) from <code>scan_size*scan_step_A</code> and
then converted to pixels using the object pixel sizes.</p>
</details>

    </div>

</div>



  </div>

    </div>

</div></section></section></div><style>.print-site-enumerate-headings #index > h1:before { content: '1 ' }

                .print-site-enumerate-headings #index h2:before { content: '1.' counter(counter-index-2) ' ' }
                .print-site-enumerate-headings #index h2 {  counter-reset: counter-index-3 ;  counter-increment: counter-index-2 }
            
                .print-site-enumerate-headings #index h3:before { content: '1.' counter(counter-index-2) '.' counter(counter-index-3) ' ' }
                .print-site-enumerate-headings #index h3 {  counter-increment: counter-index-3 }
            
.print-site-enumerate-headings #experiment > h1:before { content: '2 ' }

                .print-site-enumerate-headings #experiment h2:before { content: '2.' counter(counter-experiment-2) ' ' }
                .print-site-enumerate-headings #experiment h2 {  counter-reset: counter-experiment-3 ;  counter-increment: counter-experiment-2 }
            
                .print-site-enumerate-headings #experiment h3:before { content: '2.' counter(counter-experiment-2) '.' counter(counter-experiment-3) ' ' }
                .print-site-enumerate-headings #experiment h3 {  counter-increment: counter-experiment-3 }
            
.print-site-enumerate-headings #example_breakdown > h1:before { content: '3 ' }

                .print-site-enumerate-headings #example_breakdown h2:before { content: '3.' counter(counter-example_breakdown-2) ' ' }
                .print-site-enumerate-headings #example_breakdown h2 {  counter-reset: counter-example_breakdown-3 ;  counter-increment: counter-example_breakdown-2 }
            
                .print-site-enumerate-headings #example_breakdown h3:before { content: '3.' counter(counter-example_breakdown-2) '.' counter(counter-example_breakdown-3) ' ' }
                .print-site-enumerate-headings #example_breakdown h3 {  counter-increment: counter-example_breakdown-3 }
            
.print-site-enumerate-headings #examples_direct > h1:before { content: '4 ' }

                .print-site-enumerate-headings #examples_direct h2:before { content: '4.' counter(counter-examples_direct-2) ' ' }
                .print-site-enumerate-headings #examples_direct h2 {  counter-reset: counter-examples_direct-3 ;  counter-increment: counter-examples_direct-2 }
            
                .print-site-enumerate-headings #examples_direct h3:before { content: '4.' counter(counter-examples_direct-2) '.' counter(counter-examples_direct-3) ' ' }
                .print-site-enumerate-headings #examples_direct h3 {  counter-increment: counter-examples_direct-3 }
            
.print-site-enumerate-headings #custom_presets > h1:before { content: '5 ' }

                .print-site-enumerate-headings #custom_presets h2:before { content: '5.' counter(counter-custom_presets-2) ' ' }
                .print-site-enumerate-headings #custom_presets h2 {  counter-reset: counter-custom_presets-3 ;  counter-increment: counter-custom_presets-2 }
            
                .print-site-enumerate-headings #custom_presets h3:before { content: '5.' counter(counter-custom_presets-2) '.' counter(counter-custom_presets-3) ' ' }
                .print-site-enumerate-headings #custom_presets h3 {  counter-increment: counter-custom_presets-3 }
            
.print-site-enumerate-headings #incoherent > h1:before { content: '6 ' }

                .print-site-enumerate-headings #incoherent h2:before { content: '6.' counter(counter-incoherent-2) ' ' }
                .print-site-enumerate-headings #incoherent h2 {  counter-reset: counter-incoherent-3 ;  counter-increment: counter-incoherent-2 }
            
                .print-site-enumerate-headings #incoherent h3:before { content: '6.' counter(counter-incoherent-2) '.' counter(counter-incoherent-3) ' ' }
                .print-site-enumerate-headings #incoherent h3 {  counter-increment: counter-incoherent-3 }
            
.print-site-enumerate-headings #compressed > h1:before { content: '7 ' }

                .print-site-enumerate-headings #compressed h2:before { content: '7.' counter(counter-compressed-2) ' ' }
                .print-site-enumerate-headings #compressed h2 {  counter-reset: counter-compressed-3 ;  counter-increment: counter-compressed-2 }
            
                .print-site-enumerate-headings #compressed h3:before { content: '7.' counter(counter-compressed-2) '.' counter(counter-compressed-3) ' ' }
                .print-site-enumerate-headings #compressed h3 {  counter-increment: counter-compressed-3 }
            
.print-site-enumerate-headings #section-8 > h1:before { content: '8 ' }
.print-site-enumerate-headings #reference-initialize > h1:before { content: '8.1 ' }

                .print-site-enumerate-headings #reference-initialize h2:before { content: '8.1.' counter(counter-reference-initialize-2) ' ' }
                .print-site-enumerate-headings #reference-initialize h2 {  counter-increment: counter-reference-initialize-2 }
            
.print-site-enumerate-headings #reference-dpc > h1:before { content: '8.2 ' }

                .print-site-enumerate-headings #reference-dpc h2:before { content: '8.2.' counter(counter-reference-dpc-2) ' ' }
                .print-site-enumerate-headings #reference-dpc h2 {  counter-increment: counter-reference-dpc-2 }
            
.print-site-enumerate-headings #reference-se > h1:before { content: '8.3 ' }

                .print-site-enumerate-headings #reference-se h2:before { content: '8.3.' counter(counter-reference-se-2) ' ' }
                .print-site-enumerate-headings #reference-se h2 {  counter-increment: counter-reference-se-2 }
            
.print-site-enumerate-headings #reference-tcbf > h1:before { content: '8.4 ' }

                .print-site-enumerate-headings #reference-tcbf h2:before { content: '8.4.' counter(counter-reference-tcbf-2) ' ' }
                .print-site-enumerate-headings #reference-tcbf h2 {  counter-increment: counter-reference-tcbf-2 }
            
.print-site-enumerate-headings #reference-direct > h1:before { content: '8.5 ' }

                .print-site-enumerate-headings #reference-direct h2:before { content: '8.5.' counter(counter-reference-direct-2) ' ' }
                .print-site-enumerate-headings #reference-direct h2 {  counter-increment: counter-reference-direct-2 }
            
.print-site-enumerate-headings #reference-iterative > h1:before { content: '8.6 ' }

                .print-site-enumerate-headings #reference-iterative h2:before { content: '8.6.' counter(counter-reference-iterative-2) ' ' }
                .print-site-enumerate-headings #reference-iterative h2 {  counter-increment: counter-reference-iterative-2 }
            
.print-site-enumerate-headings #reference-objective > h1:before { content: '8.7 ' }

                .print-site-enumerate-headings #reference-objective h2:before { content: '8.7.' counter(counter-reference-objective-2) ' ' }
                .print-site-enumerate-headings #reference-objective h2 {  counter-increment: counter-reference-objective-2 }
            
.print-site-enumerate-headings #reference-multislice_core > h1:before { content: '8.8 ' }

                .print-site-enumerate-headings #reference-multislice_core h2:before { content: '8.8.' counter(counter-reference-multislice_core-2) ' ' }
                .print-site-enumerate-headings #reference-multislice_core h2 {  counter-increment: counter-reference-multislice_core-2 }
            
.print-site-enumerate-headings #reference-fft > h1:before { content: '8.9 ' }

                .print-site-enumerate-headings #reference-fft h2:before { content: '8.9.' counter(counter-reference-fft-2) ' ' }
                .print-site-enumerate-headings #reference-fft h2 {  counter-increment: counter-reference-fft-2 }
            
.print-site-enumerate-headings #reference-utils > h1:before { content: '8.10 ' }

                .print-site-enumerate-headings #reference-utils h2:before { content: '8.10.' counter(counter-reference-utils-2) ' ' }
                .print-site-enumerate-headings #reference-utils h2 {  counter-increment: counter-reference-utils-2 }
            
.print-site-enumerate-headings #reference-se > h1:before { content: '8.11 ' }

                .print-site-enumerate-headings #reference-se h2:before { content: '8.11.' counter(counter-reference-se-2) ' ' }
                .print-site-enumerate-headings #reference-se h2 {  counter-increment: counter-reference-se-2 }
            
.print-site-enumerate-headings #reference-vaa > h1:before { content: '8.12 ' }

                .print-site-enumerate-headings #reference-vaa h2:before { content: '8.12.' counter(counter-reference-vaa-2) ' ' }
                .print-site-enumerate-headings #reference-vaa h2 {  counter-increment: counter-reference-vaa-2 }
            </style>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "/", "features": ["math", "navigation.expand", "navigation.sections", "content.code.annotate", "content.tabs.link"], "search": "assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="assets/javascripts/bundle.c8b220af.min.js"></script>
      
        <script src="js/print-site.js"></script>
      
    
  </body>
</html>