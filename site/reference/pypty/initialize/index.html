
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
        <link rel="prev" href="../ini_custom/">
      
      
        <link rel="next" href="../dpc/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.9">
    
    
      
        <title>initialize - PyPty (python + ptychography)</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.4af4bdda.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../stylesheets/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="cyan">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-pyptyinitialize" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../.." title="PyPty (python + ptychography)" class="md-header__button md-logo" aria-label="PyPty (python + ptychography)" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            PyPty (python + ptychography)
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              initialize
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="cyan"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="teal"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="PyPty (python + ptychography)" class="md-nav__button md-logo" aria-label="PyPty (python + ptychography)" data-md-component="logo">
      
  <img src="../../logo.png" alt="logo">

    </a>
    PyPty (python + ptychography)
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../pypty/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Overview & Installation
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../custom_presets/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide for creating custom presets
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../ini_custom/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guide for using provided initialization routines
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
      
        
        
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" checked>
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="">
            
  
  <span class="md-ellipsis">
    API Reference
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            API Reference
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    initialize
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    initialize
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../dpc/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    dpc
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../direct_ptychography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    direct_ptychography
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../tcbf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    tcbf
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../signal_extraction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    signal_extraction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../iterative_ptychography/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    iterative_ptychography
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../loss_and_direction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    loss_and_direction
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../multislice/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    multislice
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../fft/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    fft
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../utils/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    utils
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../vaa/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    vaa
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#functions" class="md-nav__link">
    <span class="md-ellipsis">
      Functions
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="module-pyptyinitialize">Module pypty.initialize<a class="headerlink" href="#module-pyptyinitialize" title="Permanent link">&para;</a></h1>
<h2 id="functions">Functions<a class="headerlink" href="#functions" title="Permanent link">&para;</a></h2>
<p><code>append_aperture_to_params(pypty_params, mean_pattern)</code>
:   Append a measured aperture to the reconstruction parameters.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
mean_pattern : ndarray
    Aperture image to be rescaled and added.

Returns
-------
dict
    Updated dictionary with aperture.
</code></pre></div>
<p><code>append_exp_params(experimental_params, pypty_params=None)</code>
:   Attach experimental parameters to a PyPty preset dictionary and callibrate an extisting PyPty preset to new data. </p>
<div class="highlight"><pre><span></span><code>Parameters
----------
experimental_params : dict
    Dictionary containing experimental metadata and setup for PyPty reconstruction.
pypty_params : dict or str or None, optional
    Existing PyPty preset to update, a filepath to a preset, or None to create a new one.

Returns
-------
dict
    Updated PyPty parameter dictionary.

Notes
-------
experimental_params should contain following entries:
    -data_path - path to a PyPty-style 3d .h5 file [N_measurements, ky,kx] or .npy Nion-style 4d-stem dataset (or 3d .npy dataset)
    -masks - 3d numpy array or None. if data is compressed provide the virtual detectors (masks) shape should be [N_masks,ky,kx]
    -output_folder - path to an outputfolder where the results will be stored
    -path_json - path to a nion-style json file with metadata (optional)
    -acc_voltage - float, accelerating voltage in kV

    One or multiple of the following callibrations:
        -rez_pixel_size_A - reciprocal pixel size in Å^-1
        -rez_pixel_size_mrad - reciprocal pixel size in mrad

        -conv_semiangle_mrad - beam convergence semi-angle in mrad
        -aperture - (optional)- binary 2D mask
        -bright_threshold - threshold to estimate an aperture, everything above threshold times maximum value in a pacbed will be concidered as bright field disk.
    -data_pad - int, reciprocal space padding. If None (default), pading is 1/4 of the total width of a diffraction pattern
    -upsample_pattern - int, default 1 (no upsampling)

    -aberrations - list or 1d numpy array containing beam aberrations (in Å). Aberrations are stored in Krivanek notation, e.g. C10, C12a, C12b, C21a, C21b, C23a, C23b, C30 etc
    -defocus - float, default 0. Extra probe defocus besides the one contained in aberrations.

    -scan_size - tuple of two ints, number of scan points along slow (y) and fast (x) axes. Optional. If no scan step or position grid is provided, it will be used to get the scan step
    -scan_step_A - float, scan step (STEM pixel size) in Å.
    -fov_nm - float, FOV along the fast axis in nm.
    -special_postions_A - 2d numpy array, default None. If you acquiered a data on a special non-rectangular grid, please specify the positions in Å via this array for all measurements in a following form: [y_0,x_0],[y_1,x_1],....[y_n,x_n]]
    -transform_axis_matrix- 2x2 matrix for postions transformation
    -PLRotation_deg - float, rotation angle between scan and detector axes. Default None. If None, a DPC measurement will be exectuted to get this angle. !!!!!!! Note that negative PLRotation_deg values rotate scan counter clockwise and diffraction space clockwise !!!!!!!!!!!
    -flip_ky - boolean Flag. Default is False. If no PyPty-style h5 data was created, this flag will flip the y-axis of diffraction patterns.

    -total_thickness - total thickness of a sample in Å. Has no effect if num_slices is 1 and propagation method (pypty_params entry) is multislice 
    -num_slices - integer, number of slices, default is 1.

    -plot - boolean Flag, default is True 
    -print_flag - integer. Default is 1. If 0 nothing will be printed. 1 prints only thelatest state of the computation, 2 prints every state as a separate line. 3 prints the linesearch progress in iterative optimization. 4 prints everything that 3 does and if constraints are applied, it prints how they contribute so that a user can configure the weights properly.
    -save_preprocessing_files - Boolean Flag. Default is True.
</code></pre></div>
<p><code>conjugate_beam(pypty_params)</code>
:   Apply beam conjugation (flip defocus and aberrations).</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.

Returns
-------
dict
    Updated dictionary with conjugated probe and CTF.
</code></pre></div>
<p><code>create_aberrations_chunks(pypty_params, chop_size, n_abs)</code>
:   Create chunks, i.e. multiple subscans with independent beam aberrations. Usefull for large fields of view where the beam is varyying. If applied, the iterative reconstruction will have the same beam in each subscan, but apply a different CTF in each of these regions.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
chop_size : int
    Size of each subscan region (in scan points).
n_abs : int
    Number of aberration coefficients per region.

Returns
-------
dict
    Updated parameter dictionary with aberration array and marker.
</code></pre></div>
<p><code>create_probe_marker_chunks(pypty_params, chop_size)</code>
:   Creates chunks, i.e. multiple subscans with independent beam aberrations. Usefull for large fields of view where the beam is varyying. If applied, the iterative reconstruction will have the a differenet beam in each of these subscans.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
chop_size : int
    Size of each subscan region (in scan points).

Returns
-------
dict
    Updated dictionary with probe marker.
</code></pre></div>
<p><code>create_pypty_data(data, path_output, swap_axes=False, flip_ky=False, flip_kx=False, flip_y=False, flip_x=False, comcalc_len=1000, comx=None, comy=None, bin=1, crop_left=None, crop_right=None, crop_top=None, crop_bottom=None, normalize=False, cutoff_ratio=None, pad_k=0, data_dtype=numpy.float32, rescale=1, exist_ok=True)</code>
:   Create a PyPty-style <code>.h5</code> dataset from 4D-STEM data.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
data : str or ndarray
    Path to `.h5` or `.npy` data file or a 4D numpy array [scan_y, scan_x, ky, kx].
path_output : str
    Output file path for the PyPty `.h5` dataset.
swap_axes : bool, optional
    Swap the last two axes (kx, ky). Default is False.
flip_ky, flip_kx, flip_y, flip_x : bool, optional
    Flip the data along specific axes. Default is False.
comcalc_len : int, optional
    Number of patterns to use to estimate center-of-mass. Default is 1000.
comx, comy : int or None, optional
    Predefined center-of-mass. If None, it will be computed.
bin : int, optional
    Spatial binning factor on the diffraction patterns. Default is 1.
crop_left, crop_right, crop_top, crop_bottom : int or None, optional
    Crop edges of patterns. Defaults are None.
normalize : bool, optional
    Normalize pattern sums to 1. Default is False.
cutoff_ratio : float or None, optional
    Mask out pixels farther than `cutoff_ratio × max_radius`. Default is None.
pad_k : int, optional
    Padding to apply to diffraction patterns. Default is 0.
data_dtype : dtype, optional
    Output data type. Default is np.float32.
rescale : float, optional
    Scale factor for intensity. Default is 1.
exist_ok : bool, optional
    If True, skip writing if file exists. Default is True.

Returns
-------
None

Notes
-----
Saves a `.h5` file containing processed 4D-STEM data with standardized formatting for PyPty.
</code></pre></div>
<p><code>create_sequence_from_points(pypty_params, yf, xf, width_roi=20)</code>
:   Create scan subsequence around specified feature points.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
yf : list of int
    Y-coordinates of feature points (in scan points).
xf : list of int
    X-coordinates of feature points.
width_roi : int, optional
    Width of the reconstruction window around each point.

Returns
-------
list
    List of scan indices to reconstruct.
</code></pre></div>
<p><code>create_sub_sequence(pypty_params, left, top, width, height, sub)</code>
:   Define a measurement subsequence for local reconstructions.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
left : int
    Leftmost scan coordinate.
top : int
    Top scan coordinate.
width : int
    Width of subregion (in scan points).
height : int
    Height of subregion (in scan points).
sub : int
    Sampling factor (take every Nth point).

Returns
-------
dict
    Updated parameter dictionary with `sequence` key.
</code></pre></div>
<p><code>get_approx_beam_tilt(pypty_params, power=3, make_binary=False, percentile_filter_value=None, percentile_filter_size=10)</code>
:   Estimate scan-position-dependent beam tilt from PACBED. </p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
power : int or str
    Degree of polynomial fitting.
make_binary : bool or float
    If True or float &gt; 0, binarize patterns.
percentile_filter_value : float or None
    Value for optional percentile filtering.
percentile_filter_size : int
    Filter size if filtering is enabled.

Returns
-------
dict
    Updated dictionary with estimated tilts.
</code></pre></div>
<p><code>get_focussed_probe_from_vacscan(pypty_params, mean_pattern)</code>
:   Reconstruct a focused probe from a vacuum PACBED pattern.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
mean_pattern : ndarray
    Measured PACBED from vacuum.

Returns
-------
dict
    Updated dictionary with a probe estimate.
</code></pre></div>
<p><code>get_grid_for_upsampled_image(pypty_params, image, image_pixel_size, left_zero_of_scan_grid=0, top_zero_of_scan_grid=0)</code>
:   Map coordinates of an upsampled image onto the reconstruction grid.</p>
<div class="highlight"><pre><span></span><code>This function calculates where pixel of an arbitary image (e.g. upsampled tcBF image) will land on a grid corresponding to a ptychographic reconstruction.


Parameters
----------
pypty_params : dict
    Dictionary of PyPty reconstruction parameters.
image : ndarray
    2D image (e.g., upsampled tcBF) to map.
image_pixel_size : float
    Pixel size of the image in Å.
left_zero_of_scan_grid : int, optional
    Pixel offset on left side of image relative to scan grid. Default is 0.
top_zero_of_scan_grid : int, optional
    Pixel offset on top side of image relative to scan grid. Default is 0.

Returns
-------
sc : ndarray
    Array of pixel coordinates [[y, x], ...] in reconstruction grid units.
</code></pre></div>
<p><code>get_offset(x_range, y_range, scan_step_A, detector_pixel_size_rezA, patternshape, rot_angle_deg=0)</code>
:   Compute pixel offsets between scan grid and reconstruction grid. In PyPty framework, scan grid is usually rotated to compensate the misalignment between scan- and detector- axes. Also, a reconstruction grid is larger than the scanned FOV, this is done to accomodate the extent of the probe. </p>
<div class="highlight"><pre><span></span><code>Parameters
----------
x_range, y_range : int
    Scan dimensions.
scan_step_A : float
    STEM scan step size in Å.
detector_pixel_size_rezA : float
    Reciprocal space pixel size in Å⁻¹.
patternshape : tuple
    Shape of diffraction patterns.
rot_angle_deg : float, optional
    Rotation between scan and detector axes (degrees).

Returns
-------
offy, offx : float
    Offset values (in reconstruction pixels).
</code></pre></div>
<p><code>get_positions_pixel_size(x_range, y_range, scan_step_A, detector_pixel_size_rezA, patternshape, rot_angle_deg=0, flip_x=False, flip_y=False, print_flag=False, transform_axis_matrix=array([[1., 0.],
       [0., 1.]]))</code>
:   Generate scan positions in reconstruction pixel units.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
x_range, y_range : int
    Scan grid size.
scan_step_A : float
    STEM scan step size (Å).
detector_pixel_size_rezA : float
    Pixel size in reciprocal space (Å⁻¹).
patternshape : tuple
    Shape of the diffraction pattern.
rot_angle_deg : float, optional
    Scan-detector rotation angle in degrees. Default is 0.
flip_x, flip_y : bool, optional
    Flip scan axes. Default is False.
print_flag : bool, optional
    Print pixel size. Default is False.
transform_axis_matrix : array_like
    Optional 2x2 matrix to apply to positions.

Returns
-------
positions : ndarray
    Scan positions in reconstruction pixels.
pixel_size : float
    Size of one reconstruction pixel in Å.
</code></pre></div>
<p><code>get_ptycho_obj_from_scan(params, num_slices=None, array_phase=None, array_abs=None, scale_phase=1, scale_abs=1, scan_array_A=None, fill_value_type=None)</code>
:   Construct an initial object guess using interpolated phase and amplitude maps. You can use output of dpc, wdd of tcBF reconstructions to generate it.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
params : dict
    PyPty parameter dictionary.
num_slices : int or str, optional
    Number of slices or &quot;auto&quot; to estimate from max phase shift.
array_phase : ndarray, optional
    2D phase map to interpolate.
array_abs : ndarray, optional
    2D amplitude map to interpolate.
scale_phase : float, optional
    Scale factor for phase.
scale_abs : float, optional
    Scale factor for amplitude.
scan_array_A : ndarray or None, optional
    Spatial reference grid for the input maps (in Å).
fill_value_type : str or None, optional
    Padding strategy outside scanned region: None, &quot;edge&quot;, or &quot;median&quot;.

Returns
-------
dict
    Updated PyPty parameter dictionary with object guess.
</code></pre></div>
<p><code>rotate_scan_grid(pypty_params, angle_deg)</code>
:   Apply a rigid rotation to the scan grid.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
angle_deg : float
    Rotation angle in degrees.

Returns
-------
dict
    Updated dictionary with rotated positions and angle.
</code></pre></div>
<p><code>tiltbeamtodata(pypty_params, align_type='com')</code>
:   Align the probe momentum to the center of the measured PACBED pattern.</p>
<div class="highlight"><pre><span></span><code>Parameters
----------
pypty_params : dict
    PyPty parameter dictionary.
align_type : str, optional
    Type of alignment (&quot;com&quot; or &quot;cross_corr&quot;).

Returns
-------
dict
    Updated dictionary with shifted probe.
</code></pre></div>












                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["navigation.expand", "navigation.sections", "content.code.annotate", "content.tabs.link"], "search": "../../../assets/javascripts/workers/search.f8cc74c7.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.c8b220af.min.js"></script>
      
    
  </body>
</html>